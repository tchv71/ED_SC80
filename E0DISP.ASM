;----- Display one editor string ----------

;include E0DISP.MAC
;include RK86.MAC
IFNDEF	CURSM
extrn CURSM
EXTRN	DISP_ADR, DMA_ADR, VRAM_ADR
ENDIF

SETSCR::
	;RET

	;LXI	H,DISP+1
	LHLD	DISP_ADR
	INX	H
	MVI	M,0
	DCX	H
	MVI	M,ScrWidth-1
	MVI	M,(ScrHeight+5-1)
 	MVI	M,99H
	mov	m,a
	INX	H
	MVI	M,27H
	MOV	A,M
	MOV	A,M
	ANI	20H
	JZ	$-3

	;LXI	H,DMA+8
	LHLD	DMA_ADR
	PUSH	B
	LXI	B,8
	DAD	B
	POP	B
	MVI	M,80H
	PUSH	H ; DMA+8
	;MVI	L,Low(DMA+4)
	DCR	L
	DCR	L
	DCR	L
	DCR	L
	PUSH	B
	XCHG
	LHLD	VRAM_ADR
	LXI	B,ScrStart-VRAM
	DAD	B
	XCHG
	MOV	M,E
	MOV	M,D
	POP	D
	INX	H
	MVI	M,Low(ScrSize-1)
	MVI	M,High(ScrSize-1) or 40h
	;MVI	L,Low(DMA+8)
	POP	H ; DMA+8
	MVI	M,0A4H
	RET
	
SetCursor::
	MVI	A,80H
	;STA	DISP+1
	XCHG
	LHLD	DISP_ADR
	INX	H
	MOV	M,A
	DCX	H
	MOV     A,E
	PUSH	H
	LXI	H,LPOS
	ADD	M
	INX	H
	ADD	M
	POP	H
	DCR	A
	ADI	ScrXOffset
	;STA	DISP
	MOV	M,A
	MOV	A,D
	ADI	2
	;STA	DISP
	MOV	M,A
	RET

LPOS:	DB	0
;RK_END
@RK_END::
	DW	0
IFNDEF	noend
	END
ENDIF
