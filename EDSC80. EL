	MACRO-80 3.44	09-Dec-81	PAGE	1


                         C       
                         C      ;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ 
                         C       
                                 	.PHASE 100h 
  0100                          	CSEG 
  0001                          noend	equ	1 
                         C      include RkConfig.mac 
                         C      ; Platform selection 
  0001                   C      RK60k	EQU	1 
                         C      ;PALMIRA EQU	1 
                         C      ;RK32k	EQU	1 
                         C      include	RK86.MAC 
                         C      IFNDEF	?Ctrl 
                         C      ;** RK86.MAC - Radio-86 computer specific constants & macro *** 
                         C      ; 
                         C      ;	09-Oct-1992  - first version 
                         C      ;	15-Nov-1992  - Add 82XX.MAC 
                         C      ;	02-Apr-2021  - Special version for original RK 
                         C       
                         C      ?Ctrl	equ	40h 
                         C      ?Shift	equ	20h 
                         C       
                         C      ; IN and OUT MACRO comands 
                         C      @in	MACRO	addr 
                         C      	lda	addr 
                         C      	ENDM 
                         C       
                         C      @out	MACRO	addr 
                         C      	sta	addr 
                         C      	ENDM 
                         C       
                         C      IFNDEF	CPM 
                         C      GETMAXMEM	EQU 0F830h 
                         C      ENDIF 
                         C      ENDIF 
                         C      include	E0DISP.MAC 
                         C      ;IFNDEF	TabStep 
                         C      ;**************************************************** 
                         C      ;    SC80 text screen editor    (C) TCHV,1989-93    * 
                         C      ;                                                   * 
                         C      ;  E0DISP.MAC - Display dependent macro definitions * 
                         C      ;                                                   * 
                         C      ;          This file is for Original 32k version    * 
                         C      ;**************************************************** 
  0008                   C      TabStep		equ	8 
                         C      ;LimitedCharSet	equ	1 
                         C       
                         C      IFDEF	CPM 
                         C      ScrXOffset	equ	0 
                         C      ScrYOffset	equ	2 
                         C      ScrWidth	equ	78 
                         C      ScrHeight	equ	25 
                         C       
                         C       
                         C      ; LogicWidth must be multiple of 4 
                         C      LogicWidth	equ	76 ; 78 - 8 trailing blank symbols - 5 end blank symbols 
	MACRO-80 3.44	09-Dec-81	PAGE	1-1


                         C      LogicHeight	equ	ScrHeight 
                         C       
                         C      ELSE 
  0008                   C      ScrXOffset	equ	8 
  0003                   C      ScrYOffset	equ	3 
  004E                   C      ScrWidth	equ	78 
  0019                   C      ScrHeight	equ	25 
                         C       
  0040                   C      LogicWidth	equ	64 ; 78 - 8 trailing blank symbols - 5 end blank symbols 
  0017                   C      LogicHeight	equ	ScrHeight-2 
                         C       
                         C      ENDIF 
  0924                   C      ScrSize		equ	(ScrHeight+5)*ScrWidth 
                         C      ;ScrStart	equ	76D0h ; Display buffer start 
                         C       
                         C      ; Start address of physical screen - visible characters 
  00F2                   C      ScrOffset	equ	ScrYOffset*ScrWidth+ScrXOffset 
                         C      ;VRAM		equ	ScrStart+ScrOffset 
                         C      SetScrAddr	macro 
                         C      		endm 
                         C       
                         C      WriteNextSym	macro 
                         C      		mov	m,a 
                         C      		inx	h 
                         C      		endm 
                         C       
  0020                   C      space		equ	20h 
                         C      IFDEF	PALMIRA 
                         C      CURSOR_BLOCK	equ	0E8h-80h 
                         C      CURSOR_LINE	equ	0D8h-80h 
                         C      ELSE 
  00E3                   C      CURSOR_BLOCK	equ	0E3h 
  00D3                   C      CURSOR_LINE	equ	0D3h 
                         C      ENDIF 
                         C       
                         C      ;$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ 
                         C      ;ENDIF 
                         C      include	E0BREAK.MAC 
                         C       
                         C      ; 
                         C      ;	E0break.mac - time safe break check 
                         C      ; 
                         C       
                         C      ;PPI	equ	0F780h 
                         C       
                         C      ; Initialize break checking 
                         C      init_brk_check	macro 
                         C      		PUSH	H 
                         C      		;MVI	A,0FEH 
                         C      		;STA	PPI 
                         C      		LHLD	PPI_ADR 
                         C      		MVI	M,0FEH 
                         C      		POP	H 
                         C      		endm 
                         C       
                         C      ; Check for break key pressed (Z=1) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-2


                         C      check_break	macro 
                         C      		;LDA	PPI+1 
                         C      		PUSH	H 
                         C      		LHLD	PPI_ADR 
                         C      		INR	L 
                         C      		MOV	A,M 
                         C      		POP	H 
                         C      		ANI	40h 
                         C      		endm 
                         C      include	E0MAIN.ASM 
                         C      	;********************************************** 
                         C      ;*        TCHV text full-screen editor        * 
                         C      ;*               (c) 1989-92                  * 
                         C      ;* Text processing and general control module * 
                         C      ;********************************************** 
                         C       
                         C      ;	 6-Dec-1991 
                         C      ;	 8-Dec-1991 -   80 - symbol mode for CP/M, 
                         C      ;		macros SetScrAddr and WriteNextSym 
                         C      ;	14-Jan-1992 -  Use some CP/M features 
                         C      ;	28-Jan-1992 -  Change command table presentation 
                         C      ;	01-Mar-1992 -  Delete some bugs 
                         C      ;	15-Mar-1992 -  Add case insensitive search 
                         C       
                         C      ;	02-Apr-2021 -  Original RK back-adaptation 
                         C      ;	25-Apr-2021 -  Controller addresses table 
                         C       
                         C       
                         C      PUBLIC	INFADR 
                         C      ;PUBLIC	INFSTR 
                         C       
                         C      .8080 
  0100                   C      	CSEG 
                         C      	;ORG 104H 
                         C       
  0030                   C      StkSize	EQU	30h 
                         C       
  2000                   C      TXTBUFF	EQU	2000H 
  1E00                   C      WRK	EQU	1E00H 
                         C       
                         C       
                         C      IFNDEF	noend 
                         C      extrn	SETCURSOR,SETSCR ; From E0DISP.ASM 
                         C      extrn	GETCHC,GETCHR	; From E0GETC.ASM 
                         C       
                         C      extrn   FNDCMD		; From E0CMDT.ASM 
                         C      ENDIF 
                         C       
                         C      IFDEF	CPM 
                         C      LineSym		equ	5Fh 
                         C      DelimSym	equ	7Ch 
                         C      ELSE 
  001C                   C      LineSym		equ	1ch 
  001B                   C      DelimSym	equ	1bh 
                         C      ENDIF 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-3


  0750                   C      INFSTR_OFFS	EQU	ScrWidth*(LogicHeight+1) 
                         C      ;INFSTR	EQU	VRAM+INFSTR_OFFS 
  007F                   C      MAXLEN	EQU	127 
                         C       
                         C      PUBLIC	VRAM_ADR,PPI_ADR,DISP_ADR,DMA_ADR 
                         C       
  0100    C3 0115        C      	JMP	START_COLD 
                         C      ; Controller addresses table 
                         C      IFDEF	PALMIRA 
                         C      IFDEF	CPM 
                         C      	VRAM_ADR:	DW 0EEd0h+800h+ScrOffset	; VRAM buffer visible start address - 0B7C2h 
                         C      	PPI_ADR:	DW 00h 		; VV55 keyboard Controller - 0C200h 
                         C      	PPI2_ADR:	DW 10h		; VV55 additional PPI  - 0C400h 
                         C      	DISP_ADR:	DW 20H		; VG75 Display Controller - 0C000h 
                         C      	DMA_ADR:	DW 30h		; VT57 DMA Controller - 0E000h 
                         C      ELSE 
                         C      	VRAM_ADR:	DW 0B770h	; VRAM buffer visible start address - 0B7C2h 
                         C      	PPI_ADR:	DW 0C200h 	; VV55 keyboard Controller - 0C200h 
                         C      	PPI2_ADR:	DW 0C400h	; VV55 additional PPI  - 0C400h 
                         C      	DISP_ADR:	DW 0C000h	; VG75 Display Controller - 0C000h 
                         C      	DMA_ADR:	DW 0E000h	; VT57 DMA Controller - 0E000h 
                         C      ENDIF 
                         C      ELSE 
                         C      IFDEF	RK60k 
  0103    E7C2           C      	VRAM_ADR:	DW 0E7C2h	; VRAM buffer visible start address - 0E7C2h 
  0105    F780           C      	PPI_ADR:	DW 0F780h 	; VV55 keyboard Controller - 0F780h 
  0107    F7A0           C      	PPI2_ADR:	DW 0F7A0h	; VV55 additional PPI  - 0F7A0h 
  0109    F7C0           C      	DISP_ADR:	DW 0F7C0h	; VG75 Display Controller - 0F7C0h 
  010B    F7E0           C      	DMA_ADR:	DW 0F7E0h	; VT57 DMA Controller - 0F7E0h 
                         C      ELSE 
                         C      	VRAM_ADR:	DW 77C2h	; VRAM buffer visible start address - 77c2h 
                         C      	PPI_ADR:	DW 08000h 	; VV55 keyboard Controller - 8000h 
                         C      	PPI2_ADR:	DW 0A000h	; VV55 additional PPI  - 0A000h	 
                         C      	DISP_ADR:	DW 0C000h	; VG75 Display Controller - 0C000h 
                         C      	DMA_ADR:	DW 0E000h	; VT57 DMA Controller - 0E000h 
                         C      ENDIF 
                         C      ENDIF 
  010D    0000 0000      C      		DW 0,0,0,0 ; Reserved for future use 
  0111    0000 0000      C      
                         C      IFDEF	CPM 
                         C      GETMAXMEM: 
                         C      	LHLD	6 
                         C      	RET 
                         C      ENDIF 
                         C       
  0115                   C      START_COLD: 
  0115    21 2000        C      	LXI	H,TXTBUFF 
  0118    36 0D          C      	MVI	M,0Dh 
  011A    23             C      	INX	H 
  011B    36 FF          C      	MVI	M,0FFh 
                         C       
  011D                   C      START:: 
  011D    CD F830        C      	CALL	GETMAXMEM;lhld	6 
  0120    F9             C      	sphl 
  0121    3E 01          C      	MVI	A,1 
  0123    32 1E2C        C      	STA	DISPOS 
	MACRO-80 3.44	09-Dec-81	PAGE	1-4


  0126    32 1E3A        C      	STA	DISPS0 
  0129    21 0000        C      	LXI	H,0 
  012C    22 1E32        C      	SHLD	SCRBG0 
  012F    CD 0266        C      	CALL	INIT 
  0132    3E FF          C      	MVI	A,0FFH 
  0134    32 1E3C        C      	STA	?WIN1 
  0137    21 0101        C      	LXI	H,101H 
  013A    22 1E2A        C      	SHLD	CURX 
  013D    22 1E38        C      	SHLD	CURX0 
  0140    21 0001        C      	LXI	H,1 
  0143    22 1E0A        C       	SHLD	CURSTR 
  0146    CD 024D        C      	CALL	CLS 
  0149    CD 103A        C      	CALL	OVRW 
  014C    21 2000        C      	LXI	H,TXTBUFF 
  014F    22 1E00        C      	SHLD	nivgr 
  0152    22 1E0C        C      	SHLD	BLBEG 
  0155    22 1E0E        C      	SHLD	BLEND 
  0158    EB             C      	XCHG 
  0159    CD 0243        C      	CALL	MAXRAM 
  015C    22 1E02        C      	SHLD	werhgr 
  015F    EB             C      	XCHG 
                         C      IFDEF	CPM 
                         C      	LXI	H,BUFF+1 
                         C      	MOV	A,M 
                         C      	ORA	A 
                         C      	JZ	NOFILE 
                         C      	PUSH	D 
                         C      	LXI	D,FCB 
                         C      	CALL	GTFNAM 
                         C      	LHLD	nivgr 
                         C      	CALL	RDBOD 
                         C      	LHLD	nivgr 
                         C      	MOV	D,H 
                         C      	MOV	E,L 
                         C      	CALL	CONVRT 
                         C      	XCHG 
                         C      	SHLD	werhgr 
                         C      	POP	D 
                         C      	LHLD 	nivgr 
                         C      NOFILE: 
                         C      ENDIF 
  0160    CD 02A0        C      	CALL	CHECKMEM 
  0163    FE FF          C      	CPI	0FFH 
  0165    CA 0170        C      	JZ	M01 
  0168    2A 1E00        C      	LHLD	nivgr 
  016B    36 0D          C      	MVI	M,0DH 
  016D    23             C      	INX	H 
  016E    36 FF          C      	MVI	M,0FFH 
  0170    22 1E02        C      M01:	SHLD	werhgr 
  0173    2A 1E00        C      M00:	LHLD	nivgr 
  0176    22 1E20        C      	SHLD	SCRADR 
  0179    22 1E22        C      	SHLD	STRADR 
  017C    22 1E3D        C      	SHLD	TABSRH 
  017F    CD 02E9        C      	CALL	COMPST 
  0182    2A 1E20        C      	LHLD	SCRADR 
  0185    22 1E2E        C      	SHLD	SCRAD0 
	MACRO-80 3.44	09-Dec-81	PAGE	1-5


  0188    2A 1E22        C      	LHLD	STRADR 
  018B    22 1E30        C      	SHLD	STRAD0 
  018E    CD 046E        C      	CALL	CURSM 
  0191    AF             C      	xra	a 
  0192    32 1E3B        C      	sta	?StringBufActive 
  0195    CD 032B        C      	CALL	DISPLY 
  0198    C3 081C        C      	JMP	M03 
                         C       
  019B    CD 0280        C      SETINF:	CALL	DRLIN 
  019E    2A 1E22        C      	LHLD	STRADR 
  01A1    22 1E3D        C      	SHLD	TABSRH 
  01A4    CD 046E        C      	CALL	CURSM 
  01A7    CD 0C9C        C      	CALL	LINE 
                         C       
  01AA    CD 1335        C      	CALL	GETINFADR 
                         C      	SetScrAddr 
  01AD    0E 08          C      	mvi	c,8 
  01AF    3E 20          C      @@000:	mvi	a,space 
                         C      	WriteNextSym 
  01B1    77             C+     		mov	m,a 
  01B2    23             C+     		inx	h 
  01B3    0D             C      	dcr	c 
  01B4    C2 01AF        C      	JNZ	@@000 
                         C       
  01B7    CD 133F        C      	CALL	INFPR 
  01BA    0008           C      	DW	8 
  01BC    4C 49 4E 45    C      	DC	'LINE: ' 
  01C0    3A A0          C      
                         C       
  01C2    2A 1E08        C      	LHLD	NUMSTR 
  01C5    CD 1426        C      	CALL	?FBBCD 
  01C8    EB             C      	XCHG 
  01C9    CD 1335        C      	CALL	GETINFADR 
  01CC    D5             C      	PUSH	D 
  01CD    11 0016        C      	LXI	D,22 
  01D0    19             C      	DAD	D 
  01D1    D1             C      	POP	D 
  01D2    CD 1314        C      	CALL	BPR 
  01D5    3E 2F          C      	mvi	a,'/' 
                         C      	SetScrAddr 
                         C      	WriteNextSym 
  01D7    77             C+     		mov	m,a 
  01D8    23             C+     		inx	h 
  01D9    2B             C      	DCX	H 
  01DA    2B             C      	DCX	H 
  01DB    E5             C      	PUSH	H 
  01DC    2A 1E0A        C      	LHLD	CURSTR 
  01DF    CD 1426        C      	CALL	?FBBCD 
  01E2    EB             C      	XCHG 
  01E3    E1             C      	POP	H 
  01E4    CD 1314        C      	CALL	BPR 
  01E7    CD 133F        C      	CALL	INFPR 
  01EA    0024           C      	DW	36 
  01EC    20 20 20 20    C      	DC	'     TEXT:' 
  01F0    20 54 45 58    C      
  01F4    54 BA          C      
	MACRO-80 3.44	09-Dec-81	PAGE	1-6


  01F6    2A 1E02        C      	LHLD	werhgr 
  01F9    EB             C      	XCHG 
  01FA    CD 1335        C      	CALL	GETINFADR 
  01FD    D5             C      	PUSH	D 
  01FE    11 0039        C      	LXI	D,57 
  0201    19             C      	DAD	D 
  0202    D1             C      	POP	D 
                         C      	SetScrAddr 
  0203    3E 48          C      	mvi	a,'H' 
                         C      	WriteNextSym 
  0205    77             C+     		mov	m,a 
  0206    23             C+     		inx	h 
  0207    2B             C      	dcx	h 
  0208    2B             C      	DCX	H 
  0209    CD 1314        C      	CALL	BPR 
  020C    CD 133F        C      	call	INFPR 
  020F    0033           C      	dw	51 
  0211    48 AD          C      	dc	'H-' 
  0213    CD 1335        C      	CALL	GETINFADR 
  0216    D5             C      	PUSH	D 
  0217    11 0032        C      	LXI	D,50 
  021A    19             C      	DAD	D 
  021B    D1             C      	POP	D 
  021C    EB             C      	XCHG 
  021D    2A 1E00        C      	LHLD	nivgr 
  0220    EB             C      	XCHG 
  0221    CD 1314        C      	CALL	BPR 
  0224    CD 133F        C      	CALL	INFPR 
  0227    0017           C      	DW	23 
  0229    20 20 20 20    C      	DC	'      COL:' 
  022D    20 20 43 4F    C      
  0231    4C BA          C      
  0233    C3 02BE        C      	JMP	DISCUR 
                         C       
  0236    CD 1047        C      WRMSRT:	CALL	SAVMOD 
  0239    CD 032B        C      OUT1:	CALL	DISPLY 
  023C    CD F830        C      OUT3:	CALL	GETMAXMEM;lhld	6 
  023F    F9             C      	sphl 
  0240    C3 081C        C      	JMP	M03 
                         C       
  0243    CD F830        C      MAXRAM:	CALL	GETMAXMEM;LHLD	6 
  0246    C5             C      	push	b 
  0247    01 FFD0        C      	lxi	b,-StkSize 
  024A    09             C      	dad	b 
  024B    C1             C      	pop	b 
  024C    C9             C      	RET 
                         C       
  024D                   C      CLS:	;lxi	h,ScrStart 
  024D    2A 0103        C      	lhld	VRAM_ADR 
  0250    01 FF0E        C      	lxi	b,-ScrOffset 
  0253    09             C      	dad	b 
  0254    01 0923        C      	lxi	b,ScrSize-1 
                         C       
                         C      	SetScrAddr 
  0257    3E 00          C      	mvi	a,0;8Dh ; 84H 
                         C      	WriteNextSym 
	MACRO-80 3.44	09-Dec-81	PAGE	1-7


  0259    77             C+     		mov	m,a 
  025A    23             C+     		inx	h 
  025B                   C      ClsLoop: 
  025B    3E 20          C      	mvi	a,space 
                         C      	WriteNextSym 
  025D    77             C+     		mov	m,a 
  025E    23             C+     		inx	h 
  025F    0B             C      	DCX	B 
  0260    78             C      	MOV	A,B 
  0261    B1             C      	ORA	C 
  0262    C2 025B        C      	jnz	ClsLoop 
  0265    C9             C      	RET 
                         C       
  0266                   C      INIT: 
  0266    2A 0103        C      	LHLD	VRAM_ADR 
  0269    22 1E24        C      	SHLD	SCRBEG 
  026C    3E 17          C      	MVI	A,LogicHeight 
  026E    32 1E28        C      	STA	YSIZE 
  0271    AF             C      	XRA	A 
  0272    32 1E29        C      	STA	YBEG 
  0275    2A 0103        C      	LHLD	VRAM_ADR 
  0278    11 0750        C      	LXI	D,INFSTR_OFFS 
  027B    19             C      	DAD	D 
  027C    22 1E26        C      	SHLD	INFADR 
  027F    C9             C      	RET 
                         C       
  0280    3A 1E33        C      DRLIN:	LDA	SCRBG0+1 
  0283    B7             C      	ORA	A 
  0284    C8             C      	RZ 
  0285    2A 1E26        C      	LHLD	INFADR 
  0288    3A 1E3C        C      	LDA	?WIN1 
  028B    B7             C      	ORA	A 
  028C    C2 0292        C      	JNZ	$+6 
  028F    2A 1E34        C      	LHLD	INFAD0 
  0292    01 FFB2        C      	LXI	B,-ScrWidth 
  0295    09             C      	DAD	B 
  0296    3E 3F          C      	MVI	A,LogicWidth-1 
  0298    36 5E          C      	MVI	M,'^' 
  029A    23             C      	INX	H 
  029B    3D             C      	DCR	A 
  029C    C2 0298        C      	JNZ	$-4 
  029F    C9             C      	RET 
                         C       
  02A0    7E             C      CHECKMEM:	MOV	A,M 
  02A1    FE FF          C      	CPI	0FFH 
  02A3    C2 02AE        C      	JNZ	CHKM0 
  02A6    2B             C      	DCX	H 
  02A7    7E             C      	MOV	A,M 
  02A8    23             C      	INX	H 
  02A9    FE 0D          C      	CPI	0DH 
  02AB    3E FF          C      	MVI	A,0FFH 
  02AD    C8             C      	RZ 
  02AE    23             C      CHKM0:	INX	H 
  02AF    7C             C      	MOV	A,H 
  02B0    3C             C      	INR	A 
  02B1    BA             C      	CMP	D 
	MACRO-80 3.44	09-Dec-81	PAGE	1-8


  02B2    DA 02A0        C      	JC	CHECKMEM 
  02B5    7D             C      	MOV	A,L 
  02B6    3C             C      	INR	A 
  02B7    BB             C      	CMP	E 
  02B8    DA 02A0        C      	JC	CHECKMEM 
  02BB    3E 00          C      	MVI	A,0 
  02BD    C9             C      	RET 
                         C       
  02BE    3A 1E2A        C      DISCUR:	LDA	CURX 
  02C1    6F             C      	MOV	L,A 
  02C2    26 00          C      	MVI	H,0 
  02C4    CD 1426        C      	CALL	?FBBCD 
  02C7    EB             C      	XCHG 
  02C8    CD 1335        C      	CALL	GETINFADR 
  02CB    D5             C      	PUSH	D 
  02CC    11 0023        C      	LXI	D,35 
  02CF    19             C      	DAD	D 
  02D0    D1             C      	POP	D 
  02D1    7B             C      	MOV	A,E 
  02D2    CD 131C        C      	CALL	BPR1 
  02D5    7A             C      	MOV	A,D 
  02D6    C3 1325        C      	JMP	BPR01 
                         C       
  02D9    2A 1E0A        C      INRCUR:	LHLD	CURSTR 
  02DC    23             C      	INX	H 
  02DD    22 1E0A        C      	SHLD	CURSTR 
  02E0    C9             C      	RET 
                         C       
  02E1    2A 1E0A        C      DCRCUR:	LHLD	CURSTR 
  02E4    2B             C      	DCX	H 
  02E5    22 1E0A        C      	SHLD	CURSTR 
  02E8    C9             C      	RET 
                         C       
  02E9    11 0000        C      COMPST:	LXI	D,0 
  02EC    2A 1E00        C      	LHLD	nivgr 
  02EF    7E             C      COMP1:	MOV	A,M 
  02F0    23             C      	INX	H 
  02F1    FE FF          C      	CPI	0FFH 
  02F3    CA 02FF        C      	JZ	COMP0 
  02F6    FE 0D          C      	CPI	0DH 
  02F8    C2 02EF        C      	JNZ	COMP1 
  02FB    13             C      	INX	D 
  02FC    C3 02EF        C      	JMP	COMP1 
  02FF    EB             C      COMP0:	XCHG 
  0300    22 1E08        C      	SHLD	NUMSTR 
  0303    C9             C      	RET 
                         C       
  0304    2A 1E00        C      COMCUR:	LHLD	nivgr 
  0307    EB             C      	XCHG 
  0308    2A 1E22        C      	LHLD	STRADR 
  030B    7D             C      	MOV	A,L 
  030C    93             C      	SUB	E 
  030D    4F             C      	MOV	C,A 
  030E    7C             C      	MOV	A,H 
  030F    9A             C      	SBB	D 
  0310    47             C      	MOV	B,A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-9


  0311    03             C      	INX	B 
  0312    11 0001        C      	LXI	D,1 
  0315    0B             C      COMP2:	DCX	B 
  0316    78             C      	MOV	A,B 
  0317    B1             C      	ORA	C 
  0318    CA 0326        C      	JZ	COMP3 
  031B    7E             C      	MOV	A,M 
  031C    2B             C      	DCX	H 
  031D    FE 0D          C      	CPI	0DH 
  031F    C2 0323        C      	JNZ	$+4 
  0322    13             C      	INX	D 
  0323    C3 0315        C      	JMP	COMP2 
  0326    EB             C      COMP3:	XCHG 
  0327    22 1E0A        C      	SHLD	CURSTR 
  032A    C9             C      	RET 
                         C       
  032B    E5             C      DISPLY:	PUSH	H 
  032C    C5             C      	PUSH	B 
  032D    F5             C      	PUSH	PSW 
  032E    D5             C      	PUSH	D 
  032F    CD 0A56        C      	CALL	SWPWN 
  0332    CA 033B        C      	JZ	DSPL0 
  0335    CD 0343        C      	CALL	DSPL1 
  0338    CD 0A56        C      	CALL	SWPWN 
  033B    CD 0343        C      DSPL0:	CALL	DSPL1 
  033E    D1             C      	POP	D 
  033F    F1             C      	POP	PSW 
  0340    C1             C      	POP	B 
  0341    E1             C      	POP	H 
  0342    C9             C      	RET 
                         C       
  0343    2A 1E20        C      DSPL1:	LHLD	SCRADR 
  0346    EB             C      	XCHG 
  0347    2A 1E24        C      	LHLD	SCRBEG 
  034A    3A 1E28        C      	LDA	YSIZE 
  034D    47             C      	MOV	B,A 
  034E    CD 0355        C      	CALL	D01 
  0351    22 1E06        C      	SHLD	SCREND 
  0354    C9             C      	RET 
                         C       
                         C       
  0355                   C      D01: 
  0355    AF             C      	XRA	A 
  0356    32 1E2D        C      	STA	?END 
  0359    C5             C      	PUSH	B 
                         C       
  035A    E5             C      	push	h 
  035B    D5             C      	push	d 
  035C    3A 1E3B        C      	lda	?StringBufActive 
  035F    B7             C      	ora	a 
  0360    CA 0383        C      	jz	@220 
  0363    2A 1E22        C      	lhld	STRADR 
  0366    EB             C      	xchg 
  0367    7C             C      	mov	a,h 
  0368    BA             C      	cmp	d 
  0369    C2 0383        C      	jnz	@220 
	MACRO-80 3.44	09-Dec-81	PAGE	1-10


  036C    7D             C      	mov	a,l 
  036D    BB             C      	cmp	e 
  036E    C2 0383        C      	jnz	@220 
  0371    D1             C      	pop	d 
  0372    E1             C      	pop	h 
  0373    D5             C      	push	d 
  0374    11 1E7D        C      	lxi	d,STRRED 
  0377    CD 14BB        C      	call	DISSTR 
  037A    D1             C      	pop	d 
  037B    EB             C      	xchg 
  037C    CD 0593        C      	CALL	NEXTST 
  037F    EB             C      	xchg 
  0380    C3 0388        C      	jmp	@221 
  0383                   C      @220: 
  0383    D1             C      	pop	d 
  0384    E1             C      	pop	h 
                         C      	;lda	DISPOS 
  0385    CD 14BB        C      	CALL	DISSTR 
  0388                   C      @221: 
  0388    C1             C      	POP	B 
  0389    FE FF          C      	CPI	0FFH 
  038B    CA 0396        C      	JZ	@11 
  038E    13             C      	INX	D 
  038F    05             C      	DCR	B 
  0390    C2 0355        C      	JNZ	D01 
  0393    C3 03B3        C      	JMP	@12 
  0396    3A 1E2D        C      @11:	LDA	?END 
  0399    B7             C      	ORA	A 
  039A    C2 03A1        C      	JNZ	@110 
  039D    78             C      	MOV	A,B 
  039E    32 1E2D        C      	STA	?END 
  03A1    05             C      @110:	DCR	B 
  03A2    CA 03B3        C      	JZ	@12 
  03A5    0E 4E          C      @9:	MVI	C,ScrWidth 
                         C       
  03A7                   C      @10: 
                         C      	SetScrAddr 
                         C       
  03A7    3E 20          C      @101:	mvi	a,space 
                         C      	WriteNextSym 
  03A9    77             C+     		mov	m,a 
  03AA    23             C+     		inx	h 
  03AB    0D             C      	DCR	C 
  03AC    C2 03A7        C      	JNZ	@10 
  03AF    05             C      	DCR	B 
  03B0    C2 03A5        C      	JNZ	@9 
  03B3    EB             C      @12:	XCHG 
  03B4    C9             C      	RET 
                         C       
                         C      ;@ 
                         C       
  03B5    0B             C      DELAY0:	DCX	B 
  03B6    78             C      	MOV	A,B 
  03B7    B1             C      	ORA	C 
  03B8    C2 03B5        C      	JNZ	DELAY0 
  03BB    C9             C      	RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-11


                         C       
                         C       
  03BC    3A 1E2A        C      wlewo:	LDA	CURX 
  03BF    3D             C      	DCR	A 
  03C0    C8             C      	RZ 
  03C1    32 1E2A        C      	STA	CURX 
  03C4    C3 046E        C      	JMP	CURSM 
                         C       
  03C7    3A 1E2A        C      wprawo:	LDA	CURX 
  03CA    FE 7F          C      	CPI	MAXLEN 
  03CC    D0             C      	RNC 
  03CD    3C             C      	INR	A 
  03CE    32 1E2A        C      	STA	CURX 
  03D1    C3 046E        C      	JMP	CURSM 
                         C       
  03D4    3A 1E2C        C      wp1:	LDA	DISPOS 
  03D7    C6 08          C      	ADI	8 
  03D9    32 1E2C        C      	STA	DISPOS 
  03DC    CD 032B        C      	CALL	DISPLY 
  03DF    C3 046E        C      	JMP	CURSM 
                         C       
  03E2    E5             C      GETC:	PUSH	H 
  03E3    D5             C      	PUSH	D 
  03E4    C5             C      	PUSH	B 
  03E5    2A 1E3D        C      	LHLD	TABSRH 
  03E8    3A 1E2A        C      	LDA	CURX 
  03EB    4F             C      	MOV	C,A 
  03EC    06 01          C      	MVI	B,1 
  03EE    58             C      	MOV	E,B 
  03EF    78             C      GTC0:	MOV	A,B 
  03F0    B9             C      	CMP	C 
  03F1    D2 0417        C      	JNC	GTC3 
  03F4    7E             C      	MOV	A,M 
  03F5    23             C      	INX	H 
  03F6    FE 09          C      	CPI	9 
  03F8    CA 0405        C      	JZ	GTC1 
  03FB    FE 0D          C      	CPI	0DH 
  03FD    CA 0413        C      	JZ	GTC2 
  0400    04             C      	INR	B 
  0401    1C             C      	INR	E 
  0402    C3 03EF        C      	JMP	GTC0 
  0405    78             C      GTC1:	MOV	A,B 
  0406    CD 0457        C      	call	CalcNextTabPos 
  0409    47             C      	MOV	B,A 
  040A    79             C      	MOV	A,C 
  040B    B8             C      	CMP	B 
  040C    DA 0417        C      	JC	GTC3 
  040F    1C             C      	INR	E 
  0410    C3 03EF        C      	JMP	GTC0 
  0413    79             C      GTC2:	MOV	A,C 
  0414    90             C      	SUB	B 
  0415    83             C      	ADD	E 
  0416    5F             C      	MOV	E,A 
  0417    7B             C      GTC3:	MOV	A,E 
  0418    C1             C      	POP	B 
  0419    D1             C      	POP	D 
	MACRO-80 3.44	09-Dec-81	PAGE	1-12


  041A    E1             C      	POP	H 
  041B    C9             C      	RET 
                         C       
  041C    E5             C      CURCM:	PUSH	H 
  041D    C5             C      	PUSH	B 
  041E    2A 1E3D        C      	LHLD	TABSRH 
  0421    3A 1E2A        C      	LDA	CURX 
  0424    4F             C      	MOV	C,A 
  0425    06 01          C      	MVI	B,1 
  0427    0D             C      CC0:	DCR	C 
  0428    CA 044D        C      	JZ	CC2 
  042B    7E             C      	MOV	A,M 
  042C    23             C      	INX	H 
  042D    FE 09          C      	CPI	9 
  042F    CA 0440        C      	JZ	CC1 
  0432    FE 0D          C      	CPI	0DH 
  0434    CA 0448        C      	JZ	CC3 
  0437    FE FF          C      	CPI	0FFH 
  0439    CA 0448        C      	JZ	CC3 
  043C    04             C      	INR	B 
  043D    C3 0427        C      	JMP	CC0 
  0440    78             C      CC1:	MOV	A,B 
  0441    CD 0457        C      	call	CalcNextTabPos 
  0444    47             C      	MOV	B,A 
  0445    C3 0427        C      	JMP	CC0 
  0448    04             C      CC3:	INR	B 
  0449    0D             C      	DCR	C 
  044A    C2 0448        C      	JNZ	CC3 
  044D    78             C      CC2:	MOV	A,B 
  044E    32 1E2A        C      	STA	CURX 
  0451    CD 046E        C      	CALL	CURSM 
  0454    C1             C      	POP	B 
  0455    E1             C      	POP	H 
  0456    C9             C      	RET 
                         C       
  0457                   C      CalcNextTabPos: 
  0457    3D             C      	DCR	A 
  0458    F6 07          C      	ORI	TabStep-1 
  045A    C6 02          C      	ADI	2 
  045C    C9             C      	ret 
                         C       
  045D    3A 1E28        C      INFCRM:	LDA	YSIZE 
  0460    C6 02          C      	ADI	2 
  0462    32 1E2B        C      	STA	CURY 
  0465    E5             C      CURM:	push	h 
  0466    2A 1E2A        C      	lhld	CURX 
  0469    CD 15F7        C      	call	SetCursor 
  046C    E1             C      	pop	h 
  046D    C9             C      	ret 
                         C       
  046E    3A 1E2C        C      CURSM::	LDA	DISPOS 
  0471    C5             C      	PUSH	B 
  0472    47             C      	MOV	B,A 
  0473    3A 1E2A        C      	LDA	CURX 
  0476    90             C      	SUB	B 
  0477    C1             C      	POP	B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-13


  0478    DA 0490        C      	JC	LEFT 
  047B    FE 40          C      	CPI	LogicWidth 
  047D    D2 049B        C      	JNC	RIGHT 
  0480    3C             C      MovCur:	INR	A 
  0481    6F             C      	mov	l,a 
  0482    3A 1E2B        C      	lda	CURY 
  0485    67             C      	MOV	h,A 
  0486    3A 1E29        C      	LDA	YBEG 
  0489    84             C      	add	h 
  048A    67             C      	mov	h,a 
  048B    CD 15F7        C      	call	SetCursor 
  048E    B7             C      	ora	a 
  048F    C9             C      	ret 
                         C       
                         C       
  0490    3A 1E2C        C      LEFT:	LDA	DISPOS 
  0493    D6 08          C      	SUI	8 
  0495    32 1E2C        C      	STA	DISPOS 
  0498    C3 04A3        C      	JMP	CURM1 
                         C       
  049B    3A 1E2C        C      RIGHT:	LDA	DISPOS 
  049E    C6 08          C      	ADI	8 
  04A0    32 1E2C        C      	STA	DISPOS 
  04A3    3A 1E2C        C      CURM1:	LDA	DISPOS 
  04A6    C5             C      	PUSH	B 
  04A7    47             C      	MOV	B,A 
  04A8    3A 1E2A        C      	LDA	CURX 
  04AB    90             C      	SUB	B 
  04AC    C1             C      	POP	B 
  04AD    DA 0490        C      	JC	LEFT 
  04B0    FE 40          C      	CPI	LogicWidth 
  04B2    D2 049B        C      	JNC	RIGHT 
  04B5    CD 032B        C      	CALL	DISPLY 
  04B8    C3 0480        C      	jmp	MovCur 
                         C       
                         C      ;--------------------------------------------- 
                         C       
  04BB    D5             C      wniz:	PUSH	D 
  04BC    2A 1E22        C      	LHLD	STRADR 
  04BF    CD 0593        C      	CALL	NEXTST 
  04C2    D1             C      	POP	D 
  04C3    C8             C      	RZ 
  04C4    22 1E22        C      	SHLD	STRADR 
  04C7    CD 02D9        C      	CALL	INRCUR 
  04CA    3A 1E28        C      	LDA	YSIZE 
  04CD    3D             C      	DCR	A 
  04CE    47             C      	MOV	B,A 
  04CF    3A 1E2B        C      	LDA	CURY 
  04D2    B8             C      	CMP	B 
  04D3    D2 04EA        C      	JNC	ROLLUP 
  04D6    3C             C      	INR	A 
  04D7    32 1E2B        C      	STA	CURY 
  04DA    C3 046E        C      	JMP	CURSM 
                         C       
  04DD    2A 1E22        C      RLUP:	LHLD	STRADR 
  04E0    CD 0593        C      	CALL	NEXTST 
	MACRO-80 3.44	09-Dec-81	PAGE	1-14


  04E3    C8             C      	RZ 
  04E4    22 1E22        C      	SHLD	STRADR 
  04E7    CD 02D9        C      	CALL	INRCUR 
  04EA    2A 1E20        C      ROLLUP:	LHLD	SCRADR 
  04ED    CD 0593        C      	CALL	NEXTST 
  04F0    22 1E20        C      	SHLD	SCRADR 
  04F3    C8             C      	RZ 
  04F4    CD 0556        C      	CALL	SCRUP 
  04F7    2A 1E06        C      	LHLD	SCREND 
  04FA    EB             C      	XCHG 
  04FB    01 FF64        C      	LXI	B,-2*ScrWidth 
  04FE    2A 1E26        C      	LHLD	INFADR 
  0501    09             C      	DAD	B 
  0502    3A 1E2C        C      	lda	DISPOS 
  0505    CD 14BB        C      	CALL	DISSTR 
  0508    FE FF          C      	CPI	0FFH 
  050A    CA 0513        C      	JZ	wn20 
                         C       
                         C       
  050D    13             C      	INX	D 
  050E    EB             C      	XCHG 
  050F    22 1E06        C      	SHLD	SCREND 
  0512    C9             C      	RET 
  0513    21 1E2D        C      wn20:	LXI	H,?END 
  0516    34             C      	INR	M 
  0517    C9             C      	RET 
                         C       
  0518    21 0000        C      SCRDN:	LXI	H,0 
  051B    39             C      	DAD	SP 
  051C    22 153A        C      	SHLD	PRSP 
  051F    31 FFF2        C      	LXI	SP,LogicWidth-ScrWidth 
  0522    2A 1E26        C      	LHLD	INFADR 
  0525    11 FF55        C      	LXI	D,LogicWidth-3*ScrWidth-1 
  0528    19             C      	DAD	D 
  0529    EB             C      	XCHG 
  052A    21 004E        C      	LXI	H,ScrWidth 
  052D    19             C      	DAD	D 
  052E    3A 1E28        C      	LDA	YSIZE 
  0531    3D             C      	DCR	A 
  0532    47             C      	MOV	B,A 
  0533    0E 10          C      SCD1:	MVI	C,LogicWidth/4 
  0535    1A             C      SCD0:	LDAX	D 
  0536    77             C      	MOV	M,A 
  0537    2B             C      	DCX	H 
  0538    1B             C      	DCX	D 
  0539    1A             C      	LDAX	D 
  053A    77             C      	MOV	M,A 
  053B    2B             C      	DCX	H 
  053C    1B             C      	DCX	D 
  053D    1A             C      	LDAX	D 
  053E    77             C      	MOV	M,A 
  053F    2B             C      	DCX	H 
  0540    1B             C      	DCX	D 
  0541    1A             C      	LDAX	D 
  0542    77             C      	MOV	M,A 
  0543    2B             C      	DCX	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-15


  0544    1B             C      	DCX	D 
  0545    0D             C      	DCR	C 
  0546    C2 0535        C      	JNZ	SCD0 
  0549    39             C      	DAD	SP 
  054A    EB             C      	XCHG 
  054B    39             C      	DAD	SP 
  054C    EB             C      	XCHG 
  054D    05             C      	DCR	B 
  054E    C2 0533        C      	JNZ	SCD1 
  0551    2A 153A        C      	LHLD	PRSP 
  0554    F9             C      	SPHL 
  0555    C9             C      	RET 
                         C       
  0556    21 0000        C      SCRUP:	LXI	H,0 
  0559    39             C      	DAD	SP 
  055A    22 153A        C      	SHLD	PRSP 
  055D    31 000E        C      	LXI	SP,ScrWidth-LogicWidth 
  0560    11 004E        C      	LXI	D,ScrWidth 
  0563    2A 1E24        C      	LHLD	SCRBEG 
  0566    19             C      	DAD	D 
  0567    EB             C      	XCHG 
  0568    2A 1E24        C      	LHLD	SCRBEG 
                         C       
  056B    3A 1E28        C      	LDA	YSIZE 
  056E    3D             C      	DCR	A 
  056F    47             C      	MOV	B,A 
                         C       
  0570    0E 10          C      SCU1:	MVI	C,LogicWidth/4 
  0572    1A             C      SCU0:	LDAX	D 
  0573    77             C      	MOV	M,A 
  0574    23             C      	INX	H 
  0575    13             C      	INX	D 
  0576    1A             C      	LDAX	D 
  0577    77             C      	MOV	M,A 
  0578    23             C      	INX	H 
  0579    13             C      	INX	D 
  057A    1A             C      	LDAX	D 
  057B    77             C      	MOV	M,A 
  057C    23             C      	INX	H 
  057D    13             C      	INX	D 
  057E    1A             C      	LDAX	D 
  057F    77             C      	MOV	M,A 
  0580    23             C      	INX	H 
  0581    13             C      	INX	D 
  0582    0D             C      	DCR	C 
  0583    C2 0572        C      	JNZ	SCU0 
  0586    39             C      	DAD	SP 
  0587    EB             C      	XCHG 
  0588    39             C      	DAD	SP 
  0589    EB             C      	XCHG 
  058A    05             C      	DCR	B 
  058B    C2 0570        C      	JNZ	SCU1 
  058E    2A 153A        C      	LHLD	PRSP 
  0591    F9             C      	SPHL 
  0592    C9             C      	RET 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-16


  0593    7E             C      NEXTST:	MOV	A,M 
  0594    FE FF          C      	CPI	0FFH 
  0596    C8             C      	RZ 
  0597    FE 0D          C      	CPI	0DH 
  0599    CA 05A0        C      	JZ	NXTS0 
  059C    23             C      	INX	H 
  059D    C3 0593        C      	JMP	NEXTST 
  05A0    23             C      NXTS0:	INX	H 
  05A1    7E             C      	MOV	A,M 
  05A2    FE FF          C      	CPI	0FFH 
  05A4    C9             C      	RET 
                         C       
  05A5    D5             C      wwerh:	PUSH	D 
  05A6    2A 1E22        C      	LHLD	STRADR 
  05A9    CD 0602        C      	CALL	PREVST 
  05AC    D1             C      	POP	D 
  05AD    22 1E22        C      	SHLD	STRADR 
  05B0    C8             C      	RZ 
  05B1    CD 02E1        C      	CALL	DCRCUR 
  05B4    3A 1E2B        C      	LDA	CURY 
  05B7    3D             C      	DCR	A 
  05B8    CA 05D4        C      	JZ	ROLLDN 
  05BB    32 1E2B        C      	STA	CURY 
  05BE    C3 046E        C      	JMP	CURSM 
                         C       
                         C       
  05C1    2A 1E20        C      RLDN:	LHLD	SCRADR 
  05C4    CD 0602        C      	CALL	PREVST 
  05C7    C8             C      	RZ 
  05C8    2A 1E22        C      	LHLD	STRADR 
  05CB    CD 0602        C      	CALL	PREVST 
  05CE    22 1E22        C      	SHLD	STRADR 
  05D1    CD 02E1        C      	CALL	DCRCUR 
  05D4    2A 1E20        C      ROLLDN:	LHLD	SCRADR 
  05D7    CD 0602        C      	CALL	PREVST 
  05DA    22 1E20        C      	SHLD	SCRADR 
  05DD    C8             C      	RZ 
  05DE    E5             C      	PUSH	H 
  05DF    CD 0518        C      	CALL	SCRDN 
  05E2    2A 1E24        C      	LHLD	SCRBEG 
  05E5    EB             C      	XCHG 
  05E6    E1             C      	POP	H 
  05E7    EB             C      	xCHG 
  05E8    3A 1E2C        C      	lda	DISPOS 
  05EB    CD 14BB        C      	CALL	DISSTR 
                         C       
  05EE    21 1E2D        C      	LXI	H,?END 
  05F1    7E             C      	MOV	A,M 
  05F2    B7             C      	ORA	A 
  05F3    CA 05F8        C      	JZ	RLD0 
  05F6    35             C      	DCR	M 
  05F7    C9             C      	RET 
  05F8    2A 1E06        C      RLD0:	LHLD	SCREND 
  05FB    CD 0602        C      	CALL	PREVST 
  05FE    22 1E06        C      	SHLD	SCREND 
  0601    C9             C      	RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-17


                         C       
  0602    2B             C      PREVST:	DCX	H 
  0603    3A 1E01        C      	LDA	nivgr+1 
  0606    3D             C      	DCR	A 
  0607    BC             C      	CMP	H 
  0608    CA 061F        C      	JZ	PREVS0 
  060B    2B             C      PREVS1:	DCX	H 
  060C    3A 1E01        C      	LDA	nivgr+1 
  060F    3D             C      	DCR	A 
  0610    BC             C      	CMP	H 
  0611    CA 061A        C      	JZ	PREVS2 
  0614    7E             C      	MOV	A,M 
  0615    FE 0D          C      	CPI	0DH 
  0617    C2 060B        C      	JNZ	PREVS1 
  061A    3E 01          C      PREVS2:	MVI	A,1 
  061C    B7             C      	ORA	A 
  061D    23             C      	INX	H 
  061E    C9             C      	RET 
                         C       
  061F    2A 1E00        C      PREVS0:	LHLD	nivgr 
  0622    C9             C      	RET 
                         C       
                         C       
  0623                   C      SETRST: 
  0623    3E 01          C      	mvi	a,1 
  0625    32 1E3B        C      	sta	?StringBufActive 
  0628    21 1E7D        C      	LXI	H,STRRED 
  062B    22 1E3D        C      	SHLD	TABSRH 
  062E    2A 1E22        C      	LHLD	STRADR 
  0631    11 1E7D        C      	LXI	D,STRRED 
  0634    06 80          C      	MVI	B,MAXLEN+1 
  0636    0E 00          C      	MVI	C,0 
  0638    7E             C      I00:	MOV	A,M 
  0639    12             C      	STAX	D 
  063A    23             C      	INX	H 
  063B    13             C      	INX	D 
  063C    0C             C      	INR	C 
  063D    FE 0D          C      	CPI	0DH 
  063F    CA 064F        C      	JZ	I01 
  0642    FE FF          C      	CPI	0FFH 
  0644    CA 064F        C      	JZ	I01 
  0647    05             C      	DCR	B 
  0648    C2 0638        C      	JNZ	I00 
  064B    3E 0D          C      	MVI	A,0DH 
  064D    12             C      	STAX	D 
  064E    0C             C      	INR	C 
  064F    79             C      I01:	MOV	A,C 
  0650    32 1E19        C      	STA	OLDMES 
  0653    32 1E1A        C      	STA	NEWMES 
  0656    2A 1E24        C      	LHLD	SCRBEG 
  0659    3A 1E2B        C      	LDA	CURY 
  065C    3D             C      	DCR	A 
  065D    CA 0668        C      	JZ	I02 
  0660    01 004E        C      	LXI	B,ScrWidth 
  0663    09             C      I03:	DAD	B 
  0664    3D             C      	DCR	A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-18


  0665    C2 0663        C      	JNZ	I03 
  0668    22 1E04        C      I02:	SHLD	VDADR 
  066B    2A 1E0C        C      	LHLD	BLBEG 
  066E    22 1E10        C      	SHLD	OLDBLB 
  0671    CD 0A21        C      	CALL	CHKPNT 
  0674    3E 00          C      	MVI	A,0 
  0676    DA 067A        C      	JC	$+4 
  0679    2F             C      	CMA 
  067A    32 1E14        C      	STA	BEGCOR 
  067D    2A 1E0E        C      	LHLD	BLEND 
  0680    22 1E12        C      	SHLD	OLDBLE 
  0683    CD 0A21        C      	CALL	CHKPNT 
  0686    3E 00          C        	MVI	A,0 
  0688    DA 068C        C      	JC	$+4 
  068B    2F             C      	CMA 
  068C    32 1E15        C      	STA	ENDCOR 
  068F    C9             C      	RET 
                         C       
  0690    AF             C      INSRED:	xra	a 
  0691    32 1E3B        C      	sta	?StringBufActive 
  0694    3A 1E1A        C      	LDA	NEWMES 
  0697    3D             C      	DCR	A 
  0698    CD 0A39        C      	CALL	CAD1 
  069B    3C             C      	INR	A 
  069C    47             C      	MOV	B,A 
  069D    2B             C      I08:	DCX	H 
  069E    05             C      	DCR	B 
  069F    CA 06AD        C      	JZ	I09 
  06A2    7E             C      	MOV	A,M 
  06A3    FE 20          C      	CPI	20H 
  06A5    CA 069D        C      	JZ	I08 
  06A8    FE 09          C      	CPI	9 
  06AA    CA 069D        C      	JZ	I08 
  06AD    23             C      I09:	INX	H 
  06AE    36 0D          C      	MVI	M,0DH 
  06B0    78             C      	MOV	A,B 
  06B1    3C             C      	INR	A 
  06B2    32 1E1A        C      	STA	NEWMES 
  06B5    3A 1E19        C      INSR1:	LDA	OLDMES 
  06B8    4F             C      	MOV	C,A 
  06B9    3A 1E1A        C      	LDA	NEWMES 
  06BC    91             C      	SUB	C 
  06BD    CA 06E6        C      	JZ	I04 
  06C0    06 00          C      	MVI	B,0 
  06C2    D2 06C7        C      	JNC	$+5 
  06C5    06 FF          C      	MVI	B,-1 
  06C7    4F             C      	MOV	C,A 
  06C8    F5             C      	PUSH	PSW 
  06C9    C5             C      	PUSH	B 
  06CA    2A 1E06        C      	LHLD	SCREND 
  06CD    09             C      	DAD	B 
  06CE    22 1E06        C      	SHLD	SCREND 
  06D1    3A 1E19        C      	LDA	OLDMES 
  06D4    CD 0A45        C      	CALL	CADR11 
  06D7    C1             C      	POP	B 
  06D8    E5             C      	PUSH	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-19


  06D9    09             C      	DAD	B 
  06DA    C1             C      	POP	B 
  06DB    54             C      	MOV	D,H 
  06DC    5D             C      	MOV	E,L 
  06DD    F1             C      	POP	PSW 
  06DE    F5             C      	PUSH	PSW 
  06DF    D4 06FB        C      	CNC	UPSHT 
  06E2    F1             C              POP	PSW 
  06E3    DC 0712        C      	CC	DNSHT 
                         C       
  06E6    2A 1E22        C      I04:	LHLD	STRADR 
  06E9    11 1E7D        C      	LXI	D,STRRED 
  06EC    3A 1E1A        C      	LDA	NEWMES 
  06EF    47             C      	MOV	B,A 
  06F0    B7             C      	ORA	A 
  06F1    C8             C      	RZ 
  06F2    1A             C      I06:	LDAX	D 
  06F3    77             C      	MOV	M,A 
  06F4    23             C      	INX	H 
  06F5    13             C      	INX	D 
  06F6    05             C      	DCR	B 
  06F7    C2 06F2        C      	JNZ	I06 
  06FA    C9             C      	RET 
                         C       
  06FB    CD 0728        C      UPSHT:	CALL	COMPADR 
  06FE    03             C      U1:	INX	B 
  06FF    23             C      	INX	H 
  0700    2B             C      U0:	DCX	H 
  0701    0B             C      	DCX	B 
  0702    0A             C      	LDAX	B 
  0703    77             C      	MOV	M,A 
  0704    7A             C      	MOV	A,D 
  0705    BC             C      	CMP	H 
  0706    C2 0700        C      	JNZ	U0 
  0709    7B             C      	MOV	A,E 
  070A    BD             C      	CMP	L 
  070B    C2 0700        C      	JNZ	U0 
  070E    C2 0700        C      	JNZ	U0 
  0711    C9             C      	RET 
                         C       
  0712    C5             C      DNSHT:	PUSH	B 
  0713    CD 0728        C      	CALL	COMPADR 
  0716    C1             C      	POP	B 
  0717    0B             C      D1:	DCX	B 
  0718    1B             C      	DCX	D 
  0719    03             C      D0:	INX	B 
  071A    13             C      	INX	D 
  071B    0A             C      	LDAX	B 
  071C    12             C      	STAX	D 
  071D    7C             C      	MOV	A,H 
  071E    BA             C      	CMP	D 
  071F    C2 0719        C      	JNZ	D0 
  0722    7D             C      	MOV	A,L 
  0723    BB             C      	CMP	E 
  0724    C2 0719        C      	JNZ	D0 
  0727    C9             C      	RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-20


                         C       
  0728    C5             C      COMPADR:PUSH	B 
  0729    78             C      	MOV	A,B 
  072A    2F             C      	CMA 
  072B    47             C      	MOV	B,A 
  072C    79             C      	MOV	A,C 
  072D    2F             C      	CMA 
  072E    4F             C      	MOV	C,A 
  072F    03             C      	INX	B 
  0730    62             C      	MOV	H,D 
  0731    6B             C      	MOV	L,E 
  0732    09             C      	DAD	B 
  0733    C1             C      	POP	B 
  0734    E5             C      	PUSH	H 
  0735    D5             C      	PUSH	D 
  0736    50             C      	MOV	D,B 
  0737    59             C      	MOV	E,C 
  0738    44             C      	MOV	B,H 
  0739    4D             C      	MOV	C,L 
  073A    2A 1E0C        C      	LHLD	BLBEG 
  073D    CD 07B9        C      	CALL	CORPNT 
  0740    3A 1E14        C      	LDA	BEGCOR 
  0743    B7             C      	ORA	A 
  0744    C2 074A        C      	JNZ	$+6 
  0747    22 1E0C        C      	SHLD	BLBEG 
  074A    2A 1E0E        C      	LHLD	BLEND 
  074D    CD 07B9        C      	CALL	CORPNT 
  0750    3A 1E15        C      	LDA	ENDCOR 
  0753    B7             C      	ORA	A 
  0754    C2 075A        C      	JNZ	$+6 
  0757    22 1E0E        C      	SHLD	BLEND 
  075A    2A 1E30        C      	LHLD	STRAD0 
  075D    CD 07B9        C      	CALL	CORPNT 
  0760    22 1E30        C      	SHLD	STRAD0 
  0763    2A 1E2E        C      	LHLD	SCRAD0 
  0766    CD 07B9        C      	CALL	CORPNT 
  0769    22 1E2E        C      	SHLD	SCRAD0 
  076C    AF             C      	XRA	A 
  076D    32 1E14        C      	STA	BEGCOR 
  0770    32 1E15        C      	STA	ENDCOR 
  0773    D1             C      	POP	D 
  0774    E1             C      	POP	H 
  0775    D5             C      	PUSH	D 
  0776    EB             C      	XCHG 
  0777    2A 1E02        C      	LHLD	werhgr 
  077A    E5             C      	PUSH	H 
  077B    CD 0785        C      	CALL	CHKMEM 
  077E    19             C      	DAD	D 
  077F    22 1E02        C      	SHLD	werhgr 
  0782    C1             C      	POP	B 
  0783    D1             C      	POP	D 
  0784    C9             C      	RET 
                         C       
  0785    E5             C      CHKMEM:	PUSH	H 
  0786    21 8000        C      	LXI	H,8000H 
  0789    CD 07D8        C      	CALL	CDEHL 
	MACRO-80 3.44	09-Dec-81	PAGE	1-21


  078C    E1             C      	POP	H 
  078D    D8             C      	RC 
  078E    E5             C      	PUSH	H 
  078F    CD 1099        C      	CALL	INV_H 
  0792    D5             C      	PUSH	D 
  0793    EB             C      	XCHG 
  0794    CD 0243        C      	CALL	MAXRAM 
  0797    19             C      	DAD	D 
  0798    D1             C      	POP	D 
  0799    CD 07D8        C      	CALL	CDEHL 
  079C    E1             C      	POP	H 
  079D    D0             C      	RNC 
  079E    CD 0CB0        C      	CALL	CLRSTR 
  07A1    CD 133F        C      	CALL	INFPR 
  07A4    0028           C      	DW	40 
  07A6    4F 55 54 20    C      	DC	'OUT OF MEMORY' 
  07AA    4F 46 20 4D    C      
  07AE    45 4D 4F 52    C      
  07B2    D9             C      
  07B3    CD 16EC        C      	CALL	GETCHR 
  07B6    C3 0239        C      	JMP	OUT1 
                         C       
  07B9    78             C      CORPNT:	MOV	A,B 
  07BA    B7             C      	ORA	A 
  07BB    F2 07D2        C      	JP	CRPNT0 
  07BE    CD 07D8        C      	CALL	CDEHL 
  07C1    D2 07D6        C      	JNC	CRPNT1 
  07C4    D5             C      	PUSH	D 
  07C5    EB             C      	XCHG 
  07C6    09             C      	DAD	B 
  07C7    EB             C      	XCHG 
  07C8    CD 07D8        C      	CALL	CDEHL 
  07CB    DA 07D0        C      	JC	CRPNT2 
  07CE    62             C              MOV	H,D 
  07CF    6B             C      	MOV	L,E 
  07D0    D1             C      CRPNT2:	POP	D 
  07D1    C9             C      	RET 
                         C       
  07D2    CD 07D8        C      CRPNT0:	CALL	CDEHL 
  07D5    D8             C      	RC 
  07D6    09             C      CRPNT1:	DAD	B 
  07D7    C9             C      	RET 
                         C       
  07D8    7C             C      CDEHL:	MOV	A,H 
  07D9    BA             C      	CMP	D 
  07DA    C0             C      	RNZ 
  07DB    7D             C      	MOV	A,L 
  07DC    BB             C      	CMP	E 
  07DD    C9             C      	RET 
  07DE    C1             C      LFTM::	POP	B 
  07DF    CD 03BC        C      	CALL	wlewo 
  07E2    C3 0822        C      	JMP	RED 
                         C       
  07E5    C1             C      RHTM::	POP	B 
  07E6    CD 03C7        C      	CALL	wprawo 
  07E9    C3 0822        C      	JMP	RED 
	MACRO-80 3.44	09-Dec-81	PAGE	1-22


                         C       
  07EC    CD 0690        C      UPM::	CALL	INSRED 
  07EF    CD 05A5        C      	CALL	wwerh 
  07F2    C3 023C        C      	JMP	OUT3 
                         C       
  07F5    CD 0690        C      DWNM::	CALL	INSRED 
  07F8    CD 04BB        C      	CALL	wniz 
  07FB    C3 023C        C      	JMP	OUT3 
                         C       
  07FE                   C      SCRLUP:: 
  07FE    CD 0690        C      	CALL	INSRED 
  0801    CD 05C1        C      	CALL	RLDN 
  0804    C3 023C        C      	JMP	OUT3 
                         C       
  0807                   C      SCRLDN:: 
  0807    CD 0690        C      	CALL	INSRED 
  080A    CD 04DD        C      	CALL	RLUP 
  080D    C3 023C        C      	JMP	OUT3 
                         C       
                         C       
  0810    F5             C      SETC:	PUSH	PSW 
  0811    CD 03E2        C      	CALL	GETC 
  0814    32 1E2A        C      	STA	CURX 
  0817    CD 041C        C      	CALL	CURCM 
  081A    F1             C      	POP	PSW 
  081B    C9             C      	RET 
                         C       
                         C       
  081C    CD 019B        C      M03:	CALL	SETINF 
  081F    CD 0623        C      	CALL	SETRST 
                         C       
  0822    CD 02BE        C      RED::	CALL	DISCUR 
  0825    CD 1697        C      	CALL	GETCHC 
                         C       
  0828    78             C      	MOV	A,B 
  0829    E6 40          C      	ANI	40H ; Ctrl flag 
  082B    C2 0839        C      	JNZ	ANDR 
                         C       
  082E    79             C      	MOV	A,C ; All control symbols are less than 20h except for Backspace - 7Fh 
  082F    FE 7F          C      	CPI	7fH 
  0831    CA 0839        C      	jz	ANDR 
                         C      	 
  0834    FE 20          C      	CPI	20H 
  0836    D2 0935        C      	JNC	PRCHR 
                         C       
  0839    48             C      ANDR:	MOV	C,B 
                         C       
  083A    11 0938        C      	lxi	d,DISALL 
  083D    D5             C      	PUSH	d 
                         C       
  083E    06 00          C      	MVI	B,0 
  0840    21 1989        C      	LXI	H,CMDTBL 
  0843    CD 1A4B        C      	CALL	FNDCMD 
                         C       
  0846    E5             C      	PUSH	H 
  0847    C5             C      	PUSH	B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-23


  0848    CD 0810        C      	CALL	SETC 
  084B    C1             C      	POP	B 
  084C    E1             C      	POP	H 
                         C       
  084D    CD 1A4B        C              CALL	FNDCMD 
                         C       
  0850    D1             C      	pop	d 
  0851    11 0239        C      	LXI	d,OUT1 
  0854    D5             C      	PUSH	d 
                         C       
  0855    CD 1A4B        C      	CALL	FNDCMD 
  0858    E5             C      	PUSH	H 
  0859    C5             C      	PUSH	B 
  085A    CD 0690        C      	CALL	INSRED 
  085D    C1             C      	POP	B 
  085E    E1             C      	POP	H 
  085F    CD 1A4B        C      	CALL	FNDCMD 
  0862    E5             C      	PUSH	H 
  0863    2A 1E0E        C      	LHLD	BLEND 
  0866    EB             C      	XCHG 
  0867    2A 1E0C        C      	LHLD	BLBEG 
  086A    CD 07D8        C      	CALL	CDEHL 
  086D    E1             C      	POP	H 
  086E    DC 1A4B        C      	CC	FNDCMD 
  0871    C9             C      	RET 
                         C       
  0872    EB             C      DELCOR:	XCHG 
  0873    CD 0A0C        C      	CALL	COR 
  0876    D8             C      	RC 
  0877    2B             C      	DCX	H 
  0878    C9             C      	RET 
                         C       
                         C       
  0879    3A 1E2A        C      LDEL::	LDA	CURX 
  087C    3D             C      	DCR	A 
  087D    C8             C      	RZ 
  087E    32 1E2A        C      	STA	CURX 
  0881    CD 0810        C      	CALL	SETC 
                         C       
  0884    CD 099C        C      RDEL::	CALL	FILSP 
  0887    CD 0A35        C      	CALL	CAD 
  088A    7E             C      	MOV	A,M 
  088B    FE 0D          C      	CPI	0DH 
  088D    C8             C      	RZ 
  088E    2B             C      	DCX	H 
  088F    7E             C      	MOV	A,M 
  0890    EB             C      	XCHG 
  0891    D5             C      	PUSH	D 
  0892    13             C      	INX	D 
  0893    42             C      	MOV	B,D 
  0894    4B             C      	MOV	C,E 
  0895    D1             C      	POP	D 
  0896    21 1EFB        C      	LXI	H,STRRED+MAXLEN-1 
  0899    CD 0719        C      	CALL	D0 
  089C    21 0872        C      	LXI	H,DELCOR 
  089F    CD 09E2        C      	CALL	CORRECT 
	MACRO-80 3.44	09-Dec-81	PAGE	1-24


  08A2    3A 1E1A        C      	LDA	NEWMES 
  08A5    3D             C      	DCR	A 
  08A6    32 1E1A        C      	STA	NEWMES 
  08A9    C9             C      	RET 
                         C       
  08AA                   C      REPMOD:: 
  08AA    3A 1E1B        C      	LDA	MODE 
  08AD    FE 93          C      	CPI	93H 
  08AF    CA 1030        C      	JZ	INSERT 
  08B2    C3 103A        C      	JMP	OVRW 
                         C       
                         C       
  08B5    CD 0690        C      BSC::	CALL	INSRED 
  08B8    CD 0B84        C      	CALL	BSCR 
  08BB    C3 023C        C      	JMP	OUT3 
                         C       
  08BE    CD 0904        C      TAB::	CALL	PRCH0 
                         C      ;	CALL	wprawo 
  08C1    3A 1E2A        C      	LDA	CURX 
  08C4    3D             C      	dcr	a 
  08C5    CD 0457        C      	call	CalcNextTabPos 
  08C8    32 1E2A        C      	STA	CURX 
  08CB    C9             C      	RET 
                         C       
  08CC    2A 1E10        C      REST::	LHLD	OLDBLB 
  08CF    22 1E0C        C      	SHLD	BLBEG 
  08D2    2A 1E12        C      	LHLD	OLDBLE 
  08D5    22 1E0E        C      	SHLD	BLEND 
  08D8    C3 0239        C      	JMP	OUT1 
                         C       
                         C       
  08DB    CD 0690        C      CR::	CALL	INSRED 
  08DE    2A 1E20        C      	LHLD	SCRADR 
  08E1    EB             C      	XCHG 
  08E2    3E 01          C      	MVI	A,1 
  08E4    32 1E2A        C      	STA	CURX 
  08E7    CD 032B        C      	CALL	DISPLY 
  08EA    CD 04BB        C      CR0:	CALL	wniz 
  08ED    FE FF          C      	CPI	0FFH 
  08EF    C2 0239        C      	JNZ	OUT1 
  08F2    36 0D          C      	MVI	M,0DH 
  08F4    23             C      	INX	H 
  08F5    36 FF          C      	MVI	M,0FFH 
  08F7    22 1E02        C      	SHLD	werhgr 
  08FA    2A 1E08        C      	LHLD	NUMSTR 
  08FD    23             C      	INX	H 
  08FE    22 1E08        C      	SHLD	NUMSTR 
  0901    C3 08EA        C      	JMP	CR0 
                         C       
  0904    32 1E42        C      PRCH0:	STA	SYM 
  0907    21 1E7D        C      	LXI	H,STRRED 
  090A    CD 099C        C      	CALL	FILSP 
  090D    CD 0A35        C      	CALL	CAD 
  0910    3A 1E1B        C      	LDA	MODE 
  0913    FE 93          C      	CPI	93H 
  0915    CA 0921        C      	JZ	PRC00 
	MACRO-80 3.44	09-Dec-81	PAGE	1-25


  0918    3A 1E1A        C      	LDA	NEWMES 
  091B    FE 80          C      	CPI	MAXLEN+1 
  091D    D0             C      	RNC 
  091E    CD 09BA        C      	CALL	INSSYM 
  0921    CD 0993        C      PRC00:	CALL	?OUT 
  0924    CC 09BA        C      	CZ	INSSYM 
  0927    E5             C      	push	h 
  0928    CD 03C7        C      	CALL	wprawo 
  092B    E1             C      	pop	h 
  092C    3A 1E42        C      	LDA	SYM 
  092F    77             C      	MOV	M,A 
  0930    C9             C      	RET 
                         C       
  0931                   C      INSCTRL:: 
  0931    C1             C      	POP	B 
  0932    CD 16EC        C      	CALL	GETCHR 
                         C       
  0935    CD 0904        C      PRCHR:	CALL	PRCH0 
                         C      ;	CALL	SETC 
                         C      ;	CALL	wprawo 
  0938    CD 0810        C      DISALL:	CALL	SETC 
  093B    11 1E7D        C      	LXI	D,STRRED 
  093E    2A 1E04        C      	LHLD	VDADR 
  0941    3A 1E2C        C      	lda	DISPOS 
  0944    CD 14BB        C      	CALL	DISSTR 
  0947    CD 02BE        C      	CALL	DISCUR 
  094A    3A 1E33        C      	LDA	SCRBG0+1 
  094D    B7             C      	ORA	A 
  094E    CA 0822        C      	JZ	RED 
  0951    2A 1E2E        C      	LHLD	SCRAD0 
  0954    EB             C      	XCHG 
  0955    2A 1E32        C      	LHLD	SCRBG0 
  0958    3A 1E36        C      	LDA	YSIZE0 
  095B    47             C      	MOV	B,A 
  095C    3A 1E22        C      DIS00:	LDA	STRADR 
  095F    BB             C      	CMP	E 
  0960    C2 0981        C      	JNZ	DIS01 
  0963    3A 1E23        C      	LDA	STRADR+1 
  0966    BA             C      	CMP	D 
  0967    C2 0981        C      	JNZ	DIS01 
  096A    11 1E7D        C      	LXI	D,STRRED 
  096D    3A 1E2C        C      	LDA	DISPOS 
  0970    F5             C      	PUSH	PSW 
  0971    3A 1E3A        C      	LDA	DISPS0 
  0974    32 1E2C        C      	STA	DISPOS 
  0977    CD 14BB        C      	CALL	DISSTR 
  097A    F1             C      	POP	PSW 
  097B    32 1E2C        C      	STA	DISPOS 
  097E    C3 0822        C      	JMP	RED 
  0981    EB             C      DIS01:	XCHG 
  0982    CD 0593        C      	CALL	NEXTST 
  0985    EB             C      	XCHG 
  0986    C5             C      	PUSH	B 
  0987    01 004E        C      	LXI	B,ScrWidth 
  098A    09             C      	DAD	B 
  098B    C1             C      	POP	B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-26


  098C    05             C      	DCR	B 
  098D    C2 095C        C      	JNZ	DIS00 
  0990    C3 0822        C      	JMP	RED 
                         C       
  0993    CD 03E2        C      ?OUT:	CALL	GETC 
  0996    47             C      	MOV	B,A 
  0997    3A 1E1A        C      	LDA	NEWMES 
  099A    90             C      	SUB	B 
  099B    C9             C      	RET 
                         C       
  099C    CD 0993        C      FILSP:	CALL	?OUT 
  099F    D0             C      	RNC 
  09A0    2F             C      	CMA 
  09A1    C6 02          C      	ADI	2 
  09A3    F5             C      	PUSH	PSW 
  09A4    CD 0A35        C      	CALL	CAD 
  09A7    F1             C      	POP	PSW 
  09A8    23             C      	INX	H 
  09A9    36 0D          C      	MVI	M,0DH 
  09AB    2B             C      RED2:	DCX	H 
  09AC    36 20          C      	MVI	M,20H 
  09AE    3D             C      	DCR	A 
  09AF    C2 09AB        C      	JNZ	RED2 
  09B2    CD 03E2        C      	CALL	GETC 
  09B5    3C             C      	INR	A 
  09B6    32 1E1A        C      	STA	NEWMES 
  09B9    C9             C      	RET 
                         C       
  09BA    E5             C      INSSYM:	PUSH	H 
  09BB    CD 0A35        C      	CALL	CAD 
  09BE    23             C      	INX	H 
  09BF    EB             C      	XCHG 
  09C0    21 1EFD        C      	LXI	H,STRRED+MAXLEN+1 
  09C3    01 1EFC        C      	LXI	B,STRRED+MAXLEN 
  09C6    CD 06FE        C      	CALL	U1 
  09C9    3A 1E1A        C      	LDA	NEWMES 
  09CC    3C             C      	INR	A 
  09CD    FE 81          C      	CPI	MAXLEN+2 
  09CF    D2 09D5        C      	JNC	$+6 
  09D2    32 1E1A        C      	STA	NEWMES 
  09D5    3E 0D          C      	MVI	A,0DH 
  09D7    32 1EFC        C      	STA	STRRED+MAXLEN 
  09DA    21 0A1A        C      	LXI	H,INSCOR 
  09DD    CD 09E2        C      	CALL	CORRECT 
  09E0    E1             C      	POP	H 
  09E1    C9             C      	RET 
                         C       
  09E2    E5             C      CORRECT:	PUSH	H 
  09E3    EB             C      	XCHG 
  09E4    2A 1E0C        C      	LHLD	BLBEG 
  09E7    EB             C      	XCHG 
  09E8    CD 0A0B        C      	CALL	CORR 
  09EB    3A 1E14        C      	LDA	BEGCOR 
  09EE    B7             C      	ORA	A 
  09EF    CA 09F5        C      	JZ	$+6 
  09F2    22 1E0C        C      	SHLD	BLBEG 
	MACRO-80 3.44	09-Dec-81	PAGE	1-27


  09F5    E1             C      	POP	H 
  09F6    EB             C      	XCHG 
  09F7    D5             C      	PUSH	D 
  09F8    2A 1E0E        C      	LHLD	BLEND 
  09FB    EB             C      	XCHG 
  09FC    CD 0A0B        C      	CALL	CORR 
  09FF    3A 1E15        C      	LDA	ENDCOR 
  0A02    B7             C      	ORA	A 
  0A03    CA 0A09        C      	JZ	$+6 
  0A06    22 1E0E        C      	SHLD	BLEND 
  0A09    D1             C      	POP	D 
  0A0A    C9             C       	RET 
                         C       
  0A0B    E9             C      CORR:	PCHL 
                         C       
  0A0C    E5             C      COR:	PUSH	H 
  0A0D    CD 0A21        C      	CALL	CHKPNT 
  0A10    E1             C      	POP	H 
  0A11    D8             C      	RC 
  0A12    EB             C      	XCHG 
  0A13    CD 0A41        C      	CALL	CADR1 
  0A16    EB             C      	XCHG 
  0A17    C3 07D8        C      	JMP	CDEHL 
                         C       
  0A1A    EB             C      INSCOR:	XCHG 
  0A1B    CD 0A0C        C      	CALL	COR 
  0A1E    D8             C      	RC 
  0A1F    23             C      	INX	H 
  0A20    C9             C      	RET 
                         C       
  0A21    EB             C      CHKPNT:	XCHG 
  0A22    2A 1E22        C      	LHLD	STRADR 
  0A25    2B             C      	DCX	H 
  0A26    CD 07D8        C      	CALL	CDEHL 
  0A29    3F             C      	CMC 
  0A2A    D8             C      	RC 
  0A2B    3A 1E1A        C      	LDA	NEWMES 
  0A2E    3D             C      	DCR	A 
  0A2F    CD 0A45        C      	CALL	CADR11 
  0A32    C3 07D8        C      	JMP	CDEHL 
                         C       
  0A35    CD 03E2        C      CAD:	CALL	GETC 
  0A38    3D             C      	DCR	A 
  0A39    06 00          C      CAD1:	MVI	B,0 
  0A3B    4F             C      	MOV	C,A 
  0A3C    21 1E7D        C      	LXI	H,STRRED 
  0A3F    09             C      	DAD	B 
  0A40    C9             C      	RET 
                         C       
  0A41    CD 03E2        C      CADR1:	CALL	GETC 
  0A44    3D             C      	DCR	A 
  0A45    06 00          C      CADR11:	MVI	B,0 
  0A47    4F             C      	MOV	C,A 
  0A48    2A 1E22        C      	LHLD	STRADR 
  0A4B    09             C      	DAD	B 
  0A4C    C9             C      	RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-28


                         C       
                         C       
  0A4D                   C      SWPWIN:: 
  0A4D    CD 0A56        C      	CALL	SWPWN 
  0A50    2A 1E22        C      	LHLD	STRADR 
  0A53    C3 1288        C      	JMP	DISADR 
                         C       
  0A56    3A 1E33        C      SWPWN:	LDA	SCRBG0+1 
  0A59    B7             C      	ORA	A 
  0A5A    C8             C      	RZ 
  0A5B    CD 11AF        C      	CALL	SETST0 
  0A5E    21 1E20        C      	LXI	H,SCRADR 
  0A61    11 1E2E        C      	LXI	D,SCRAD0 
  0A64    0E 0E          C      	MVI	C,14 
  0A66    46             C      SWPW0:	MOV	B,M 
  0A67    1A             C      	LDAX	D 
  0A68    77             C      	MOV	M,A 
  0A69    78             C      	MOV	A,B 
  0A6A    12             C      	STAX	D 
  0A6B    23             C      	INX	H 
  0A6C    13             C      	INX	D 
  0A6D    0D             C      	DCR	C 
  0A6E    C2 0A66        C      	JNZ	SWPW0 
  0A71    3A 1E3C        C      	LDA	?WIN1 
  0A74    2F             C      	CMA 
  0A75    32 1E3C        C      	STA	?WIN1 
  0A78    3E 01          C      	MVI	A,1 
  0A7A    B7             C      	ORA	A 
  0A7B    C9             C      	RET 
                         C       
  0014                   C      YMAX	EQU	LogicHeight-3 
  0002                   C      YMIN	EQU	2 
                         C       
  0A7C    3A 1E33        C      WINUP::	LDA	SCRBG0+1 
  0A7F    B7             C      	ORA	A 
  0A80    C2 0AA4        C      	JNZ	WINU0 
  0A83    3E 14          C      	MVI	A,YMAX 
  0A85    32 1E28        C      	STA	YSIZE 
  0A88    3C             C      	INR	A 
  0A89    32 1E37        C      	STA	YBEG0 
  0A8C    3E 02          C      	MVI	A,YMIN 
  0A8E    32 1E36        C      	STA	YSIZE0 
  0A91    2A 1E26        C      	LHLD	INFADR 
  0A94    22 1E34        C      	SHLD	INFAD0 
  0A97    01 FF16        C      	LXI	B,-3*ScrWidth 
  0A9A    09             C      	DAD	B 
  0A9B    22 1E32        C      	SHLD	SCRBG0 
  0A9E    22 1E26        C      	SHLD	INFADR 
  0AA1    C3 0AD5        C      	JMP	WIN01 
  0AA4    3A 1E3C        C      WINU0:	LDA	?WIN1 
  0AA7    B7             C      	ORA	A 
  0AA8    C2 0AB4        C      	JNZ	WINU1 
  0AAB    CD 0A56        C      	CALL	SWPWN 
  0AAE    CD 0AB4        C      	CALL	WINU1 
  0AB1    C3 0A56        C      	JMP	SWPWN 
  0AB4    3A 1E28        C      WINU1:	LDA	YSIZE 
	MACRO-80 3.44	09-Dec-81	PAGE	1-29


  0AB7    FE 02          C      	CPI	YMIN 
  0AB9    CA 0AE7        C      	JZ	CLRW1 
  0ABC    3D             C      	DCR	A 
  0ABD    32 1E28        C      	STA	YSIZE 
  0AC0    21 1E36        C      	LXI	H,YSIZE0 
  0AC3    34             C      	INR	M 
  0AC4    21 1E37        C      	LXI	H,YBEG0 
  0AC7    35             C      	DCR	M 
  0AC8    2A 1E26        C      	LHLD	INFADR 
  0ACB    01 FFB2        C      	LXI	B,-ScrWidth 
  0ACE    09             C      	DAD	B 
  0ACF    22 1E32        C      	SHLD	SCRBG0 
  0AD2    22 1E26        C      	SHLD	INFADR 
  0AD5    3A 1E28        C      WIN01:	LDA	YSIZE 
  0AD8    47             C      	MOV	B,A 
  0AD9    3A 1E2B        C      	LDA	CURY 
  0ADC    B8             C      	CMP	B 
  0ADD    D8             C      	RC 
  0ADE    CD 05A5        C      	CALL	wwerh 
  0AE1    CD 04DD        C      	CALL	RLUP 
  0AE4    C3 0AD5        C      	JMP	WIN01 
                         C       
  0AE7    21 0000        C      CLRW1:	LXI	H,0 
  0AEA    22 1E24        C      	SHLD	SCRBEG 
  0AED    CD 0A4D        C      	CALL	SWPWIN 
  0AF0    3E FF          C      	MVI	A,0FFH 
  0AF2    32 1E3C        C      	STA	?WIN1 
  0AF5    C3 0266        C      	JMP	INIT 
                         C       
  0AF8    3A 1E33        C      WINDN::	LDA	SCRBG0+1 
  0AFB    B7             C      	ORA	A 
  0AFC    C2 0B30        C      	JNZ	WIND0 
  0AFF    AF             C      	XRA	A 
  0B00    32 1E37        C      	STA	YBEG0 
  0B03    32 1E3C        C      	STA	?WIN1 
  0B06    3E 14          C      	MVI	A,YMAX 
  0B08    32 1E28        C      	STA	YSIZE 
  0B0B    2A 0103        C      	LHLD	VRAM_ADR 
  0B0E    22 1E32        C      	SHLD	SCRBG0 
  0B11    3E 02          C      	MVI	A,YMIN 
  0B13    32 1E36        C      	STA	YSIZE0 
  0B16    3C             C      	INR	A 
  0B17    32 1E29        C      	STA	YBEG 
  0B1A    2A 0103        C      	LHLD	VRAM_ADR 
  0B1D    11 00EA        C      	LXI	D, 3*ScrWidth 
  0B20    19             C      	DAD	D 
  0B21    22 1E34        C      	SHLD	INFAD0 
  0B24    22 1E24        C      	SHLD	SCRBEG 
  0B27    CD 1335        C      	CALL	GETINFADR 
  0B2A    22 1E26        C      	SHLD	INFADR 
  0B2D    C3 0B61        C      	JMP	WIND01 
  0B30    3A 1E3C        C      WIND0:	LDA	?WIN1 
  0B33    B7             C      	ORA	A 
  0B34    CA 0B40        C      	JZ	WIND1 
  0B37    CD 0A56        C      	CALL	SWPWN 
  0B3A    CD 0B40        C      	CALL	WIND1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-30


  0B3D    C3 0A56        C      	JMP	SWPWN 
  0B40    3A 1E28        C      WIND1:	LDA	YSIZE 
  0B43    FE 02          C      	CPI	YMIN 
  0B45    CA 0B73        C      	JZ	CLRWD1 
  0B48    3D             C      	DCR	A 
  0B49    32 1E28        C      	STA	YSIZE 
  0B4C    21 1E36        C      	LXI	H,YSIZE0 
  0B4F    34             C      	INR	M 
  0B50    21 1E29        C      	LXI	H,YBEG 
  0B53    34             C      	INR	M 
  0B54    2A 1E34        C      	LHLD	INFAD0 
  0B57    01 004E        C      	LXI	B,ScrWidth 
  0B5A    09             C      	DAD	B 
  0B5B    22 1E24        C      	SHLD	SCRBEG 
  0B5E    22 1E34        C      	SHLD	INFAD0 
  0B61    3A 1E28        C      WIND01:	LDA	YSIZE 
  0B64    47             C      	MOV	B,A 
  0B65    3A 1E2B        C      	LDA	CURY 
  0B68    B8             C      	CMP	B 
  0B69    D8             C      	RC 
  0B6A    CD 05A5        C      	CALL	wwerh 
  0B6D    CD 04DD        C      	CALL	RLUP 
  0B70    C3 0B61        C      	JMP	WIND01 
                         C       
  0B73    21 0000        C      CLRWD1:	LXI	H,0 
  0B76    22 1E24        C      	SHLD	SCRBEG 
  0B79    CD 0A4D        C      	CALL	SWPWIN 
  0B7C    3E FF          C      	MVI	A,0FFH 
  0B7E    32 1E3C        C      	STA	?WIN1 
  0B81    C3 0266        C      	JMP	INIT 
                         C       
                         C       
  0B84    2A 1E20        C      BSCR:	LHLD	SCRADR 
  0B87    22 1E22        C      	SHLD	STRADR 
  0B8A    2A 1E2A        C      	LHLD	CURX 
  0B8D    7C             C      	MOV	A,H 
  0B8E    B5             C      	ORA	L 
  0B8F    3D             C      	DCR	A 
  0B90    C2 0BBC        C      	JNZ	CB1 
  0B93    21 0101        C      CB00:	LXI	H,0101H 
  0B96    22 1E2A        C      	SHLD	CURX 
  0B99    3A 1E28        C      	LDA	YSIZE 
  0B9C    D6 02          C      	SUI	2 
  0B9E    CA 046E        C      	JZ	CURSM 
  0BA1    47             C      	MOV	B,A 
  0BA2    2A 1E22        C      CB0:	LHLD	STRADR 
  0BA5    CD 0593        C      	CALL	NEXTST 
  0BA8    CA 046E        C      	JZ	CURSM 
  0BAB    22 1E22        C      	SHLD	STRADR 
  0BAE    CD 02D9        C      	CALL	INRCUR 
  0BB1    21 1E2B        C      	LXI	H,CURY 
  0BB4    34             C      	INR	M 
  0BB5    05             C      	DCR	B 
  0BB6    C2 0BA2        C      	JNZ	CB0 
  0BB9    C3 046E        C      	JMP	CURSM 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-31


  0BBC    3A 1E2B        C      CB1:	LDA	CURY 
  0BBF    21 0101        C      	LXI	H,101H 
  0BC2    22 1E2A        C      	SHLD	CURX 
  0BC5    2A 1E0A        C      	LHLD	CURSTR 
  0BC8    4F             C      	MOV	C,A 
  0BC9    0D             C      	DCR	C 
  0BCA    7D             C      	MOV	A,L 
  0BCB    91             C      	SUB	C 
  0BCC    77             C      	MOV	M,A 
  0BCD    D2 0BD1        C      	JNC	$+4 
  0BD0    2B             C      	DCX	H 
  0BD1    22 1E0A        C      	SHLD	CURSTR 
  0BD4    C3 046E        C      	JMP	CURSM 
                         C       
                         C       
                         C       
  0BD7    CD 0CB0        C      NEW::	CALL	CLRSTR 
  0BDA    CD 133F        C      	CALL	INFPR 
  0BDD    0021           C      	DW	33 
  0BDF    4E 45 57 20    C      	DC	'NEW Y/N:' 
  0BE3    59 2F 4E BA    C      
  0BE7    2A 1E2A        C      	LHLD	CURX 
  0BEA    E5             C      	PUSH	H 
  0BEB    21 192A        C      	LXI	H,(LogicHeight+2)*256+2AH 
  0BEE    22 1E2A        C      	SHLD	CURX 
  0BF1    CD 0465        C      	CALL	CURM 
  0BF4    CD 16EC        C      	CALL	GETCHR 
  0BF7    FE 59          C      	CPI	59H 
  0BF9    C2 0C0A        C      	JNZ	NEW1 
  0BFC    2A 1E00        C      	LHLD	nivgr 
  0BFF    36 0D          C      	MVI	M,0DH 
  0C01    23             C      	INX	H 
  0C02    36 FF          C      	MVI	M,0FFH 
  0C04    22 1E02        C      	SHLD	werhgr 
  0C07    C3 011D        C      	JMP	START 
  0C0A    E1             C      NEW1:	POP	H 
  0C0B    22 1E2A        C      	SHLD	CURX 
  0C0E    C3 046E        C      	JMP	CURSM 
                         C       
  0010                   C      kraj		EQU	16 
                         C       
  000F                   C      MaxStrLen	equ	15 
  0000                   C      @extend_key	equ	0 
  0001                   C      @backsp_key	equ	1 
  0003                   C      @exit_key	equ	3 
                         C       
  0C11                   C      Input_And_Show: 
  0C11    3E 01          C      	mvi	a,1 
  0C13    02             C      	stax	b 
  0C14    EB             C      	xchg 
                         C      	SetScrAddr 
  0C15                   C      @put_str: 
  0C15    1A             C      	ldax	d 
  0C16    B7             C      	ora	a 
  0C17    CA 0C43        C      	jz	move_curs 
                         C      	WriteNextSym 
	MACRO-80 3.44	09-Dec-81	PAGE	1-32


  0C1A    77             C+     		mov	m,a 
  0C1B    23             C+     		inx	h 
  0C1C    13             C      	inx	d 
  0C1D    0A             C      	ldax	b 
  0C1E    3C             C      	inr	a 
  0C1F    02             C      	stax	b 
  0C20    3A 1E2A        C      	lda	CURX 
  0C23    3C             C      	inr	a 
  0C24    32 1E2A        C      	sta	CURX 
  0C27    C3 0C15        C      	jmp	@put_str 
                         C       
  0C2A                   C      INPSTR: 
  0C2A    36 00          C      	MVI	M,0 
  0C2C    EB             C      	xchg 
  0C2D                   C      Edit_Line: 
  0C2D    3E 01          C      	MVI	A,1 
  0C2F    02             C      	STAX	B 
  0C30    3E 10          C      	MVI	A,kraj 
  0C32    32 1E2A        C      	STA	CURX 
  0C35    3E 19          C      	MVI	A,LogicHeight+2 
  0C37    32 1E2B        C      	STA	CURY 
  0C3A    2A 1E26        C      	LHLD	INFADR 
  0C3D    D5             C      	PUSH	D 
  0C3E    11 000F        C      	LXI	D,kraj-1 
  0C41    19             C      	DAD	D 
  0C42    D1             C      	POP	D 
  0C43                   C      move_curs: 
  0C43    CD 0465        C      	call	CURM 
  0C46                   C      Get_key: 
  0C46    CD 16EC        C      	CALL	GETCHR 
  0C49    FE 00          C      	CPI	@extend_key 
  0C4B    C2 0C54        C      	JNZ	No_extend 
  0C4E    CD 16EC        C      	CALL	GETCHR 
  0C51    C3 0C79        C      	JMP	Ins_sym 
                         C       
  0C54                   C      No_extend: 
  0C54    FE 0D          C      	CPI	0DH 
  0C56    CA 0C90        C      	jz	exit_inp_str 
  0C59    FE 03          C      	CPI	@exit_key 
  0C5B    CA 0C93        C      	JZ	IN4 
  0C5E    FE 01          C      	CPI	@backsp_key 
  0C60    C2 0C79        C      	JNZ	Ins_Sym 
                         C       
  0C63    0A             C      	LDAX	B 
  0C64    3D             C      	DCR	A 
  0C65    CA 0C46        C      	JZ	Get_Key 
  0C68    02             C      	STAX	B 
  0C69    2B             C      	dcx	h 
                         C      	SetScrAddr 
  0C6A    AF             C      	xra	a 
                         C      	WriteNextSym 
  0C6B    77             C+     		mov	m,a 
  0C6C    23             C+     		inx	h 
  0C6D    2B             C      	dcx	h 
                         C      	SetScrAddr 
  0C6E    1B             C      	dcx	d 
	MACRO-80 3.44	09-Dec-81	PAGE	1-33


  0C6F    3A 1E2A        C      	LDA	CURX 
  0C72    3D             C      	DCR	A 
  0C73    32 1E2A        C      	STA	CURX 
  0C76    C3 0C43        C      	jmp	move_curs 
                         C       
  0C79                   C      Ins_Sym: 
  0C79    12             C      	stax	d 
  0C7A    0A             C      	ldax	b 
  0C7B    FE 0F          C      	CPI	MaxStrLen 
  0C7D    CA 0C46        C      	JZ	Get_Key 
  0C80    3C             C      	inr	a 
  0C81    02             C      	stax	b 
  0C82    3A 1E2A        C      	LDA	CURX 
  0C85    3C             C      	INR	A 
  0C86    32 1E2A        C      	STA	CURX 
  0C89    1A             C      	ldax	d 
                         C      	WriteNextSym 
  0C8A    77             C+     		mov	m,a 
  0C8B    23             C+     		inx	h 
  0C8C    13             C      	inx	d 
  0C8D    C3 0C43        C      	jmp	move_curs 
                         C       
  0C90                   C      exit_inp_str: 
  0C90    AF             C      	xra	a 
  0C91    12             C      	stax	d 
  0C92    C9             C      	ret 
                         C       
  0C93    2A 1E22        C      IN4:	LHLD	STRADR 
  0C96    CD 1288        C      	CALL	DISADR 
  0C99    C3 0239        C      	JMP	OUT1 
                         C       
                         C       
                         C       
  0C9C    C5             C      LINE:	push	b 
                         C      	;LHLD	INFADR 
  0C9D    CD 1335        C      	CALL	GETINFADR 
  0CA0    01 FFB2        C      	LXI	B,-ScrWidth 
  0CA3    09             C      	DAD	B 
                         C      	SetScrAddr 
  0CA4    0E 40          C      	MVI	c,LogicWidth 
  0CA6    3E 1C          C      CLR1:	mvi	a,LineSym 
                         C      	WriteNextSym 
  0CA8    77             C+     		mov	m,a 
  0CA9    23             C+     		inx	h 
  0CAA    0D             C      	dcr	c 
  0CAB    C2 0CA6        C      	JNZ	CLR1 
  0CAE    C1             C      	pop	b 
  0CAF    C9             C      	RET 
                         C       
  0CB0    E5             C      CLRSTR:	PUSH	H 
  0CB1    F5             C      	PUSH	PSW 
  0CB2    C5             C      	push	b 
  0CB3    CD 0C9C        C      	CALL	LINE 
  0CB6    2A 0103        C      	LHLD	VRAM_ADR 
  0CB9    01 0750        C      	LXI	B,INFSTR_OFFS;-ScrWidth 
  0CBC    09             C      	DAD	B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-34


                         C      	SetScrAddr 
  0CBD    0E 40          C      	mvi	c,LogicWidth 
  0CBF    3E 20          C      CLR0:	mvi	a,space 
                         C      	writeNextSym 
  0CC1    77             C+     		mov	m,a 
  0CC2    23             C+     		inx	h 
  0CC3    0D             C      	dcr	c 
  0CC4    C2 0CBF        C      	JNZ	CLR0 
                         C       
  0CC7    CD 133F        C      	CALL	INFPR 
  0CCA    001E           C      	DW	30 
  0CCC    9B             C      	DB	DelimSym+80h 
                         C       
  0CCD    CD 133F        C      	CALL	INFPR 
  0CD0    0007           C      	DW	7 
  0CD2    9B             C      	DB	DelimSym+80h 
  0CD3    C1             C      	pop	b 
  0CD4    F1             C      	POP	PSW 
  0CD5    E1             C      	POP	H 
  0CD6    C9             C      	RET 
                         C       
  0CD7    CD 0CB0        C      INPSR:	CALL	CLRSTR 
  0CDA    CD 133F        C      	CALL	INFPR 
  0CDD    0008           C      	DW	8 
  0CDF    54 41 52 47    C      	DC	'TARGET:' 
  0CE3    45 54 BA       C      
  0CE6    21 1E61        C      	LXI	H,STRSR 
  0CE9    01 1E16        C      	LXI	B,SRMES 
  0CEC    C3 0C2A        C      	JMP	INPSTR 
                         C       
                         C       
  0CEF                   C      CONT_SRREP: 
  0CEF    3A 1E17        C      	LDA	RPMES 
  0CF2    B7             C      	ORA	A 
  0CF3    CA 0DF7        C      	JZ	CONT_SRH 
  0CF6    C3 0CF9        C      	JMP	RPREP0 
                         C       
  0CF9    CD 1061        C      RPREP0:	CALL	MARK 
  0CFC    C3 0D11        C      	JMP	RPREP1 
                         C       
  0CFF    E5             C      REPREP:	PUSH	H 
  0D00    CD 1335        C      	CALL	GETINFADR 
  0D03    01 0003        C      	LXI	B,3 
  0D06    09             C      	DAD	B 
  0D07    3E 0B          C      	MVI	A,11 
  0D09    36 00          C      	MVI	M,0 
  0D0B    3D             C      	DCR	A 
  0D0C    23             C      	INX	H 
  0D0D    C2 0D09        C      	JNZ	$-4 
  0D10    E1             C      	POP	H 
  0D11    3A 1E17        C      RPREP1:	LDA	RPMES 
  0D14    3D             C      	DCR	A 
  0D15    4F             C      	MOV	C,A 
  0D16    06 00          C      	MVI	B,0 
  0D18    09             C      	DAD	B 
  0D19    C3 0D7C        C      	JMP	REP0 
	MACRO-80 3.44	09-Dec-81	PAGE	1-35


                         C       
  0D1C                   C      REPLACE:: 
  0D1C    2A 1E2A        C      	LHLD	CURX 
  0D1F    E5             C      	PUSH	H 
  0D20    CD 0CD7        C      	CALL	INPSR 
  0D23    CD 0CB0        C      	CALL	CLRSTR 
  0D26    CD 133F        C      	CALL	INFPR 
  0D29    0007           C      	DW	7 
  0D2B    52 45 50 4C    C      	DC	'REPLACE:' 
  0D2F    41 43 45 BA    C      
  0D33    21 1E6F        C      	LXI	H,STRREP 
  0D36    01 1E17        C      	LXI	B,RPMES 
  0D39    CD 0C2A        C      	CALL	INPSTR 
  0D3C    CD 0CB0        C      	CALL	CLRSTR 
  0D3F    CD 133F        C      	CALL	INFPR 
  0D42    0021           C      	DW	33 
  0D44    5B 47 5D 4C    C      	DC	'[G]LOBAL OR [S]TEP:' 
  0D48    4F 42 41 4C    C      
  0D4C    20 4F 52 20    C      
  0D50    5B 53 5D 54    C      
  0D54    45 50 BA       C      
  0D57    21 1935        C      	LXI	H,(LogicHeight+2)*256+35H 
  0D5A    22 1E2A        C      	SHLD	CURX 
  0D5D    CD 0465        C      	CALL	CURM 
  0D60    CD 16EC        C      REP2:	CALL	GETCHR 
  0D63    E6 5F          C      	ANI	5FH 
  0D65    32 1E1C        C      	STA	RMODE 
  0D68    FE 53          C      	CPI	'S' 
  0D6A    CA 0D72        C      	JZ	REP3 
  0D6D    FE 47          C      	CPI	'G' 
  0D6F    C2 0D60        C      	JNZ	REP2 
  0D72    CD 0CB0        C      REP3:	CALL	CLRSTR 
  0D75    E1             C      	POP	H 
  0D76    22 1E2A        C      	SHLD	CURX 
  0D79    2A 1E22        C      	LHLD	STRADR 
  0D7C    3A 1E16        C      REP0:	LDA	SRMES 
  0D7F    3D             C      	DCR	A 
  0D80    CA 0C93        C      	JZ	IN4 
  0D83    32 1E19        C      	STA	OLDMES 
  0D86    3A 1E17        C      	LDA	RPMES 
  0D89    3D             C      	DCR	A 
  0D8A    CA 0C93        C      	JZ	IN4 
  0D8D    CD 0E1B        C      	CALL	SearchStr 
  0D90    E5             C      	PUSH	H 
  0D91    EB             C      	XCHG 
  0D92    CD 12D9        C      	CALL	DISAD1 
  0D95    CD 032B        C      	CALL	DISPLY 
  0D98    E1             C      	POP	H 
  0D99    3A 1E1C        C      	LDA	RMODE 
  0D9C    FE 53          C      	CPI	'S' 
  0D9E    C2 0DC8        C      	JNZ	REP4 
  0DA1    E5             C      	PUSH	H 
  0DA2    CD 0CB0        C      	CALL	CLRSTR 
  0DA5    CD 133F        C      	CALL	INFPR 
  0DA8    0021           C      	DW	33 
  0DAA    52 45 50 4C    C      	DC	'REPLACE Y/N' 
	MACRO-80 3.44	09-Dec-81	PAGE	1-36


  0DAE    41 43 45 20    C      
  0DB2    59 2F CE       C      
  0DB5    E1             C      	POP	H 
  0DB6    CD 16EC        C      REP1:	CALL	GETCHR 
  0DB9    E6 5F          C      	ANI	5FH 
  0DBB    FE 03          C      	CPI	3 
  0DBD    C8             C      	RZ 
  0DBE    FE 4E          C      	CPI	'N' 
  0DC0    CA 0CFF        C      	JZ	REPREP 
  0DC3    FE 59          C      	CPI	'Y' 
  0DC5    C2 0DB6        C      	JNZ	REP1 
  0DC8    E5             C      REP4:	PUSH	H 
  0DC9    EB             C      	XCHG 
  0DCA    2A 1E22        C      	LHLD	STRADR 
  0DCD    E5             C      	PUSH	H 
  0DCE    EB             C      	XCHG 
  0DCF    22 1E22        C      	SHLD	STRADR 
  0DD2    3A 1E17        C      	LDA	RPMES 
  0DD5    3D             C      	DCR	A 
  0DD6    47             C      	MOV	B,A 
  0DD7    32 1E1A        C      	STA	NEWMES 
  0DDA    21 1E6F        C      	LXI	H,STRREP 
  0DDD    EB             C      	XCHG 
  0DDE    21 1E7D        C      	LXI	H,STRRED 
  0DE1    1A             C      RP0:	LDAX	D 
  0DE2    77             C      	MOV	M,A 
  0DE3    05             C      	DCR	B 
  0DE4    23             C      	INX	H 
  0DE5    13             C      	INX	D 
  0DE6    C2 0DE1        C      	JNZ	RP0 
  0DE9    CD 06B5        C      	CALL	INSR1 
  0DEC    E1             C      	POP	H 
  0DED    22 1E22        C      	SHLD	STRADR 
  0DF0    CD 032B        C      	CALL	DISPLY 
  0DF3    E1             C      	POP	H 
  0DF4    C3 0CFF        C      	JMP	REPREP 
                         C       
  0DF7                   C      CONT_SRH:: 
  0DF7    CD 1061        C      	CALL	MARK 
  0DFA    23             C      	INX	H 
  0DFB    CD 0E1B        C      	CALL	SearchStr 
  0DFE    EB             C      	XCHG 
  0DFF    C3 12D9        C      	JMP	DISAD1 
                         C       
  0E02                   C      SEARCH:: 
  0E02    AF             C      	XRA	A 
  0E03    32 1E17        C      	STA	RPMES 
  0E06    2A 1E2A        C      	LHLD	CURX 
  0E09    E5             C      	PUSH	H 
  0E0A    CD 0CD7        C      	CALL	INPSR 
  0E0D    E1             C      	POP	H 
  0E0E    22 1E2A        C      	SHLD	CURX 
  0E11    2A 1E22        C      	LHLD	STRADR 
  0E14    CD 0E1B        C      	call	SearchStr 
  0E17    EB             C      	XCHG 
  0E18    C3 12D9        C      	JMP	DISAD1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-37


                         C       
                         C      GetSym	macro 
                         C      local	@no_upc 
                         C      	ldax	d 
                         C      	inx	d 
                         C      	cmp	b 
                         C      	jc	@no_upc 
                         C      	cpi	0ffh 
                         C      	jz	NotFound 
                         C      	cmp	c 
                         C      	jnc	@No_Upc 
                         C      	sui	20h 
                         C      @No_Upc: 
                         C      	endm 
                         C       
  0E1B                   C      SearchStr: 
  0E1B    01 617B        C      	lxi	b,'a' SHL 8 + 'z'+1 
  0E1E    EB             C      	xchg 
  0E1F    21 1E61        C      	lxi	h,STRSR 
  0E22    E5             C      	push	h 
  0E23                   C      @upcase_lp: 
  0E23    7E             C      	mov	a,m 
  0E24    B8             C      	cmp	b 
  0E25    DA 0E2E        C      	jc	@noupcase 
  0E28    B9             C      	cmp	c 
  0E29    D2 0E2E        C      	jnc	@noupcase 
  0E2C    D6 20          C      	sui	20h 
  0E2E                   C      @noupcase: 
  0E2E    77             C      	mov	m,a 
  0E2F    23             C      	inx	h 
  0E30    B7             C      	ora	a 
  0E31    C2 0E23        C      	jnz	@upcase_lp 
  0E34    E1             C      	pop	h 
                         C       
                         C      	init_brk_check 
  0E35    E5             C+     		PUSH	H 
  0E36    2A 0105        C+     		LHLD	PPI_ADR 
  0E39    36 FE          C+     		MVI	M,0FEH 
  0E3B    E1             C+     		POP	H 
  0E3C                   C      @SrhLoop: 
  0E3C                   C      @SrhLp: 
                         C      	check_break 
  0E3C    E5             C+     		PUSH	H 
  0E3D    2A 0105        C+     		LHLD	PPI_ADR 
  0E40    2C             C+     		INR	L 
  0E41    7E             C+     		MOV	A,M 
  0E42    E1             C+     		POP	H 
  0E43    E6 40          C+     		ANI	40h 
  0E45    CA 0E9C        C      	jz	ABSRH 
                         C      	GetSym 
  0E48    1A             C+     	ldax	d 
  0E49    13             C+     	inx	d 
  0E4A    B8             C+     	cmp	b 
  0E4B    DA 0E59        C+     	jc	..0000 
  0E4E    FE FF          C+     	cpi	0ffh 
  0E50    CA 0E82        C+     	jz	NotFound 
	MACRO-80 3.44	09-Dec-81	PAGE	1-38


  0E53    B9             C+     	cmp	c 
  0E54    D2 0E59        C+     	jnc	..0000 
  0E57    D6 20          C+     	sui	20h 
  0E59                   C+     ..0000: 
  0E59    BE             C              cmp	m 
  0E5A    C2 0E3C        C      	jnz	@SrhLp 
  0E5D    23             C      	inx	h 
  0E5E    D5             C      	push	d 
  0E5F                   C      @Cont:	GetSym 
  0E5F    1A             C+     	ldax	d 
  0E60    13             C+     	inx	d 
  0E61    B8             C+     	cmp	b 
  0E62    DA 0E70        C+     	jc	..0001 
  0E65    FE FF          C+     	cpi	0ffh 
  0E67    CA 0E82        C+     	jz	NotFound 
  0E6A    B9             C+     	cmp	c 
  0E6B    D2 0E70        C+     	jnc	..0001 
  0E6E    D6 20          C+     	sui	20h 
  0E70                   C+     ..0001: 
  0E70    BE             C      	cmp	m 
  0E71    23             C      	inx	h 
  0E72    CA 0E5F        C      	jz	@Cont 
  0E75    D1             C      	pop	d 
  0E76    2B             C      	dcx	h 
  0E77    AF             C      	xra	a 
  0E78    BE             C      	cmp	m 
  0E79    21 1E61        C      	lxi	h,STRSR 
  0E7C    C2 0E3C        C      	jnz	@SrhLoop 
  0E7F    1B             C      	dcx	d 
  0E80    EB             C      	xchg 
  0E81    C9             C      	ret 
                         C       
  0E82                   C      NotFound: 
  0E82    CD 0CB0        C      	CALL	CLRSTR 
  0E85    CD 133F        C      	CALL	INFPR 
  0E88    0021           C      	DW	33 
  0E8A    4E 4F 54 20    C      	DC	'NOT FOUND' 
  0E8E    46 4F 55 4E    C      
  0E92    C4             C      
  0E93    CD 16EC        C      	CALL	GETCHR 
  0E96    CD 0465        C      	CALL	CURM 
  0E99    C3 0239        C      	JMP	OUT1 
                         C       
  0E9C    CD 16EC        C      ABSRH:	CALL	GETCHR 
  0E9F    CD 0CB0        C      	CALL	CLRSTR 
  0EA2    CD 133F        C      	CALL	INFPR 
  0EA5    0021           C      	DW	33 
  0EA7    53 45 41 52    C      	DC	'SEARCH/REPLACE ABORTED' 
  0EAB    43 48 2F 52    C      
  0EAF    45 50 4C 41    C      
  0EB3    43 45 20 41    C      
  0EB7    42 4F 52 54    C      
  0EBB    45 C4          C      
  0EBD    CD 16EC        C      	CALL	GETCHR 
  0EC0    CD 0465        C      	CALL	CURM 
  0EC3    C3 0239        C      	JMP	OUT1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-39


                         C       
                         C       
  0EC6    3E 01          C      LEND::	MVI	A,1 
  0EC8    32 1E2A        C      	STA	CURX 
  0ECB    C9             C      	RET 
                         C       
  0ECC    3A 1E1A        C      REND::	LDA	NEWMES 
  0ECF    FE 80          C      	CPI	MAXLEN+1 
  0ED1    DA 0ED5        C      	JC	$+4 
  0ED4    3D             C      	DCR	A 
  0ED5    32 1E2A        C      	STA	CURX 
  0ED8    C3 041C        C      	JMP	CURCM 
                         C       
  0EDB                   C      BRKSTR:: 
  0EDB    2A 1E08        C      	LHLD	NUMSTR 
  0EDE    23             C      	INX	H 
  0EDF    22 1E08        C      	SHLD	NUMSTR 
  0EE2    CD 09BA        C      	CALL	INSSYM 
  0EE5    CD 0A35        C      	CALL	CAD 
  0EE8    36 0D          C      	MVI	M,0DH 
  0EEA    C3 08DB        C      	JMP	CR 
                         C       
  0EED                   C      INSSPC:: 
  0EED    CD 09BA        C      	CALL	INSSYM 
  0EF0    CD 0A35        C      	CALL	CAD 
  0EF3    36 20          C      	MVI	M,20H 
  0EF5    C9             C      	RET 
                         C       
  0EF6    CD 099C        C      DELLT::	CALL	FILSP 
  0EF9    21 0F23        C      	LXI	H,LDCOR 
  0EFC    CD 09E2        C      	CALL	CORRECT 
  0EFF    CD 03E2        C      	CALL	GETC 
  0F02    4F             C      	MOV	C,A 
  0F03    3A 1E1A        C      	LDA	NEWMES 
  0F06    91             C      	SUB	C 
  0F07    CD 0A39        C      	CALL	CAD1 
  0F0A    F5             C      	PUSH	PSW 
  0F0B    E5             C      	PUSH	H 
  0F0C    CD 0A35        C      	CALL	CAD 
  0F0F    44             C      	MOV	B,H 
  0F10    4D             C      	MOV	C,L 
  0F11    E1             C      	POP	H 
  0F12    F1             C      	POP	PSW 
  0F13    3C             C      	INR	A 
  0F14    32 1E1A        C      	STA	NEWMES 
  0F17    11 1E7D        C      	LXI	D,STRRED 
  0F1A    CD 0717        C      	CALL	D1 
  0F1D    3E 01          C      	MVI	A,1 
  0F1F    32 1E2A        C      	STA	CURX 
  0F22    C9             C      	RET 
                         C       
  0F23    EB             C      LDCOR:	XCHG 
  0F24    E5             C      	PUSH	H 
  0F25    CD 0A21        C      	CALL	CHKPNT 
  0F28    E1             C      	POP	H 
  0F29    D8             C      	RC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-40


  0F2A    EB             C      	XCHG 
  0F2B    CD 0A41        C      	CALL	CADR1 
  0F2E    CD 07D8        C      	CALL	CDEHL 
  0F31    EB             C      	XCHG 
  0F32    D2 0F41        C      	JNC	LDC0 
  0F35    EB             C      	XCHG 
  0F36    CD 1099        C      	CALL	INV_H 
  0F39    19             C      	DAD	D 
  0F3A    EB             C      	XCHG 
  0F3B    2A 1E22        C      	LHLD	STRADR 
  0F3E    19             C      	DAD	D 
  0F3F    23             C      	INX	H 
  0F40    C9             C      	RET 
  0F41    2A 1E22        C      LDC0:	LHLD	STRADR 
  0F44    C9             C      	RET 
                         C       
  0F45    CD 03E2        C      DELRT::	CALL	GETC 
  0F48    47             C      	MOV	B,A 
  0F49    3A 1E1A        C      	LDA	NEWMES 
  0F4C    B8             C      	CMP	B 
  0F4D    D8             C      	RC 
  0F4E    CD 0A35        C      	CALL	CAD 
  0F51    36 0D          C      	MVI	M,0DH 
  0F53    21 0F60        C      	LXI	H,RDCOR 
  0F56    CD 09E2        C      	CALL	CORRECT 
  0F59    CD 03E2        C      	CALL	GETC 
  0F5C    32 1E1A        C      	STA	NEWMES 
  0F5F    C9             C      	RET 
                         C       
  0F60    EB             C      RDCOR:	XCHG 
  0F61    E5             C      	PUSH	H 
  0F62    CD 0A21        C      	CALL	CHKPNT 
  0F65    E1             C      	POP	H 
  0F66    D8             C      	RC 
  0F67    EB             C      	XCHG 
  0F68    CD 0A41        C      	CALL	CADR1 
  0F6B    CD 07D8        C      	CALL	CDEHL 
  0F6E    D8             C      	RC 
  0F6F    EB             C      	XCHG 
  0F70    C9             C      	RET 
                         C       
  0F71                   C      JoinStr:: 
  0F71    2A 1E22        C      	LHLD	STRADR 
  0F74    CD 0593        C      	CALL	NEXTST 
  0F77    C8             C      	RZ 
  0F78    2A 1E08        C      	LHLD	NUMSTR 
  0F7B    2B             C      	DCX	H 
  0F7C    22 1E08        C      	SHLD	NUMSTR 
  0F7F    3A 1E1A        C      	LDA	NEWMES 
  0F82    3D             C      	DCR	A 
  0F83    32 1E1A        C      	STA	NEWMES 
  0F86    C3 06B5        C      	JMP	INSR1 
                         C       
  0F89                   C      BEGBUF:: 
  0F89    21 0001        C      	LXI	H,1 
  0F8C    22 1E0A        C      	SHLD	CURSTR 
	MACRO-80 3.44	09-Dec-81	PAGE	1-41


  0F8F    2A 1E00        C      	LHLD	nivgr 
  0F92    22 1E20        C      	SHLD	SCRADR 
  0F95    22 1E22        C      	SHLD	STRADR 
  0F98    21 0101        C      	LXI	H,0101H 
  0F9B    22 1E2A        C      	SHLD	CURX 
  0F9E    C3 046E        C      	JMP	CURSM 
                         C       
  0FA1                   C      ENDBUF:: 
  0FA1    2A 1E08        C      DREND:	LHLD	NUMSTR 
  0FA4    23             C      	INX	H 
  0FA5    22 1E0A        C      	SHLD	CURSTR 
  0FA8    2A 1E02        C      	LHLD	werhgr 
  0FAB    22 1E20        C      	SHLD	SCRADR 
  0FAE    22 1E22        C      	SHLD	STRADR 
  0FB1    21 0101        C      	LXI	H,101H 
  0FB4    22 1E2A        C      	SHLD	CURX 
  0FB7    CD 0FBD        C      	CALL	PAGEUP 
  0FBA    C3 0B93        C      	JMP	CB00 
                         C       
  0FBD                   C      PAGEUP:: 
  0FBD    3A 1E28        C      	LDA	YSIZE 
  0FC0    3D             C      	DCR	A 
  0FC1    47             C      	MOV	B,A 
                         C       
  0FC2    2A 1E20        C      STR2:	LHLD	SCRADR 
  0FC5    CD 0602        C      	CALL	PREVST 
  0FC8    22 1E20        C      	SHLD	SCRADR 
  0FCB    C2 0FD2        C      	JNZ	$+7 
  0FCE    21 1E2B        C      	LXI	H,CURY 
  0FD1    35             C      	DCR	M 
  0FD2    2A 1E22        C      	LHLD	STRADR 
  0FD5    CD 0602        C      	CALL	PREVST 
  0FD8    22 1E22        C      	SHLD	STRADR 
  0FDB    CA 0FE8        C      	JZ	STR3 
  0FDE    CD 02E1        C      	CALL	DCRCUR 
  0FE1    05             C      	DCR	B 
  0FE2    C2 0FC2        C      	JNZ	STR2 
  0FE5    C3 046E        C      	JMP	CURSM 
  0FE8    C3 0F89        C      STR3:	JMP	BEGBUF 
                         C       
  0FEB                   C      PAGEDN:: 
  0FEB    3A 1E28        C      	LDA	YSIZE 
  0FEE    3D             C      	DCR	A 
  0FEF    47             C      	MOV	B,A 
                         C       
  0FF0    2A 1E22        C      DR3:	LHLD	STRADR 
  0FF3    CD 0593        C      	CALL	NEXTST 
  0FF6    CA 0FA1        C      	JZ	DREND 
  0FF9    22 1E22        C      	SHLD	STRADR 
  0FFC    2A 1E20        C      	LHLD	SCRADR 
  0FFF    CD 0593        C      	CALL	NEXTST 
  1002    22 1E20        C      	SHLD	SCRADR 
  1005    CD 02D9        C      	CALL	INRCUR 
  1008    05             C      	DCR	B 
  1009    C2 0FF0        C      	JNZ	DR3 
  100C    C9             C      	RET 
	MACRO-80 3.44	09-Dec-81	PAGE	1-42


                         C       
                         C      	.comment % 
                         C      MODSCR:: 
                         C      	LHLD	CURX 
                         C      	PUSH	H 
                         C      	CALL	CLRSTR 
                         C      	CALL	INFPR 
                         C      	DW	33 
                         C      	DC	'NULL (0-9):' 
                         C      	LXI	H,(LogicHeight+2)*256+2DH 
                         C      	SHLD	CURX 
                         C      	CALL	CURM 
                         C      MODSC0:	CALL	GETCHR 
                         C      	CPI	30H 
                         C      	JC	MODSC0 
                         C      	CPI	3AH 
                         C      	JNC	MODSC0 
                         C      	PUSH	PSW 
                         C      	CALL	CLS 
                         C      	POP	PSW 
                         C      	SUI	30H-7 
                         C      	STA	LPOS 
                         C      	SUI	6 
                         C      	LHLD	VRAM_ADR 
                         C      	PUSH	D 
                         C      	LXI	H,0E7B9H-0E7C2H 
                         C      	DAD	D 
                         C      	POP	D 
                         C      	DCR	A 
                         C      	DCX	H 
                         C      	JNZ	$-2 
                         C      	MVI	M,0F1H 
                         C      	POP	H 
                         C      	SHLD	CURX 
                         C      	JMP	SAVMOD 
                         C      % 
                         C       
                         C       
  100D                   C      DELLIN:: 
  100D    2A 1E22        C      	LHLD	STRADR 
  1010    54             C      	MOV	D,H 
  1011    5D             C      	MOV	E,L 
  1012    CD 0593        C      	CALL	NEXTST 
  1015    C8             C      	RZ 
  1016    E5             C      	PUSH	H 
  1017    2A 1E08        C      	LHLD	NUMSTR 
  101A    2B             C      	DCX	H 
  101B    22 1E08        C      	SHLD	NUMSTR 
  101E    D5             C      	PUSH	D 
  101F    21 102C        C      	LXI	H,DLCOR 
  1022    CD 09E2        C      	CALL	CORRECT 
  1025    D1             C      	POP	D 
  1026    E1             C      	POP	H 
  1027    44             C      	MOV	B,H 
  1028    4D             C      	MOV	C,L 
  1029    C3 0712        C      	JMP	DNSHT 
	MACRO-80 3.44	09-Dec-81	PAGE	1-43


                         C       
  102C    2A 1E22        C      DLCOR:	LHLD	STRADR 
  102F    C9             C      	RET 
                         C       
  1030    3E B3          C      INSERT:	MVI	A,0B3H 
  1032    32 1E1B        C      	STA	MODE 
  1035    3E E3          C      	MVI	A,CURSOR_BLOCK ; 0EDH 
  1037    C3 1041        C      	JMP	WIDCUR 
                         C       
  103A    3E 93          C      OVRW:	MVI	A,93H 
  103C    32 1E1B        C      	STA	MODE 
  103F    3E D3          C      	MVI	A,CURSOR_LINE ; 0DDH 
  1041                   C      WIDCUR: 
  1041    CD 153C        C      	call	SETSCR 
  1044    C3 046E        C      	JMP	CURSM 
                         C       
  1047    3A 1E1B        C      SAVMOD:	LDA	MODE 
  104A    FE 93          C      	CPI	93H 
  104C    F5             C      	PUSH	PSW 
  104D    C4 1030        C      	CNZ	INSERT 
  1050    F1             C      	POP	PSW 
  1051    CC 103A        C      	CZ	OVRW 
  1054    C9             C      	RET 
                         C       
  1055                   C      DISBEG:: 
  1055    2A 1E0C        C      	LHLD	BLBEG 
  1058    C3 1288        C      	JMP	DISADR 
                         C       
  105B                   C      DISEND:: 
  105B    2A 1E0E        C      	LHLD	BLEND 
  105E    C3 1288        C      	JMP	DISADR 
                         C       
  1061    21 1E1A        C      MARK:	LXI	H,NEWMES 
  1064    CD 03E2        C      	CALL	GETC 
  1067    BE             C      	CMP	M 
  1068    DA 106C        C      	JC	MAR0 
  106B    7E             C      	MOV	A,M 
  106C    3D             C      MAR0:	DCR	A 
  106D    C3 0A45        C      	JMP	CADR11 
                         C       
  1070    CD 1061        C      MRBEG::	CALL	MARK 
  1073    22 1E0C        C      	SHLD	BLBEG 
  1076    C9             C      	RET 
                         C       
  1077    CD 1061        C      MREND::	CALL	MARK 
  107A    22 1E0E        C      	SHLD	BLEND 
  107D    C9             C      	RET 
                         C      ;------------- Main block commands ----------- 
                         C       
  107E    CD 108D        C      DELBL::	CALL	DBL 
  1081    CD 02E9        C      	CALL	COMPST 
  1084    2A 1E0C        C      	LHLD	BLBEG 
  1087    22 1E0E        C      	SHLD	BLEND 
  108A    C3 1288        C      	JMP	DISADR 
  108D    2A 1E0C        C      DBL:	LHLD	BLBEG 
  1090    EB             C      	XCHG 
	MACRO-80 3.44	09-Dec-81	PAGE	1-44


  1091    2A 1E0E        C      	LHLD	BLEND 
  1094    44             C      	MOV	B,H 
  1095    4D             C      	MOV	C,L 
  1096    C3 0712        C      	JMP	DNSHT 
                         C       
  1099    7C             C      INV_H:	MOV	A,H 
  109A    2F             C      	CMA 
  109B    67             C      	MOV	H,A 
  109C    7D             C      	MOV	A,L 
  109D    2F             C      	CMA 
  109E    6F             C      	MOV	L,A 
  109F    C9             C      	RET 
                         C       
  10A0    2A 1286        C      JBLCU:	LHLD	DSTADR 
  10A3    2B             C      	DCX	H 
  10A4    CD 07D8        C      	CALL	CDEHL 
  10A7    D0             C      	RNC 
  10A8    2A 1E0E        C      	LHLD	BLEND 
  10AB    2B             C      	DCX	H 
  10AC    CD 07D8        C      	CALL	CDEHL 
  10AF    D8             C      	RC 
  10B0    2A 1E0C        C      	LHLD	BLBEG 
  10B3    2B             C      	DCX	H 
  10B4    CD 07D8        C      	CALL	CDEHL 
  10B7    DA 10C3        C      	JC	INBLK 
  10BA    D5             C      	PUSH	D 
  10BB    CD 1239        C      	CALL	BLKSIZ 
  10BE    23             C      	INX	H 
  10BF    D1             C      	POP	D 
  10C0    19             C      	DAD	D 
  10C1    EB             C      	XCHG 
  10C2    C9             C      	RET 
  10C3    D5             C      INBLK:	PUSH	D 
  10C4    CD 1244        C      	CALL	GLBSIZ 
  10C7    EB             C      	XCHG 
  10C8    E1             C      	POP	H 
  10C9    CD 13E4        C      	CALL	CSUB 
  10CC    EB             C      	XCHG 
  10CD    C9             C      	RET 
                         C       
  10CE    2A 1E0C        C      JBLCD:	LHLD	BLBEG 
  10D1    2B             C      	DCX	H 
  10D2    CD 07D8        C      	CALL	CDEHL 
  10D5    D0             C      	RNC 
  10D6    2A 1286        C      	LHLD	DSTADR 
  10D9    2B             C      	DCX	H 
  10DA    CD 07D8        C      	CALL	CDEHL 
  10DD    D8             C      	RC 
  10DE    2A 1E0E        C      	LHLD	BLEND 
  10E1    2B             C      	DCX	H 
  10E2    CD 07D8        C      	CALL	CDEHL 
  10E5    D2 10F4        C      	JNC	INBLD 
  10E8    D5             C      	PUSH	D 
  10E9    CD 1239        C      	CALL	BLKSIZ 
  10EC    23             C      	INX	H 
  10ED    D1             C      	POP	D 
	MACRO-80 3.44	09-Dec-81	PAGE	1-45


  10EE    EB             C      	XCHG 
  10EF    CD 13E4        C      	CALL	CSUB 
  10F2    EB             C      	XCHG 
  10F3    C9             C      	RET 
                         C       
  10F4    2A 1286        C      INBLD:	LHLD	DSTADR 
  10F7    19             C      	DAD	D 
  10F8    EB             C      	XCHG 
  10F9    2A 1E0E        C      	LHLD	BLEND 
  10FC    EB             C      	XCHG 
  10FD    CD 13E4        C      	CALL	CSUB 
  1100    EB             C      	XCHG 
  1101    C9             C      	RET 
                         C       
  1102                   C      COPYBL:: 
  1102    CD 110E        C      	CALL	CBL 
  1105    CD 02E9        C      	CALL	COMPST 
  1108    2A 1E0C        C      	LHLD	BLBEG 
  110B    C3 1288        C      	JMP	DISADR 
  110E    CD 1143        C      CBL:	CALL	CHBL 
  1111    D2 111E        C      	JNC	CBL1 
  1114    2A 1E0E        C      	LHLD	BLEND 
  1117    2B             C      	DCX	H 
  1118    CD 07D8        C      	CALL	CDEHL 
  111B    D2 0239        C      	JNC	OUT1 
  111E    CD 1239        C      CBL1:	CALL	BLKSIZ 
  1121    EB             C      	XCHG 
  1122    2A 1286        C      	LHLD	DSTADR 
  1125    44             C      	MOV	B,H 
  1126    4D             C      	MOV	C,L 
  1127    E5             C      	PUSH	H 
  1128    19             C      	DAD	D 
  1129    E5             C      	PUSH	H 
  112A    23             C      	INX	H 
  112B    EB             C      	XCHG 
  112C    CD 06FB        C      	CALL	UPSHT 
  112F    2A 1E0C        C      	LHLD	BLBEG 
  1132    44             C      	MOV	B,H 
  1133    4D             C      	MOV	C,L 
  1134    E1             C      	POP	H 
  1135    23             C      	INX	H 
  1136    22 1E0E        C      	SHLD	BLEND 
  1139    2B             C      	DCX	H 
  113A    EB             C      	XCHG 
  113B    E1             C      	POP	H 
  113C    22 1E0C        C      	SHLD	BLBEG 
  113F    EB             C      	XCHG 
  1140    C3 0717        C      	JMP	D1 
                         C       
  1143    CD 1061        C      CHBL:	CALL	MARK 
  1146    22 1286        C      	SHLD	DSTADR 
  1149    EB             C      	XCHG 
  114A    2A 1E0C        C      	LHLD	BLBEG 
  114D    2B             C      	DCX	H 
  114E    C3 07D8        C      	JMP	CDEHL 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-46


  1151    CD 1143        C      JMPBL::	CALL	CHBL 
  1154    D2 1163        C      	JNC	JBLUP 
  1157    2A 1E0E        C      	LHLD	BLEND 
  115A    CD 07D8        C      	CALL	CDEHL 
  115D    DA 1189        C      	JC	JBLDN 
  1160    C3 0239        C      	JMP	OUT1 
  1163    2A 1E2E        C      JBLUP:	LHLD	SCRAD0 
  1166    EB             C      	XCHG 
  1167    CD 10A0        C      	CALL	JBLCU 
  116A    EB             C      	XCHG 
  116B    22 1E2E        C      	SHLD	SCRAD0 
  116E    CD 1239        C      	CALL	BLKSIZ 
  1171    EB             C      	XCHG 
  1172    2A 1286        C      	LHLD	DSTADR 
  1175    E5             C      	PUSH	H 
  1176    D5             C      	PUSH	D 
  1177    CD 11C6        C      	CALL	JBLU 
  117A    D1             C      JBLEX:	POP	D 
  117B    E1             C      	POP	H 
  117C    22 1E0C        C      	SHLD	BLBEG 
  117F    E5             C      	PUSH	H 
  1180    19             C      	DAD	D 
  1181    23             C      	INX	H 
  1182    22 1E0E        C      	SHLD	BLEND 
  1185    E1             C      	POP	H 
  1186    C3 1288        C      	JMP	DISADR 
                         C       
  1189    2A 1E2E        C      JBLDN:	LHLD	SCRAD0 
  118C    EB             C      	XCHG 
  118D    CD 10CE        C      	CALL	JBLCD 
  1190    EB             C      	XCHG 
  1191    22 1E2E        C      	SHLD	SCRAD0 
  1194    CD 1239        C      	CALL	BLKSIZ 
  1197    EB             C      	XCHG 
  1198    2A 1286        C      	LHLD	DSTADR 
  119B    E5             C      	PUSH	H 
  119C    D5             C      	PUSH	D 
  119D    CD 11FA        C      	CALL	JBLD 
  11A0    D1             C      	POP	D 
  11A1    E1             C      	POP	H 
  11A2    22 1E0E        C      	SHLD	BLEND 
  11A5    2B             C      	DCX	H 
  11A6    CD 13E4        C      	CALL	CSUB 
  11A9    22 1E0C        C      	SHLD	BLBEG 
  11AC    C3 1288        C      	JMP	DISADR 
                         C       
  11AF    E5             C      SETST0:	PUSH	H 
  11B0    3A 1E39        C      	LDA	CURY0 
  11B3    2A 1E2E        C      	LHLD	SCRAD0 
  11B6    47             C      	MOV	B,A 
  11B7    05             C      SST00:	DCR	B 
  11B8    CA 11C1        C      	JZ	SST01 
  11BB    CD 0593        C      	CALL	NEXTST 
  11BE    C2 11B7        C      	JNZ	SST00 
  11C1    22 1E30        C      SST01:	SHLD	STRAD0 
  11C4    E1             C      	POP	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-47


  11C5    C9             C      	RET 
                         C       
                         C       
  11C6    CD 1239        C      JBLU:	CALL	BLKSIZ 
  11C9    23             C      	INX	H 
  11CA    E5             C      	PUSH	H 
  11CB    CD 1244        C      	CALL	GLBSIZ 
  11CE    D1             C      	POP	D 
  11CF    CD 1484        C      	CALL	?DVNHD 
  11D2    2A 1286        C      	LHLD	DSTADR 
  11D5    7A             C      	MOV	A,D 
  11D6    B3             C      	ORA	E 
  11D7    F5             C      	PUSH	PSW	; ? End of relocation 
  11D8    19             C      	DAD	D 
  11D9    44             C      	MOV	B,H 
  11DA    4D             C      	MOV	C,L 
  11DB    0B             C      	DCX	B 
  11DC    2A 1E0C        C      	LHLD	BLBEG 
  11DF    EB             C      	XCHG 
  11E0    1B             C       	DCX	D 
  11E1    2A 1E0E        C      	LHLD	BLEND 
  11E4    2B             C      	DCX	H 
  11E5    CD 124E        C      	CALL	GREXU	; "Great" Exchange 
  11E8    EB             C      	XCHG 
  11E9    23             C      	INX	H 
  11EA    22 1E0E        C      	SHLD	BLEND 
  11ED    2A 1286        C      	LHLD	DSTADR 
  11F0    22 1E0C        C       	SHLD	BLBEG 
  11F3    EB             C      	XCHG 
  11F4    23             C      	INX	H 
  11F5    22 1286        C      	SHLD	DSTADR 
  11F8    F1             C      	POP	PSW	; Z - the end 
  11F9    C8             C      	RZ 
  11FA    CD 1239        C      JBLD:	CALL	BLKSIZ 
  11FD    23             C      	INX	H 
  11FE    E5             C      	PUSH	H 
  11FF    2A 1E0E        C      	LHLD	BLEND 
  1202    2B             C      	DCX	H 
  1203    EB             C      	XCHG 
  1204    2A 1286        C      	LHLD	DSTADR 
  1207    CD 13E4        C      	CALL	CSUB 
  120A    2B             C      	DCX	H 
  120B    D1             C      	POP	D 
  120C    CD 1484        C      	CALL	?DVNHD 
  120F    2A 1286        C      	LHLD	DSTADR 
  1212    7A             C      	MOV	A,D 
  1213    B3             C      	ORA	E 
  1214    F5             C      	PUSH	PSW	; ? End of relocation 
  1215    CD 13E4        C      	CALL	CSUB 
  1218    44             C      	MOV	B,H 
  1219    4D             C      	MOV	C,L 
  121A    2A 1E0E        C      	LHLD	BLEND 
  121D    2B             C      	DCX	H 
  121E    EB             C      	XCHG 
  121F    13             C       	INX	D 
  1220    2A 1E0C        C      	LHLD	BLBEG 
	MACRO-80 3.44	09-Dec-81	PAGE	1-48


  1223    CD 126A        C      	CALL	GREXD	; "Great" Exchange 
  1226    EB             C      	XCHG 
  1227    22 1E0C        C      	SHLD	BLBEG 
  122A    2A 1286        C      	LHLD	DSTADR 
  122D    22 1E0E        C       	SHLD	BLEND 
  1230    EB             C      	XCHG 
  1231    22 1286        C      	SHLD	DSTADR 
  1234    F1             C      	POP	PSW	; Z - the end 
  1235    C2 11C6        C      	JNZ	JBLU 
  1238    C9             C      	RET 
                         C       
  1239    2A 1E0C        C      BLKSIZ:	LHLD	BLBEG 
  123C    EB             C      	XCHG 
  123D    2A 1E0E        C      	LHLD	BLEND 
  1240    2B             C      	DCX	H 
  1241    C3 13E4        C      	JMP	CSUB 
                         C       
  1244    2A 1286        C      GLBSIZ:	LHLD	DSTADR 
  1247    EB             C      	XCHG 
  1248    2A 1E0C        C      	LHLD	BLBEG 
  124B    C3 13E4        C      	JMP	CSUB 
                         C       
  124E    7B             C      GREXU:	MOV	A,E 
  124F    B9             C      	CMP	C 
  1250    C2 1256        C      	JNZ	GREXU0 
  1253    7A             C      	MOV	A,D 
  1254    B8             C      	CMP	B 
  1255    C8             C      	RZ 
  1256    C5             C      GREXU0:	PUSH	B 
  1257    4E             C      GREXU1:	MOV	C,M 
  1258    1A             C      	LDAX	D 
  1259    77             C      	MOV	M,A 
  125A    79             C      	MOV	A,C 
  125B    12             C      	STAX	D 
  125C    2B             C      	DCX	H 
  125D    1B             C      	DCX	D 
  125E    7A             C      	MOV	A,D 
  125F    B8             C      	CMP	B 
  1260    C2 1257        C      	JNZ	GREXU1 
  1263    C1             C      	POP	B 
  1264    7B             C      	MOV	A,E 
  1265    B9             C      	CMP	C 
  1266    C2 1256        C              JNZ	GREXU0 
  1269    C9             C      	RET 
                         C       
                         C       
  126A    7B             C      GREXD:	MOV	A,E 
  126B    B9             C      	CMP	C 
  126C    C2 1272        C      	JNZ	GREXD0 
  126F    7A             C      	MOV	A,D 
  1270    B8             C      	CMP	B 
  1271    C8             C      	RZ 
  1272    C5             C      GREXD0:	PUSH	B 
  1273    4E             C      GREXD1:	MOV	C,M 
  1274    1A             C      	LDAX	D 
  1275    77             C      	MOV	M,A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-49


  1276    79             C      	MOV	A,C 
  1277    12             C      	STAX	D 
  1278    23             C      	INX	H 
  1279    13             C      	INX	D 
  127A    7A             C      	MOV	A,D 
  127B    B8             C      	CMP	B 
  127C    C2 1273        C      	JNZ	GREXD1 
  127F    C1             C      	POP	B 
  1280    7B             C      	MOV	A,E 
  1281    B9             C      	CMP	C 
  1282    C2 1272        C      	JNZ	GREXD0 
  1285    C9             C      	RET 
                         C       
  1286                   C      DSTADR:	DS	2 
                         C      ;------------------------------------------ 
                         C       
  1288    EB             C      DISADR:	XCHG 
  1289    2A 1E20        C      	LHLD	SCRADR 
  128C    CD 12CC        C      	CALL	DA2 
  128F    22 1E20        C      	SHLD	SCRADR 
  1292    EB             C      	XCHG 
  1293    CD 07D8        C      	CALL	CDEHL 
  1296    EB             C      	XCHG 
  1297    DA 12D9        C      	JC	DISAD1 
  129A    2A 1E06        C      	LHLD	SCREND 
  129D    CD 12CC        C      	CALL	DA2 
  12A0    22 1E06        C      	SHLD	SCREND 
  12A3    EB             C      	XCHG 
  12A4    CD 07D8        C      	CALL	CDEHL 
  12A7    EB             C      	XCHG 
  12A8    D2 12D9        C      	JNC	DISAD1 
  12AB    CD 12CA        C      DAD1:	CALL	DA1 
  12AE    22 1E22        C      	SHLD	STRADR 
  12B1    2A 1E20        C      	LHLD	SCRADR 
  12B4    06 00          C      	MVI	B,0 
  12B6    04             C      DAD0:	INR	B 
  12B7    78             C      	MOV	A,B 
  12B8    32 1E2B        C      	STA	CURY 
  12BB    CD 0593        C      	CALL	NEXTST 
  12BE    CD 07D8        C      	CALL	CDEHL 
  12C1    CA 12B6        C      	JZ	DAD0 
  12C4    D2 12F3        C      	JNC	DSAD0 
  12C7    C3 12B6        C      	JMP	DAD0 
                         C       
  12CA    62             C      DA1:	MOV	H,D 
  12CB    6B             C      	MOV	L,E 
  12CC    2B             C      DA2:	DCX	H 
  12CD    7E             C      	MOV	A,M 
  12CE    FE 0D          C      	CPI	0DH 
  12D0    C2 12D5        C      	JNZ	DI3 
  12D3    23             C      	INX	H 
  12D4    C9             C      	RET 
  12D5    23             C      DI3:	INX	H 
  12D6    C3 0602        C      	JMP	PREVST 
                         C       
  12D9    CD 12CA        C      DISAD1:	CALL	DA1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-50


  12DC    22 1E20        C      	SHLD	SCRADR 
  12DF    3A 1E2B        C      	LDA	CURY 
  12E2    4F             C      	MOV	C,A 
  12E3    0D             C      DS6:	DCR	C 
  12E4    CA 12AB        C      	JZ	DAD1 
  12E7    CD 0602        C      	CALL	PREVST 
  12EA    CA 12AB        C      	JZ	DAD1 
  12ED    22 1E20        C      	SHLD	SCRADR 
  12F0    C3 12E3        C      	JMP	DS6 
                         C       
  12F3    2A 1E22        C      DSAD0:	LHLD	STRADR 
  12F6    22 1E3D        C      	SHLD	TABSRH 
  12F9    06 01          C      DS5:	MVI	B,1 
  12FB    7A             C      DS0:	MOV	A,D 
  12FC    BC             C      	CMP	H 
  12FD    C2 1305        C      	JNZ	DS1 
  1300    7B             C      	MOV	A,E 
  1301    BD             C      	CMP	L 
  1302    CA 130A        C      	JZ	DISAD0 
  1305    23             C      DS1:	INX	H 
  1306    04             C      	INR	B 
  1307    C2 12FB        C      	JNZ	DS0 
  130A    78             C      DISAD0:	MOV	A,B 
  130B    32 1E2A        C      	STA	CURX 
  130E    CD 0304        C      	CALL	COMCUR 
  1311    C3 041C        C      	JMP	CURCM 
                         C       
  1314    7B             C      BPR:	MOV	A,E 
  1315    CD 131C        C      	CALL	BPR1 
  1318    7A             C      	MOV	A,D 
  1319    C3 131C        C      	JMP	BPR1 
  131C    F5             C      BPR1:	PUSH	PSW 
  131D    CD 1325        C      	call	BPR01 
  1320    F1             C      	POP	PSW 
  1321    0F             C      	RRC 
  1322    0F             C      	RRC 
  1323    0F             C      	RRC 
  1324    0F             C      	RRC 
  1325    E6 0F          C      BPR01:	ANI	0FH 
  1327    C6 30          C      	ADI	48 
  1329    FE 3A          C      	CPI	58 
  132B    DA 1330        C      	JC	$+5 
  132E    C6 07          C      	ADI	7 
                         C      	SetScrAddr 
                         C      	WriteNextSym 
  1330    77             C+     		mov	m,a 
  1331    23             C+     		inx	h 
  1332    2B             C      	DCX	H 
  1333    2B             C      	DCX	H 
  1334    C9             C      	RET 
                         C       
  1335                   C      GETINFADR: 
  1335    C5             C      	PUSH	B 
  1336    2A 0103        C      	LHLD	VRAM_ADR 
  1339    01 0750        C      	LXI	B,INFSTR_OFFS 
  133C    09             C      	DAD	B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-51


  133D    C1             C      	POP	B 
  133E    C9             C      	RET 
                         C       
  133F    E1             C      INFPR:	POP	H 
  1340    5E             C      	MOV	E,M 
  1341    23             C      	INX	H 
  1342    56             C      	MOV	D,M 
  1343    23             C      	INX	H 
  1344    E5             C       	PUSH	H 
  1345    CD 1335        C      	CALL	GETINFADR 
  1348    19             C      	DAD	D 
  1349    EB             C      	XCHG 
  134A    E1             C      	POP	H 
  134B    C3 1353        C      	JMP	print0 
                         C       
  134E    E1             C      PRINT:	POP	H 
  134F    5E             C      	MOV	E,M 
  1350    23             C      	INX	H 
  1351    56             C      	MOV	D,M 
  1352    23             C      	INX	H 
                         C       
  1353    EB             C      PRINT0:	xchg 
                         C      	SetScrAddr 
  1354    1A             C      @prnt:	ldax	d 
  1355    B7             C      	ORA	A 
  1356    FA 135F        C      	JM	PRINT1 
                         C       
                         C      	WriteNextSym 
  1359    77             C+     		mov	m,a 
  135A    23             C+     		inx	h 
  135B    13             C      	inx	d 
  135C    C3 1354        C      	JMP	@prnt 
                         C       
  135F    E6 7F          C      PRINT1:	ANI	7FH 
                         C      	WriteNextSym 
  1361    77             C+     		mov	m,a 
  1362    23             C+     		inx	h 
  1363    EB             C      	xchg 
  1364    23             C      	inx	h 
  1365    E9             C      	pchl 
                         C       
  1366    CD 0CB0        C      CALC::	CALL	CLRSTR 
  1369    CD 133F        C      	CALL	INFPR 
  136C    001F           C      	DW	31 
  136E    3D 20 30 30    C      	DC	'= 0000H  0000DEC' 
  1372    30 30 48 20    C      
  1376    20 30 30 30    C      
  137A    30 44 45 C3    C      
  137E    CD 133F        C      CALC0:	CALL	INFPR 
  1381    000A           C      	DW	10 
  1383    45 58 50 52    C      	DC	'EXPR=' 
  1387    BD             C      
  1388    21 1E7D        C      	LXI	H,FILNAM 
  138B    01 1E18        C      	LXI	B,NAMMES 
  138E    E5             C      	PUSH	H 
  138F    CD 0C2A        C      	CALL	INPSTR 
	MACRO-80 3.44	09-Dec-81	PAGE	1-52


  1392    E1             C      	POP	H 
  1393    CD 13B8        C      	CALL	COMPUTE 
  1396    E5             C      	PUSH	H 
  1397    EB             C      	XCHG 
  1398    CD 1335        C      	CALL	GETINFADR 
  139B    C5             C      	PUSH	B 
  139C    01 0024        C      	LXI	B,36 
  139F    09             C      	DAD	B 
  13A0    C1             C      	POP	B 
  13A1    CD 1314        C      	CALL	BPR 
  13A4    E1             C      	POP	H 
  13A5    CD 1426        C      	CALL	?FBBCD 
  13A8    EB             C      	XCHG 
  13A9    CD 1335        C      	CALL	GETINFADR 
  13AC    C5             C      	PUSH	B 
  13AD    01 002B        C      	LXI	B,43 
  13B0    09             C      	DAD	B 
  13B1    C1             C      	POP	B 
  13B2    CD 1314        C      	CALL	BPR 
  13B5    C3 137E        C      	JMP	CALC0 
                         C       
  13B8    CD 13EA        C      COMPUTE:CALL	GETVL1 
  13BB    7E             C      	MOV	A,M 
  13BC    23             C      	INX	H 
  13BD    42             C      	MOV	B,D 
  13BE    4B             C      	MOV	C,E 
  13BF    F5             C      	PUSH	PSW 
  13C0    C5             C      	PUSH	B 
  13C1    CD 13EA        C      	CALL	GETVL1 
  13C4    C1             C      	POP	B 
  13C5    60             C      	MOV	H,B 
  13C6    69             C      	MOV	L,C 
  13C7    F1             C      	POP	PSW 
                         C       
  13C8    FE 2B          C      	CPI	'+' 
  13CA    CA 13DF        C      	JZ	CADD 
  13CD    FE 2D          C      	CPI	'-' 
  13CF    CA 13E4        C      	JZ	CSUB 
  13D2    FE 2A          C      	CPI	'*' 
  13D4    CA 1470        C      	JZ	?MULHD 
  13D7    FE 2F          C      	CPI	'/' 
  13D9    CA 1484        C      	JZ	?DVNHD 
  13DC    C3 13E1        C      	JMP	ERR 
                         C       
  13DF    19             C      CADD:	DAD	D 
  13E0    C9             C      	RET 
                         C       
  13E1    C3 0C93        C      ERR:	JMP	IN4 
                         C       
  13E4    EB             C      CSUB:	XCHG 
  13E5    CD 14AD        C      	CALL	?NEGHL 
  13E8    19             C      	DAD	D 
  13E9    C9             C      	RET 
                         C       
                         C       
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-53


  13EA    11 0000        C      GETVL1:	LXI	D,0 
  13ED    7E             C      	MOV	A,M 
  13EE    CD 1417        C      	CALL	GET4 
  13F1    B7             C      	ORA	A 
  13F2    F8             C      	RM 
  13F3    7E             C      GET2:	MOV	A,M 
  13F4    CD 1417        C      	CALL	GET4 
  13F7    B7             C      	ORA	A 
  13F8    FA 1407        C      	JM	GET1 
  13FB    EB             C      	XCHG 
  13FC    29             C      	DAD	H 
  13FD    29             C      	DAD	H 
  13FE    29             C      	DAD	H 
  13FF    29             C      	DAD	H 
  1400    EB             C      	XCHG 
  1401    B3             C      	ORA	E 
  1402    5F             C      	MOV	E,A 
  1403    23             C      	INX	H 
  1404    C3 13F3        C      	JMP	GET2 
  1407    7E             C      GET1:	MOV	A,M 
  1408    FE 48          C      	CPI	'H' 
  140A    CA 1415        C      	JZ	GET3 
  140D    E5             C      	PUSH	H 
  140E    EB             C      	XCHG 
  140F    CD 143A        C      	CALL	?FBCDB 
  1412    EB             C      	XCHG 
  1413    E1             C      	POP	H 
  1414    C9             C      	RET 
                         C       
  1415    23             C      GET3:	INX	H 
  1416    C9             C      	RET 
                         C       
  1417    D6 30          C      GET4:	SUI	'0' 
  1419    D8             C      	RC 
  141A    FE 0A          C      	CPI	0AH 
  141C    D8             C      	RC 
  141D    D6 07          C      	SUI	7 
  141F    D8             C      	RC 
  1420    FE 10          C      	CPI	16 
  1422    D8             C      	RC 
  1423    3E F9          C      GET5:	MVI	A,-7 
  1425    C9             C      	RET 
                         C       
  1426    11 0000        C      ?FBBCD: LXI	D,0 
  1429    0E 10          C      	MVI	C,16 
  142B    29             C      ?FBBC0:	DAD	H 
  142C    7B             C      	MOV	A,E 
  142D    8F             C      	ADC	A 
  142E    27             C      	DAA 
  142F    5F             C      	MOV	E,A 
  1430    7A             C      	MOV	A,D 
  1431    8F             C      	ADC	A 
  1432    27             C      	DAA 
  1433    57             C      	MOV	D,A 
  1434    0D             C      	DCR	C 
  1435    C2 142B        C      	JNZ	?FBBC0 
	MACRO-80 3.44	09-Dec-81	PAGE	1-54


  1438    EB             C      	XCHG 
  1439    C9             C      	RET 
  143A    11 0000        C      ?FBCDB:	LXI	D,0 
  143D    EB             C      	XCHG 
  143E    0E 10          C      	MVI	C,16 
  1440    AF             C      ?FBCB0:	XRA	A 
  1441    7A             C      	MOV	A,D 
  1442    1F             C      	RAR 
  1443    CD 1458        C      	CALL	CORR_A 
  1446    57             C      	MOV	D,A 
  1447    7B             C      	MOV	A,E 
  1448    1F             C      	RAR 
  1449    CD 1458        C      	CALL	CORR_A 
  144C    5F             C      	MOV	E,A 
  144D    7C             C      	MOV	A,H 
  144E    1F             C      	RAR 
  144F    67             C      	MOV	H,A 
  1450    7D             C      	MOV	A,L 
  1451    1F             C      	RAR 
  1452    6F             C      	MOV	L,A 
  1453    0D             C      	DCR	C 
  1454    C2 1440        C      	JNZ	?FBCB0 
  1457    C9             C      	RET 
                         C       
  1458    F5             C      CORR_A:	PUSH	PSW 
  1459    47             C      	MOV	B,A 
  145A    E6 08          C      	ANI	8 
  145C    CA 1463        C      	JZ	NOCR1 
  145F    78             C      	MOV	A,B 
  1460    D6 03          C      	SUI	3 
  1462    47             C      	MOV	B,A 
  1463    78             C      NOCR1:	MOV	A,B 
  1464    E6 80          C      	ANI	80H 
  1466    CA 146D        C      	JZ	NOCR2 
  1469    78             C      	MOV	A,B 
  146A    D6 30          C      	SUI	30H 
  146C    47             C      	MOV	B,A 
  146D    F1             C      NOCR2:	POP	PSW 
  146E    78             C      	MOV	A,B 
  146F    C9             C      	RET 
                         C       
                         C       
                         C      ; 16-BIT MULTIPLY 
                         C      ; HL *= DE 
  1470    44             C      ?MULHD:	MOV	B,H 
  1471    4D             C      	MOV	C,L 
  1472    21 0000        C      	LXI	H,0 
  1475    3E 10          C      	MVI	A,16 
  1477    29             C      ?01:	DAD	H 
  1478    EB             C      	XCHG 
  1479    29             C      	DAD	H 
  147A    EB             C      	XCHG 
  147B    D2 147F        C      	JNC	?02 
  147E    09             C      	DAD	B 
  147F    3D             C      ?02:	DCR	A 
  1480    C2 1477        C      	JNZ	?01 
	MACRO-80 3.44	09-Dec-81	PAGE	1-55


  1483    C9             C      	RET 
                         C       
                         C       
                         C      ; 16 - BIT UNSIGNED DIVISION 
                         C      ; HL /= DE 
                         C      ; DE = HL % DE 
  1484    42             C      ?DVNHD:	MOV	B,D 
  1485    4B             C      	MOV	C,E 
  1486    11 0000        C      	LXI	D,0 
  1489    3E 10          C      	MVI	A,16 
  148B    F5             C      ?21:	PUSH	PSW 
  148C    29             C      	DAD	H 
  148D    7B             C      	MOV	A,E 
  148E    17             C      	RAL 
  148F    5F             C      	MOV	E,A 
  1490    7A             C      	MOV	A,D 
  1491    17             C      	RAL 
  1492    57             C      	MOV	D,A 
  1493    DA 149D        C      	JC	?22 
  1496    7B             C      	MOV	A,E 
  1497    91             C      	SUB	C 
  1498    7A             C      	MOV	A,D 
  1499    98             C      	SBB	B 
  149A    DA 14A4        C      	JC	?23 
  149D    7B             C      ?22:	MOV	A,E 
  149E    91             C      	SUB	C 
  149F    5F             C      	MOV	E,A 
  14A0    7A             C      	MOV	A,D 
  14A1    98             C      	SBB	B 
  14A2    57             C      	MOV	D,A 
  14A3    2C             C      	INR	L 
  14A4    F1             C      ?23:	POP	PSW 
  14A5    3D             C      	DCR	A 
  14A6    C2 148B        C      	JNZ	?21 
  14A9    C9             C      	RET 
                         C       
  14AA    7C             C      ?ABSHL:	MOV	A,H 
  14AB    B7             C      	ORA	A 
  14AC    F0             C      	RP 
  14AD    2B             C      ?NEGHL:	DCX	H 
  14AE    7D             C      ?NOTHL:	MOV	A,L 
  14AF    2F             C      	CMA 
  14B0    6F             C      	MOV	L,A 
  14B1    7C             C      	MOV	A,H 
  14B2    2F             C      	CMA 
  14B3    67             C      	MOV	H,A 
  14B4    C9             C      	RET 
                         C       
                         C       
  14B5    CD 024D        C      EXIT::	call	CLS 
                         C      IFDEF	CPM 
                         C      	JMP	0 
                         C      ELSE 
  14B8    C3 F800        C      	JMP	0F800h;rst	0 
                         C      ENDIF 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-56


                         C      ;----- Display one editor string ---------- 
  14BB                   C      DISSTR::	SetScrAddr 
  14BB    06 00          C      	MVI	B,0 
  14BD    3A 1E2C        C      	LDA	DISPOS 
  14C0    4F             C      	MOV	C,A   
  14C1    CD 1512        C      	call	_SkipSyms 
  14C4    0E 40          C      	MVI	C,LogicWidth 
  14C6    E5             C      	push	h 
  14C7                   C      _DispNxtChr: 
  14C7    1A             C      	LDAX	D 
  14C8    FE FF          C      	CPI	0FFH 
  14CA    CA 1505        C      	JZ	_BlankEos ; Blank to end of screen 
  14CD    FE 0D          C      	CPI	13 
  14CF    CA 1505        C      	JZ	_BlankEos 
  14D2    FE 09          C      	CPI	9 
  14D4    CA 14EF        C      	JZ	_DispTab 
                         C      ifdef	LimitedCharSet 
                         C      	;ORA	A 
                         C      	;JP	$+5 
                         C      	;MVI	A,0D6H 
                         C      endif 
                         C      	WriteNextSym 
  14D7    77             C+     		mov	m,a 
  14D8    23             C+     		inx	h 
  14D9    13             C      	INX	D 
  14DA    04             C      	INR	B 
  14DB    0D             C      	DCR	C 
  14DC    C2 14C7        C      	JNZ	_DispNxtChr 
                         C       
  14DF    E1             C      _Eos:	POP	H 
  14E0    01 004E        C      	lxi	b,ScrWidth 
  14E3    09             C      	dad	b 
  14E4                   C      _SkipToEol: 
  14E4    1A             C      	LDAX	D 
  14E5    FE 0D          C      	CPI	13 
  14E7    C8             C      	RZ 
  14E8    FE FF          C      	cpi	0ffh 
  14EA    C8             C      	RZ 
  14EB    13             C      	INX	D 
  14EC    C3 14E4        C      	JMP	_SkipToEol 
                         C       
  14EF                   C      _DispTab: 
  14EF    CD 1532        C      	call	CalcTab 
  14F2    13             C      	INX	D 
  14F3    F5             C      _DspT:	push	psw 
  14F4    3E 20          C      	mvi	a,space 
                         C      	WriteNextSym 
  14F6    77             C+     		mov	m,a 
  14F7    23             C+     		inx	h 
  14F8    F1             C      	pop	psw 
  14F9    04             C      	INR	B 
  14FA    0D             C      	DCR	C 
  14FB    CA 14DF        C      	JZ	_Eos 
  14FE    3D             C      	DCR	A 
  14FF    C2 14F3        C      	JNZ	_DspT 
  1502    C3 14C7        C      	JMP	_DispNxtChr 
	MACRO-80 3.44	09-Dec-81	PAGE	1-57


                         C       
                         C       
  1505                   C      _BlankEos: 
  1505    F5             C      	push	psw 
  1506    3E 20          C      	mvi	a,space 
                         C      	WriteNextSym 
  1508    77             C+     		mov	m,a 
  1509    23             C+     		inx	h 
  150A    F1             C      	pop	psw 
  150B    0D             C      	DCR	C 
  150C    C2 1505        C      	JNZ	_BlankEos 
  150F    C3 14DF        C      	JMP	_Eos 
                         C       
                         C      ;	* 
  1512                   C      _SkipSyms: 
  1512    04             C      	INR	B 
  1513    0D             C      	DCR	C 
  1514    C8             C      	rz 
  1515    1A             C      	LDAX	D 
  1516    FE FF          C      	CPI	0FFH 
  1518    C8             C      	rz 
  1519    FE 0D          C      	CPI	0DH 
  151B    C8             C      	rz 
  151C    FE 09          C      	CPI	9 
  151E    C2 152E        C      	jnz	_ContSkipping 
  1521    CD 1532        C      	call	CalcTab 
  1524                   C      _SkTabLp: 
  1524    3D             C      	DCR	A 
  1525    CA 152E        C      	JZ	_ContSkipping 
  1528    04             C      	INR	B 
  1529    0D             C      	DCR	C 
  152A    C8             C      	rz 
  152B    C3 1524        C      	jmp	_SkTabLp 
                         C       
  152E                   C      _ContSkipping: 
  152E    13             C      	INX	D 
  152F    C3 1512        C      	JMP	_SkipSyms 
                         C       
  1532    78             C      CalcTab:MOV	A,B 
  1533    3D             C      	DCR	A 
  1534    E6 07          C      	ANI	TabStep-1 
  1536    D6 09          C      	SUI	TabStep+1 
  1538    2F             C      	CMA 
  1539    C9             C      	ret 
                         C       
                         C      ;--------------- DISSTR ---------- 
                         C      PUBLIC BLBEG,BLEND,CDEHL,CLRSTR,CURX,DISADR,FILNAM,INFPR,INPSTR,MARK,MAXRAM 
                         C      PUBLIC NAMMES,nivgr,werhgr,OUT1,PRINT 
                         C       
                         C       
  1E00                   C      nivgr	EQU	WRK 
  1E02                   C      werhgr	EQU	WRK+2 
  1E04                   C      VDADR	EQU	WRK+4 
  1E06                   C      SCREND	EQU	WRK+6 
  1E08                   C      NUMSTR	EQU	WRK+8 
  1E0A                   C      CURSTR	EQU	WRK+10 
	MACRO-80 3.44	09-Dec-81	PAGE	1-58


  1E0C                   C      BLBEG	EQU	WRK+12 
  1E0E                   C      BLEND	EQU	WRK+14 
  1E10                   C      OLDBLB	EQU	WRK+16 
  1E12                   C      OLDBLE	EQU	WRK+18 
  1E14                   C      BEGCOR	EQU	WRK+20 
  1E15                   C      ENDCOR	EQU	WRK+21 
  1E16                   C      SRMES	EQU	WRK+22 
  1E17                   C      RPMES	EQU	WRK+23 
  1E18                   C      NAMMES	EQU	WRK+24 
  1E19                   C      OLDMES	EQU	WRK+25 
  1E1A                   C      NEWMES	EQU	WRK+26 
  1E1B                   C      MODE	EQU	WRK+27 
  1E1C                   C      RMODE	EQU	WRK+28	; 1 
                         C       
  1E20                   C      SCRADR	EQU	WRK+32 
  1E22                   C      STRADR	EQU	WRK+34 
  1E24                   C      SCRBEG	EQU	WRK+36 
  1E26                   C      INFADR	EQU	WRK+38 
  1E28                   C      YSIZE	EQU	WRK+40 
  1E29                   C      YBEG	EQU	WRK+41 
  1E2A                   C      CURX	EQU	WRK+42 
  1E2B                   C      CURY	EQU	WRK+43 
  1E2C                   C      DISPOS	EQU	WRK+44 
  1E2D                   C      ?END	EQU	WRK+45 
                         C       
  1E2E                   C      SCRAD0	EQU	WRK+46 
  1E30                   C      STRAD0	EQU	WRK+48 
  1E32                   C      SCRBG0	EQU	WRK+50 
  1E34                   C      INFAD0	EQU	WRK+52 
  1E36                   C      YSIZE0	EQU	WRK+54 
  1E37                   C      YBEG0	EQU	WRK+55 
  1E38                   C      CURX0	EQU	WRK+56 
  1E39                   C      CURY0	EQU	WRK+57 
  1E3A                   C      DISPS0	EQU	WRK+58 
  1E3B                   C      ?StringBufActive	EQU	WRK+59 
                         C       
  1E3C                   C      ?WIN1	EQU	WRK+60 
                         C      ;PRSP	EQU	WRK+59 
  1E3D                   C      TABSRH	EQU	WRK+61 
                         C      ;?END	EQU	WRK+63 
  1E42                   C      SYM	EQU	WRK+66	; 1 
  1E61                   C      STRSR	EQU	WRK+97 
  1E6F                   C      STRREP	EQU	WRK+111 
  1E7D                   C      FILNAM	EQU	WRK+125 
  1E7D                   C      STRRED	EQU	WRK+125 
  153A                   C      PRSP:	DS	2 
                         C      IFNDEF	noend 
                         C      	END 
                         C      ENDIF 
                         C       
                         C       
                         C      include	E0DISP.ASM 
                         C      ;----- Display one editor string ---------- 
                         C       
                         C      ;include E0DISP.MAC 
                         C      ;include RK86.MAC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-59


                         C      IFNDEF	CURSM 
                         C      extrn CURSM 
                         C      EXTRN	DISP_ADR, DMA_ADR, VRAM_ADR 
                         C      ENDIF 
                         C       
  153C                   C      SETSCR:: 
  153C    2A 0109        C      	LHLD	DISP_ADR 
  153F    24             C      	INR	H 
  1540    25             C      	DCR	H 
  1541    CA 157F        C      	JZ	SETSCR2 
  1544    23             C      	INX	H 
  1545    36 00          C      	MVI	M,0 
  1547    2B             C      	DCX	H 
                         C       
                         C      IFDEF	Palmira 
                         C      	MVI	M,ScrWidth-1 
                         C      	MVI	M,(ScrHeight+5-1)+40H 
                         C      	MVI	M,0FFH 
                         C      ELSE 
  1548    36 4D          C      	MVI	M,ScrWidth-1 
  154A    36 1D          C      	MVI	M,(ScrHeight+5-1) 
  154C    36 99          C       	MVI	M,99H 
                         C      ENDIF 
  154E    77             C      	mov	m,a 
  154F    23             C      	INX	H 
  1550    36 27          C      	MVI	M,27H 
  1552    7E             C      	MOV	A,M 
  1553    7E             C      	MOV	A,M 
  1554    E6 20          C      	ANI	20H 
  1556    CA 1553        C      	JZ	$-3 
                         C       
                         C      	;LXI	H,DMA+8 
  1559    2A 010B        C      	LHLD	DMA_ADR 
  155C    C5             C      	PUSH	B 
  155D    01 0008        C      	LXI	B,8 
  1560    09             C      	DAD	B 
  1561    C1             C      	POP	B 
  1562    36 80          C      	MVI	M,80H 
  1564    E5             C      	PUSH	H ; DMA+8 
                         C      	;MVI	L,Low(DMA+4) 
  1565    2D             C      	DCR	L 
  1566    2D             C      	DCR	L 
  1567    2D             C      	DCR	L 
  1568    2D             C      	DCR	L 
  1569    C5             C      	PUSH	B 
  156A    EB             C      	XCHG 
  156B    2A 0103        C      	LHLD	VRAM_ADR 
  156E    01 FF0E        C      	LXI	B,-ScrOffset 
  1571    09             C      	DAD	B 
  1572    EB             C      	XCHG 
  1573    73             C      	MOV	M,E 
  1574    72             C      	MOV	M,D 
  1575    D1             C      	POP	D 
  1576    23             C      	INX	H 
  1577    36 23          C      	MVI	M,Low(ScrSize-1) 
  1579    36 49          C      	MVI	M,High(ScrSize-1) or 40h 
	MACRO-80 3.44	09-Dec-81	PAGE	1-60


                         C      	;MVI	L,Low(DMA+8) 
  157B    E1             C      	POP	H ; DMA+8 
  157C    36 A4          C      	MVI	M,0A4H 
  157E    C9             C      	RET 
                         C       
  157F                   C      SETSCR2: 
  157F    67             C      	MOV	H,A 
  1580    7D             C      	MOV	A,L 
  1581    32 15A0        C      	STA	SS02+1 
  1584    32 15A4        C      	STA	SS03+1 
  1587    32 15A8        C      	STA	SS04+1 
  158A    32 15AB        C      	STA	SS05+1 
  158D    3C             C      	INR	A 
  158E    32 159C        C      	STA	SS01+1 
  1591    32 15AF        C      	STA	SS06+1 
  1594    32 15B1        C      	STA	SS07+1 
  1597    32 15B3        C      	STA	SS08+1 
  159A    AF             C      	XRA	A 
  159B    D3 00          C      SS01:	out	0 
                         C       
  159D    3E 4D          C      	MVI	A,ScrWidth-1 
  159F    D3 00          C      SS02:	out	0 
  15A1    3E 5D          C      	MVI	A,(ScrHeight+5-1)+40H 
  15A3    D3 00          C      SS03:	out	0 
  15A5    3E FF          C      	MVI	A,0FFH 
  15A7    D3 00          C      SS04:	out	0 
  15A9    7C             C      	MOV	A,H 
  15AA    D3 00          C      SS05:	out	0 
                         C       
  15AC    3E 27          C      	MVI	A,27H 
  15AE    D3 00          C      SS06:	out	0 
  15B0    DB 00          C      SS07:	in	0 
  15B2    DB 00          C      SS08:	in	0 
  15B4    E6 20          C      	ANI	20H 
  15B6    CA 15B2        C      	JZ	SS08 
                         C       
                         C      	;LXI	H,DMA+8 
  15B9    3A 010B        C      	LDA	DMA_ADR 
  15BC    C6 08          C      	ADI	8 
  15BE    32 15D5        C      	STA	SS10 
  15C1    32 15F4        C      	STA	SS15 
  15C4    D6 04          C      	SUI	4 
  15C6    32 15E4        C      	STA	SS11+1 
  15C9    32 15E7        C      	STA	SS12+1 
  15CC    3C             C      	INR	A 
  15CD    32 15ED        C      	STA	SS13+1 
  15D0    32 15F1        C      	STA	SS14+1 
  15D3    3E 80          C      	MVI	A,80H 
  15D5    D3 00          C      SS10:	out	0 
                         C      	;MVI	L,Low(DMA+4) 
  15D7    C5             C      	PUSH	B 
  15D8    EB             C      	XCHG 
  15D9    2A 0103        C      	LHLD	VRAM_ADR 
  15DC    01 FF0E        C      	LXI	B,-ScrOffset 
  15DF    09             C      	DAD	B 
  15E0    D1             C      	POP	D 
	MACRO-80 3.44	09-Dec-81	PAGE	1-61


  15E1    EB             C      	XCHG 
  15E2    7B             C      	MOV	A,E 
  15E3    D3 00          C      SS11:	out	0 
  15E5    7A             C      	MOV	A,D 
  15E6    D3 00          C      SS12:	out	0 
  15E8    D1             C      	POP	D 
  15E9    23             C      	INX	H 
  15EA    3E 23          C      	MVI	A,Low(ScrSize-1) 
  15EC    D3 00          C      SS13:	out	0 
  15EE    3E 49          C      	MVI	A,High(ScrSize-1) or 40h 
  15F0    D3 00          C      SS14:	out	0 
                         C      	;MVI	L,Low(DMA+8) 
  15F2    3E A4          C      	MVI	A,0A4H 
  15F4    D3 00          C      SS15:	out	0 
  15F6    C9             C      	RET 
                         C      	 
  15F7                   C      SetCursor:: 
  15F7    D5             C      	PUSH	D 
  15F8    3E 80          C      	MVI	A,80H 
                         C      	;STA	DISP+1 
  15FA    EB             C      	XCHG 
  15FB    2A 0109        C      	LHLD	DISP_ADR 
  15FE    24             C      	INR	H 
  15FF    25             C      	DCR	H 
  1600    CA 1619        C      	JZ	SetCursor2 
  1603    23             C      	INX	H 
  1604    77             C      	MOV	M,A 
  1605    2B             C      	DCX	H 
  1606    7B             C      	MOV	A,E 
  1607    E5             C      	PUSH	H 
  1608    21 163D        C      	LXI	H,LPOS 
  160B    86             C      	ADD	M 
  160C    23             C      	INX	H 
  160D    86             C      	ADD	M 
  160E    E1             C      	POP	H 
  160F    3D             C      	DCR	A 
  1610    C6 08          C      	ADI	ScrXOffset 
                         C      	;STA	DISP 
  1612    77             C      	MOV	M,A 
  1613    7A             C      	MOV	A,D 
  1614    C6 02          C      	ADI	ScrYOffset-1 
                         C      	;STA	DISP 
  1616    77             C      	MOV	M,A 
  1617    D1             C      	POP	D 
  1618    C9             C      	RET 
                         C       
  1619                   C      SetCursor2: 
  1619    7D             C      	MOV	A,L 
  161A    32 1635        C      	STA	SC02+1 
  161D    32 163A        C      	STA	SC03+1 
  1620    3C             C      	INR	A 
  1621    32 1627        C      	STA	SC01+1 
  1624    3E 80          C      	MVI	A,80H 
  1626    D3 00          C      SC01:	out	0 
  1628    7B             C      	MOV	A,E 
  1629    E5             C      	PUSH	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-62


  162A    21 163D        C      	LXI	H,LPOS 
  162D    86             C      	ADD	M 
  162E    23             C      	INX	H 
  162F    86             C      	ADD	M 
  1630    E1             C      	POP	H 
  1631    3D             C      	DCR	A 
  1632    C6 08          C      	ADI	ScrXOffset 
                         C      	;STA	DISP 
  1634    D3 00          C      SC02:	out	0 
  1636    7A             C      	MOV	A,D 
  1637    C6 02          C      	ADI	ScrYOffset-1 
                         C      	;STA	DISP 
  1639    D3 00          C      SC03:	out	0 
  163B    D1             C      	POP	D 
  163C    C9             C      	RET 
                         C       
  163D    00             C      LPOS:	DB	0 
                         C      ;RK_END 
  163E                   C      @RK_END:: 
  163E    0000           C      	DW	0 
                         C      IFNDEF	noend 
                         C      	END 
                         C      ENDIF 
                         C      include	E0FILEIO.ASM 
                         C      ;******************************************************** 
                         C      ;*  SC80 text screen editor       File I/O module  Tape * 
                         C      ;*                        (c) TCHV,1989-93              * 
                         C      ;******************************************************** 
                         C       
                         C      IFNDEF	nivgr 
                         C      EXTRN	nivgr,werhgr,START,CURX,BLBEG,BLEND 
                         C      EXTRN	JMPBL,OUT1, MARK,DISADR 
                         C      ENDIF 
                         C       
                         C      IFNDEF	CPM 
                         C       
  1640    21 0000        C      RDFIL::	LXI	H,0 
  1643    CD F824        C      	CALL	0F824H 
  1646    EB             C      	XCHG 
  1647    22 1E02        C      	SHLD	werhgr 
  164A    C3 011D        C      	JMP	START 
                         C       
                         C       
  164D    2A 1E02        C      RDBL::	LHLD	werhgr 
  1650    23             C      	INX	H 
  1651    11 E000        C      	LXI	D,-2000H 
  1654    19             C      	DAD	D 
  1655    CD F824        C      	CALL	0F824H ; Read block from tape 
  1658    EB             C      	XCHG 
  1659    22 1E0E        C      	SHLD	BLEND 
  165C    2B             C      	DCX	H 
  165D    22 1E02        C      	SHLD    werhgr 
  1660    E1             C      	POP	H 
  1661    22 1E2A        C      	SHLD	CURX 
  1664    CD 1151        C      	CALL	JMPBL 
  1667    C3 0239        C      	JMP	OUT1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-63


                         C       
  166A                   C      WRFIL:: 
  166A    CD 1061        C      	CALL	MARK 
  166D    E5             C      	PUSH	H 
  166E    2A 1E00        C      	LHLD	nivgr 
  1671    EB             C      	XCHG 
  1672    2A 1E02        C      	LHLD	werhgr 
  1675    EB             C      	XCHG 
  1676    CD 1691        C      	CALL	WRSEG 
  1679    E1             C      	POP	H 
  167A    C3 1288        C      	JMP	DISADR 
                         C       
  167D    CD 1061        C      WRBL::	CALL	MARK 
  1680    E5             C      	PUSH	H 
  1681    2A 1E0C        C      	LHLD	BLBEG 
  1684    EB             C      	XCHG 
  1685    2A 1E0E        C      	LHLD	BLEND 
  1688    2B             C      	DCX	H 
  1689    EB             C      	XCHG 
  168A    CD 1691        C      	CALL	WRSEG 
  168D    E1             C      	POP	H 
  168E    C3 1288        C      	JMP	DISADR 
                         C       
                         C       
  1691                   C      WRSEG: 
  1691    CD F82A        C      	CALL	0F82AH ; Checksum calc 
  1694    C3 F827        C      	JMP	0F827H ; Write block to tape 
                         C      ELSE 
                         C      ; CPM 
                         C      FCB	EQU	5CH 
                         C      BUFF	EQU	80H 
                         C      RDFIL::	CALL	DISHDL 
                         C      RDFIL01: 
                         C      	JNZ	RDF0 
                         C      	CALL	INFPR 
                         C      	DW	0; INFSTR 
                         C      	DB	'NOT FOUND',80H 
                         C      	CALL	INPNAM 
                         C      	JMP	RDFIL01 
                         C       
                         C      RDF0:	LHLD	nivgr 
                         C      	CALL	RDBOD 
                         C      	LHLD	nivgr 
                         C      	MOV	D,H 
                         C      	MOV	E,L 
                         C      	CALL	CONVRT 
                         C      	XCHG 
                         C      	SHLD	werhgr 
                         C      	LXI	H,0 
                         C      	SHLD	BUFF 
                         C      	JMP	START 
                         C       
                         C       
                         C      RDBL::	LHLD	CURX 
                         C      	PUSH	H 
                         C      	CALL	DISHDL 
	MACRO-80 3.44	09-Dec-81	PAGE	1-64


                         C      RDB00:	JNZ	RDB0 
                         C      	CALL	INFPR 
                         C      	DW	0 
                         C      	DB	'NOT FOUND',80H 
                         C      	CALL	INPNAM 
                         C      	JMP	RDB00 
                         C       
                         C      RDB0:	LHLD	werhgr 
                         C      	INX	H 
                         C      	CALL	RDBOD 
                         C      	LHLD	werhgr 
                         C      	INX	H 
                         C      	SHLD	BLBEG 
                         C      	MOV	D,H 
                         C      	MOV	E,L 
                         C      	CALL	CONVR0 
                         C      	XCHG 
                         C      	SHLD	BLEND 
                         C      	DCX	H 
                         C      	SHLD    werhgr 
                         C      	POP	H 
                         C      	SHLD	CURX 
                         C      	CALL	JMPBL 
                         C      	JMP	OUT1 
                         C       
                         C       
                         C      CONVR0:	MOV	A,M 
                         C      	CPI	1AH 
                         C      	RZ 
                         C      	INX	H 
                         C      	CPI	0AH 
                         C      	JZ	CONVR0 
                         C      	STAX	D 
                         C      	INX	D 
                         C      	JMP	CONVR0 
                         C      CONVRT:	CALL	CONVR0 
                         C      CONV0:	DCX	D 
                         C      	LDAX	D 
                         C      	INX	D 
                         C      	CPI	0DH 
                         C      	JZ	CONV1 
                         C      	MVI	A,0DH 
                         C      	STAX	D 
                         C      	INX	D 
                         C      CONV1:	MVI	A,0FFH 
                         C      	STAX	D 
                         C      	RET 
                         C       
                         C       
                         C      DISHDL:	CALL	CLRSTR 
                         C      	CALL	INFPR 
                         C      	DW	1 
                         C      	DC	'READ' 
                         C      DISH0:	CALL	INFPR 
                         C      	DW	10 
                         C      	DC	'FILE:' 
	MACRO-80 3.44	09-Dec-81	PAGE	1-65


                         C      	LXI	H,FILNAM 
                         C      	LXI	B,NAMMES 
                         C      	CALL	INPSTR 
                         C      RD20:	CALL	INFPR 
                         C      	DW	33 
                         C      	DC	'FILE:' 
                         C      	LXI	H,FILNAM 
                         C      	LXI	D,FCB 
                         C      	CALL	GTFNAM 
                         C      	LXI	D,BUFF 
                         C      	MVI	C,1AH 
                         C      	CALL	5 
                         C      	LXI	D,FCB 
                         C      	MVI	C,11H 
                         C      	CALL	5	; SEARCH FIRST 
                         C      	INR	A 
                         C      	RZ 
                         C      	LXI	H,BUFF 
                         C      	LXI	B,20H 
                         C      DSP0:	DCR	A 
                         C      	JZ	DSP1 
                         C      	DAD	B 
                         C      	JMP	DSP0 
                         C      DSP1:	XCHG 
                         C      	PUSH	D 
                         C      	;LXI	H,INFSTR+38 
                         C      	CALL	GETINFADR 
                         C      	LXI	B,38 
                         C      	DAD	B 
                         C      	POP	D 
                         C      	INX	D 
                         C      	MVI	B,8 
                         C      	CALL	DSH00 
                         C      	MVI	A,'.' 
                         C      	MOV	M,A 
                         C      	INX	H 
                         C      	MVI	B,3 
                         C      DSH00:	LDAX	D 
                         C      	MOV	M,A 
                         C      	INX	H 
                         C      	INX	D 
                         C      	DCR	B 
                         C      	JNZ	DSH00 
                         C      	XRA	A 
                         C      	INR	A 
                         C      	RET 
                         C       
                         C      GTFNAM:	MOV	A,M 
                         C      	CPI	20H 
                         C      	JNZ	GTN99 
                         C      	INX	H 
                         C      	JMP	GTFNAM 
                         C      GTN99:	PUSH	D 
                         C      	XRA	A 
                         C      	MVI	C,36 ;25H 
                         C      	STAX	D 
	MACRO-80 3.44	09-Dec-81	PAGE	1-66


                         C      	INX	D 
                         C      	DCR	C 
                         C      	JNZ	$-3 
                         C      	POP	D 
                         C      	INX	H 
                         C      	MOV	A,M 
                         C      	DCX	H 
                         C      	CPI	':' 
                         C      	JNZ	GTNAM 
                         C      	MOV	A,M 
                         C      	INX	H 
                         C      	INX	H 
                         C      	ANI	0FFH-20H 
                         C      	SUI	40H 
                         C      	STAX	D 
                         C      GTNAM:	INX	D 
                         C      	MVI	C,8 
                         C      	CALL	GTN0 
                         C      	MOV	A,M 
                         C      	CPI	'.' 
                         C      	JNZ	$+4 
                         C      	INX	H 
                         C      	MVI	C,3 
                         C      	CALL	GTN0 
                         C      	RET 
                         C       
                         C      GTN0:	MOV	A,M 
                         C      	CPI	61H 
                         C      	JC	$+5 
                         C      	SUI	20H 
                         C      	INX	H 
                         C      	CPI	'.' 
                         C      	MVI	B,20H 
                         C      	JZ	GTN1 
                         C      	CPI	20H 
                         C      	JC	GTN1 
                         C      	CPI	'*' 
                         C      	MVI	B,'?' 
                         C      	JZ	GTN1 
                         C      	STAX	D 
                         C      	INX	D 
                         C      	DCR	C 
                         C      	JNZ	GTN0 
                         C       
                         C      GTN1:	MOV	A,B 
                         C      	INR	C 
                         C      	DCR	C 
                         C      	RZ 
                         C      	STAX	D 
                         C      	INX	D 
                         C      	JMP	$-4 
                         C       
                         C       
                         C      RDBOD:	PUSH	H	; READ FILE FROM DISK 
                         C      	LXI	D,FCB 
                         C      	MVI	C,0FH	; OPEN FILE 
	MACRO-80 3.44	09-Dec-81	PAGE	1-67


                         C      	CALL	5 
                         C      	INR	A 
                         C      	POP	H 
                         C      	JNZ	DS00 
                         C       
                         C      ERR1:	CALL	CLRSTR 
                         C      	CALL	INFPR 
                         C      	DW	39 
                         C      	DB	'UNABLE OPEN FILE',80H 
                         C      	CALL	GETCHR 
                         C      	JMP	START 
                         C       
                         C       
                         C      DS00: 
                         C      RDLOOP:	PUSH	H 
                         C      	XCHG 
                         C      	MVI	C,1AH 
                         C      	CALL	5 
                         C      	LXI	D,FCB 
                         C      	MVI	C,14H 
                         C      	CALL	5 
                         C      	POP	H 
                         C      	LXI	D,128 
                         C      	DAD	D 
                         C      	ORA	A 
                         C      	JZ	RDLOOP 
                         C      ; pokamest perepolnenie ne opredelqem 
                         C      	LXI	D,FCB 
                         C      	MVI	C,10H 
                         C      	CALL	5 
                         C      	;CALL	MAXRAM 
                         C      	;MVI	M,1AH 
                         C      	RET 
                         C       
                         C       
                         C      WRFIL:: 
                         C      	CALL	MARK 
                         C      	PUSH	H 
                         C      	CALL	DISHW 
                         C      	LHLD	nivgr 
                         C      	XCHG 
                         C      	LHLD	werhgr 
                         C      	XCHG 
                         C      	CALL	WRSEG 
                         C      	POP	H 
                         C      	JMP	DISADR 
                         C       
                         C      WRBL::	CALL	MARK 
                         C      	PUSH	H 
                         C      	CALL	DISHW 
                         C      	LHLD	BLBEG 
                         C      	XCHG 
                         C      	LHLD	BLEND 
                         C      	DCX	H 
                         C      	XCHG 
                         C      	CALL	WRSEG 
	MACRO-80 3.44	09-Dec-81	PAGE	1-68


                         C      	POP	H 
                         C      	JMP	DISADR 
                         C       
                         C       
                         C      WRSEG:	PUSH	H 
                         C      	PUSH	D 
                         C      	LXI	D,FCB 
                         C      	MVI	C,13H	; ERASE FILE 
                         C      	CALL	5 
                         C      	LXI	D,FCB 
                         C      	MVI	C,16H	; OPEN FILE 
                         C      	CALL	5 
                         C      	LXI	D,BUFF 
                         C      	MVI	C,1AH 
                         C      	CALL	5 
                         C      	POP	D 
                         C      	POP	H 
                         C      	PUSH	H 
                         C      	LXI	H,BUFF 
                         C      	MVI	B,80H 
                         C      	INX	D 
                         C      WRB00:	XTHL 
                         C      	CALL	CDEHL 
                         C      	JZ	WRB10 
                         C      	MOV	A,M 
                         C      	INX	H 
                         C      	XTHL 
                         C      	CPI	0FFH 
                         C      	JZ	WRB11 
                         C      	CPI	0DH 
                         C      	JNZ	$+8 
                         C      	CALL	TOBUF 
                         C      	MVI	A,0AH 
                         C      	CALL	TOBUF 
                         C      	JMP	WRB00 
                         C      TOBUF:	MOV	M,A 
                         C      	INX	H 
                         C      	DCR	B 
                         C      	RNZ 
                         C      PUSHS:	PUSH	D 
                         C      	LXI	D,FCB 
                         C      	MVI	C,15H 
                         C      	CALL	5 
                         C      	POP	D 
                         C      	MVI	B,80H 
                         C      	LXI	H,BUFF 
                         C      	RET 
                         C       
                         C      WRB10:	XTHL 
                         C      WRB11:	MVI	A,1AH 
                         C      	CALL	TOBUF 
                         C      	POP	H 
                         C      	MOV	A,B 
                         C      	CPI	80H 
                         C      	CNZ	PUSHS 
                         C      	LXI	D,FCB 
	MACRO-80 3.44	09-Dec-81	PAGE	1-69


                         C      	MVI	C,10H 
                         C      	CALL	5 
                         C      	RET 
                         C       
                         C       
                         C      DISHW:	CALL	CLRSTR 
                         C      	CALL	INFPR 
                         C      	DW	1 
                         C      	DC	'WRITE' 
                         C      	CALL	INFPR 
                         C      	DW	10 
                         C      	DC	'FILE:' 
                         C      INPNAM:	LXI	H,FILNAM 
                         C      	LXI	B,NAMMES 
                         C      	CALL	INPSTR 
                         C      	JMP	RD20 
                         C      ENDIF 
                         C       
                         C      IFNDEF	noend 
                         C      	END 
                         C      ENDIF 
                         C      include	E0GETC.ASM 
                         C      ; 
                         C      ;	E0GETC.ASM -	ED SC80  get symbol module (OS dependent) 
                         C      ;			RK version (hardware dependent) 
                         C      ;			Uses external PPI_ADR 
                         C       
  0040                   C      ?Ctrl	equ	40h 
  0020                   C      ?Shift	equ	20h 
                         C       
                         C      IFNDEF	PPI_ADR 
                         C      EXTRN	PPI_ADR 
                         C      ENDIF 
                         C       
                         C      ; Return SYMBOL and SHIFT/CNTRL flags 
                         C      ; 	40h - CNTRL  &  80h - SHIFT 
                         C      ;	B - SYMBOL or MASK 
                         C      ;	C - SYMBOL 
  1697                   C      GETCHC:: 
  1697    CD 16EC        C      	CALL	GETCHR 
  169A    E5             C      	PUSH	H 
  169B    F5             C      	push	psw 
  169C    E6 3F          C      	ANI	3FH 
  169E    4F             C      	MOV	C,A 
  169F    3A 1987        C      	LDA	@CTRL 
                         C      	;LDA	PPI+2 
  16A2    2A 0105        C      	LHLD	PPI_ADR 
  16A5    24             C      	INR	H 
  16A6    25             C      	DCR	H 
  16A7    CA 16C5        C      	JZ	GETCHC2 
  16AA    23             C      	INX	H 
  16AB    23             C      	INX	H 
  16AC    A6             C      	ANA	M 
  16AD    E5             C      	PUSH	H ; PPI+2 
  16AE    79             C      	MOV	A,C 
  16AF    C2 16B4        C      	JNZ	$+5 
	MACRO-80 3.44	09-Dec-81	PAGE	1-70


  16B2    F6 40          C      	ORI	40H 
  16B4    4F             C      	MOV	C,A 
                         C       
  16B5    3A 1988        C      	LDA	@SHFT 
  16B8    E1             C      	POP	H 
  16B9    A6             C      	ANA	M 
  16BA    79             C      	MOV	A,C 
  16BB    C2 16C0        C      	JNZ	$+5 
  16BE    F6 80          C      	ORI	80H 
  16C0    47             C      	mov	b,a 
  16C1    F1             C      	pop	psw 
  16C2    4F             C      	mov	c,a 
  16C3    E1             C      	POP	H 
  16C4    C9             C      	RET 
                         C       
  16C5                   C      GETCHC2: 
                         C      	;LDA	PPI+2 
  16C5    7D             C      	MOV	A,L 
  16C6    C6 02          C      	ADI	2 
  16C8    32 16D2        C      	STA	GTCHC01+1 
  16CB    32 16DF        C      	STA	GTCHC02+1 
  16CE    21 1987        C      	LXI	H,@CTRL 
  16D1                   C      GTCHC01: 
  16D1    DB 00          C      	IN	0 
  16D3    A6             C      	ANA	M 
  16D4    79             C      	MOV	A,C 
  16D5    C2 16DA        C      	JNZ	$+5 
  16D8    F6 40          C      	ORI	40H 
  16DA    4F             C      	MOV	C,A 
                         C       
  16DB    21 1988        C      	LXI	H,@SHFT 
  16DE                   C      GTCHC02: 
  16DE    DB 00          C      	IN	0 
  16E0    A6             C      	ANA	M 
  16E1    79             C      	MOV	A,C 
  16E2    C2 16E7        C      	JNZ	$+5 
  16E5    F6 80          C      	ORI	80H 
  16E7    47             C      	mov	b,a 
  16E8    F1             C      	pop	psw 
  16E9    4F             C      	mov	c,a 
  16EA    E1             C      	POP	H 
  16EB    C9             C      	RET 
                         C       
                         C       
                         C      IFDEF	CPM 
                         C      BIOS_CONIN: 
                         C      	LHLD	1 
                         C      	LXI	D,6 
                         C      	DAD	D 
                         C      	INX	H 
                         C      	MOV	E,M 
                         C      	INX	H 
                         C      	MOV	D,M 
                         C      	XCHG 
                         C      	INX	H 
                         C      	MOV	E,M 
	MACRO-80 3.44	09-Dec-81	PAGE	1-71


                         C      	INX	H 
                         C      	MOV	D,M 
                         C      	XCHG 
                         C      	PCHL 
                         C       
                         C      GETCHR:: 
                         C      	PUSH	H 
                         C      	PUSH	D 
                         C      	PUSH	B 
                         C      	CALL	BIOS_CONIN 
                         C      	POP	B 
                         C      	POP	D 
                         C      	POP	H 
                         C      	RET 
                         C       
                         C      if 0 
                         C      ; Perform key translation Acc->Acc (Reverse from CP/M) 
                         C      CorrCntrlRev: 
                         C      	push	h 
                         C      	push	b 
                         C      	mov	b,a 
                         C      	lxi	h,CorrTblRev 
                         C      @loop:	mov	a,m 
                         C      	inx	h 
                         C      	inx	h 
                         C      	inr	a 
                         C      	jz	@exit 
                         C      	dcr	a 
                         C      	cmp	b 
                         C      	jnz	@loop 
                         C      	dcx	h 
                         C      	mov	b,m 
                         C      @exit:	mov	a,b 
                         C      	ani	7fh 
                         C      	pop	b 
                         C      	pop	h 
                         C      	ret 
                         C       
                         C      ; Key translation table 
                         C      CorrTblRev: 
                         C      ;****  Arrow keys **** 
                         C      	db	'E'-40h,	19h	; Up 
                         C      	db	'X'-40h,	1Ah	; Down 
                         C      	db	'H'-40h,	8	; Left 
                         C      	db	'D'-40h,	18h	; Right 
                         C      ;*** Cntrl+Arrow keys *** 
                         C      	db	'R'-40h,	19h	; ^Up 
                         C      	db	'C'-40h,	1Ah	; ^Down 
                         C      	db	'A'-40h,	8	; ^Left 
                         C      	db	'F'-40h,	18h	; ^Right 
                         C      ;*** Other keys *** 
                         C      	db	8,	7fH 
                         C      	db	0ffh 
                         C      ENDIF 
                         C      ELSE 
                         C      ; Get character from concole (returns in Acc) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-72


  16EC                   C      GETCHR:: 
  16EC    E5             C      	PUSH	H 
  16ED    D5             C      	PUSH	D 
  16EE    C5             C      	PUSH	B 
  16EF    CD 16F6        C      	CALL	GTC 
                         C      	;CALL	0F803h 
  16F2    C1             C      	POP	B 
  16F3    D1             C      	POP	D 
  16F4    E1             C      	POP	H 
  16F5    C9             C      	RET 
                         C       
  16F6    2A 1966        C      GTC:	LHLD	PNT 
  16F9    7E             C      	MOV	A,M 
  16FA    FE FF          C      	CPI	0FFH 
  16FC    CA 1706        C      	JZ	GTCH0 
  16FF    23             C       	INX	H 
  1700    22 1966        C      	SHLD	PNT 
  1703    C3 1753        C      	JMP	??RUS 
                         C       
  1706    06 32          C      GTCH0:	MVI	B,50 
  1708    C5             C      RP3:	PUSH	B 
  1709    CD 1770        C      	CALL	GTVECT 
  170C    C1             C      	POP	B 
  170D    3A 1972        C      	LDA	NREP 
  1710    FE 01          C      	CPI	1 
  1712    C2 172A        C      	JNZ	RP1 
  1715    AF             C      	XRA	A 
  1716    32 1972        C      	STA	NREP 
  1719    05             C      	DCR	B 
  171A    C2 1708        C      	JNZ	RP3 
  171D    3C             C      	INR	A 
  171E    32 1972        C      	STA	NREP 
  1721    21 1968        C      	LXI	H,ET1 
  1724    22 1966        C      	SHLD	PNT 
  1727    C3 16F6        C      	JMP	GTC 
  172A    3A 1972        C      RP1:	LDA	NREP 
  172D    B7             C      	ORA	A 
  172E    C2 1748        C      	JNZ	RP01 
  1731    21 1968        C      	LXI	H,ET1 
  1734    23             C      RP02:	INX	H 
  1735    7E             C      	MOV	A,M 
  1736    FE FF          C      	CPI	0FFH 
  1738    C2 1734        C      	JNZ	RP02 
  173B    22 1966        C      	SHLD	PNT 
  173E    E5             C      	PUSH	H 
  173F    CD 1764        C      	CALL	MDEL 
  1742    E1             C      	POP	H 
  1743    2B             C      	DCX	H 
  1744    7E             C      	MOV	A,M 
  1745    C3 1753        C      	JMP	??RUS 
                         C       
  1748    CD 1764        C      RP01:	CALL	MDEL 
  174B    21 1968        C      	LXI	H,ET1 
  174E    7E             C      	MOV	A,M 
  174F    23             C      	INX	H 
  1750    22 1966        C      	SHLD	PNT 
	MACRO-80 3.44	09-Dec-81	PAGE	1-73


  1753    FE FE          C      ??RUS:	CPI	0FEH 
  1755    C0             C      	RNZ 
                         C      	;LDA	PPI+2 
  1756    E5             C      	PUSH	H 
  1757    2A 0105        C      	LHLD	PPI_ADR 
  175A    23             C      	INX	H 
  175B    23             C      	INX	H 
  175C    7E             C      	MOV	A,M 
  175D    EE 08          C      	XRI	8 
                         C      	;STA	PPI+2 
  175F    77             C      	MOV	M,A 
  1760    E1             C      	POP	H 
  1761    C3 16F6        C      	JMP	GTC 
                         C       
  1764    FB             C      MDEL:	EI 
  1765    21 03E8        C      	LXI	H,1000 
  1768    2B             C      RP2:	DCX	H 
  1769    7C             C      	MOV	A,H 
  176A    B5             C      	ORA	L 
  176B    C2 1768        C      	JNZ	RP2 
  176E    F3             C      	DI 
  176F    C9             C       	RET 
                         C       
                         C      ; (ET1) - Pressed keys vector (in order of press) 
                         C      ; (NREP) - Repeat number 
  1770    06 05          C      GTVECT:	MVI	B,5 
  1772    C5             C      GETC0:	PUSH	B 
  1773    3A 1965        C      	LDA	@RD 
  1776    B7             C      	ORA	A 
  1777    3E 00          C      	MVI	A,0 
  1779    32 1965        C      	STA	@RD 
  177C    C2 1782        C      	JNZ	$+6 
  177F    CD 181E        C      	CALL	KBDSCN 
  1782    C1             C      	POP	B 
  1783    21 1973        C      	LXI	H,PRESS 
  1786    7E             C      	MOV	A,M 
  1787    FE FF          C      	CPI	0FFH 
  1789    C2 1796        C      	JNZ	GTV04 
  178C    05             C      	DCR	B 
  178D    C2 1772        C      	JNZ	GETC0 
  1790    32 1968        C      	STA	ET1 
  1793    C3 1770        C      	JMP	GTVECT 
                         C       
  1796    21 197D        C      GTV04: 	LXI	H,ET2 
  1799    11 1968        C      	LXI	D,ET1 
  179C    E5             C      	PUSH	H 
  179D    D5             C      	PUSH	D 
  179E    1A             C      GTV08:	LDAX	D 
  179F    77             C      	MOV	M,A 
  17A0    23             C      	INX	H 
  17A1    13             C      	INX	D 
  17A2    FE FF          C      	CPI	0FFH 
  17A4    C2 179E        C      	JNZ	GTV08 
  17A7    D1             C      	POP	D 
  17A8    E1             C      	POP	H 
                         C       
	MACRO-80 3.44	09-Dec-81	PAGE	1-74


  17A9    7E             C      GTV00:	MOV	A,M 
  17AA    FE FF          C      	CPI	0FFH 
  17AC    CA 17CA        C      	JZ	GTV06 
                         C       
  17AF    01 1973        C      	LXI	B,PRESS 
  17B2    0A             C      GTV07:	LDAX	B 
  17B3    FE FF          C      	CPI	0FFH 
  17B5    CA 17C6        C      	JZ	GTV01 
  17B8    BE             C      	CMP	M 
  17B9    03             C      	INX	B 
  17BA    C2 17B2        C      	JNZ	GTV07 
  17BD    36 FD          C      	MVI	M,0FDH 
  17BF    12             C      	STAX	D 
  17C0    13             C      	INX	D 
  17C1    0B             C      	DCX	B 
  17C2    3E FD          C      	MVI	A,0FDH 
  17C4    02             C      	STAX	B 
  17C5    03             C      	INX	B 
  17C6    23             C      GTV01:	INX	H 
  17C7    C3 17A9        C      	JMP	GTV00 
                         C       
  17CA    01 1973        C      GTV06:	LXI	B,PRESS 
  17CD    0B             C      	DCX	B 
  17CE    03             C      GTV10:	INX	B 
  17CF    0A             C      	LDAX	B 
  17D0    FE FD          C      	CPI	0FDH 
  17D2    CA 17CE        C      	JZ	GTV10 
  17D5    FE FF          C      	CPI	0FFH 
  17D7    CA 17F4        C      	JZ	REP 
  17DA    0B             C      	DCX	B 
  17DB    03             C      GTV11:	INX	B 
  17DC    0A             C      	LDAX	B 
  17DD    FE FD          C      	CPI	0FDH 
  17DF    CA 17DB        C      	JZ	GTV11 
  17E2    FE FF          C      	CPI	0FFH 
  17E4    CA 17EC        C      	JZ	GTV22 
  17E7    12             C      	STAX	D 
  17E8    13             C      	INX	D 
  17E9    C3 17DB        C      	JMP	GTV11 
  17EC    AF             C      GTV22:	XRA	A 
  17ED    32 1972        C      	STA	NREP 
  17F0    3E FF          C      GTV21:	MVI	A,0FFH 
  17F2    12             C      	STAX	D 
  17F3    C9             C      	RET 
                         C       
  17F4    3A 1972        C      REP:	LDA	NREP 
  17F7    B7             C      	ORA	A 
  17F8    CA 1811        C      	JZ	GTV31 
  17FB    21 197D        C      	LXI	H,ET2 
  17FE    7E             C      GTV30:	MOV	A,M 
  17FF    23             C      	INX	H 
  1800    FE FF          C      	CPI	0FFH 
  1802    CA 1811        C      	JZ	GTV31 
  1805    FE FD          C      	CPI	0FDH 
  1807    CA 17FE        C      	JZ	GTV30 
  180A    AF             C      	XRA	A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-75


  180B    32 1972        C      	STA	NREP 
  180E    C3 17F0        C      	JMP	GTV21 
                         C       
  1811    3A 1972        C      GTV31:	LDA	NREP 
  1814    3C             C      	INR	A 
  1815    CA 17F0        C      	JZ	GTV21 
  1818    32 1972        C      	STA	NREP 
  181B    C3 17F0        C      	JMP	GTV21 
                         C       
                         C      ; (PRESS) -  Pressed keys vector (in order of discover) 
  181E    01 0040        C      KBDSCN:	LXI	B,40H 
  1821    21 1973        C      	LXI	H,PRESS 
  1824    11 807F        C      	LXI	D,807FH 
                         C       
  1827    C5             C      	PUSH	B 
                         C      	;LDA	PPI+2 
                         C      	;MOV	B,A 
  1828    E5             C      	PUSH	H 
  1829    2A 0105        C      	LHLD	PPI_ADR 
  182C    23             C      	INX	H 
  182D    23             C      	INX	H 
  182E    46             C      	MOV	B,M 
  182F    E1             C      	POP	H 
  1830    3A 1964        C      	LDA	@RUS 
  1833    A0             C      	ANA	B 
  1834    C2 183A        C      	JNZ	$+6 
  1837    36 FE          C      	MVI	M,0FEH 
  1839    23             C      	INX	H 
  183A    C1             C      	POP	B 
                         C       
  183B    CD 1849        C      NORM0:	CALL	?PRESS 
  183E    CC 1878        C      	CZ	FOUND 
  1841    04             C      	INR	B 
  1842    0D             C      	DCR	C 
  1843    C2 183B        C      	JNZ	NORM0 
  1846    36 FF          C      	MVI	M,0FFH 
  1848    C9             C      	RET 
                         C       
  1849    CD 1870        C      ?PRESS:	CALL	GETMSK 
  184C    E5             C      	PUSH	H 
  184D    2A 0105        C      	LHLD	PPI_ADR 
  1850    73             C      	MOV	M,E 
                         C      	;STA	PPI 
                         C      	;LDA	PPI+1 
  1851    00             C      	NOP 
  1852    00             C      	NOP 
  1853    00             C      	NOP 
  1854    23             C      	INX	H 
  1855    7E             C      	MOV	A,M 
  1856    E1             C      	POP	H 
  1857    A2             C      	ANA	D 
  1858    C0             C      	RNZ 
                         C       
  1859    E5             C      	PUSH	H 
  185A    21 00C8        C      	LXI	H,200 
  185D                   C      ?PRES0:	;LDA	PPI+1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-76


  185D    E5             C      	PUSH	H 
  185E    2A 0105        C      	LHLD	PPI_ADR 
  1861    23             C      	INX	H 
  1862    7E             C      	MOV	A,M 
  1863    E1             C      	POP	H 
  1864    A2             C      	ANA	D 
  1865    C2 186E        C      	JNZ	?PRES1 
  1868    2B             C      	DCX	H 
  1869    7C             C      	MOV	A,H 
  186A    B5             C      	ORA	L 
  186B    C2 185D        C      	JNZ	?PRES0 
  186E    E1             C      ?PRES1:	POP	H 
  186F    C9             C      	RET 
                         C       
                         C       
  1870    7A             C      GETMSK:	MOV	A,D 
  1871    07             C      	RLC 
  1872    57             C      	MOV	D,A 
  1873    D0             C      	RNC 
  1874    7B             C      	MOV	A,E 
  1875    07             C      	RLC 
  1876    5F             C      	MOV	E,A 
  1877    C9             C      	RET 
                         C       
  1878    E5             C      FOUND:	PUSH	H 
  1879    D5             C      	PUSH	D 
  187A    C5             C      	PUSH	B 
  187B    58             C      	MOV	E,B 
  187C    16 00          C      	MVI	D,0 
  187E    21 1924        C      	LXI	H,KEYBRD 
  1881    19             C      	DAD	D 
  1882    7E             C      	MOV	A,M 
  1883    5F             C      	MOV	E,A 
                         C       
  1884    FE 21          C      	CPI	21H 
  1886    D4 1890        C      	CNC	MODCHR 
  1889    7B             C      	MOV	A,E 
  188A    C1             C      	POP	B 
  188B    D1             C      	POP	D 
  188C    E1             C      	POP	H 
  188D    77             C      	MOV	M,A 
  188E    23             C      	INX	H 
  188F    C9             C      	RET 
                         C       
  1890    5F             C      MODCHR:	MOV	E,A 
  1891    FE 40          C      	CPI	40H 
  1893    D2 189B        C      	JNC	MOD4 
  1896    FE 3C          C      	CPI	3CH 
  1898    D2 18C7        C      	JNC	MOD3 
  189B                   C      MOD4:	;LDA	PPI+2 
  189B    E5             C      	PUSH	H 
  189C    2A 0105        C      	LHLD	PPI_ADR 
  189F    23             C      	INX	H 
  18A0    23             C      	INX	H 
  18A1    46             C      	MOV	B,M 
  18A2    E1             C      	POP	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-77


                         C      	;MOV	B,A 
  18A3    3A 1987        C      	LDA	@CTRL 
  18A6    A0             C      	ANA	B 
  18A7    CA 18D7        C      	JZ	SCTRL 
                         C      	;LDA	PPI+2 
  18AA    E5             C      	PUSH	H 
  18AB    2A 0105        C      	LHLD	PPI_ADR 
  18AE    23             C      	INX	H 
  18AF    23             C      	INX	H 
  18B0    7E             C      	MOV	A,M 
  18B1    E1             C      	POP	H 
  18B2    E6 08          C      	ANI	8 
  18B4    C2 18DF        C      	JNZ	SHIFT0 
                         C      	;LDA	PPI+2 
                         C      	;MOV	B,A 
  18B7    E5             C      	PUSH	H 
  18B8    2A 0105        C      	LHLD	PPI_ADR 
  18BB    23             C      	INX	H 
  18BC    23             C      	INX	H 
  18BD    46             C      	MOV	B,M 
  18BE    E1             C      	POP	H 
                         C       
  18BF    3A 1988        C      	LDA	@SHFT 
  18C2    A0             C      	ANA	B 
  18C3    CA 18F9        C      	JZ	@SHIFT 
  18C6    C9             C      	RET 
                         C       
  18C7                   C      MOD3:	;LDA	PPI+2 
                         C      	;MOV	B,A 
  18C7    E5             C      	PUSH	H 
  18C8    2A 0105        C      	LHLD	PPI_ADR 
  18CB    23             C      	INX	H 
  18CC    23             C      	INX	H 
  18CD    46             C      	MOV	B,M 
  18CE    E1             C      	POP	H 
  18CF    3A 1988        C      	LDA	@SHFT 
  18D2    A0             C      	ANA	B 
  18D3    C2 1904        C      	JNZ	SH3 
  18D6    C9             C      	RET 
                         C       
  18D7    7B             C      SCTRL:	MOV	A,E 
  18D8    FE 40          C      	CPI	40H 
  18DA    D8             C      	RC 
  18DB    D6 40          C      	SUI	40H 
  18DD    5F             C      	MOV	E,A 
  18DE    C9             C      	RET 
                         C       
  18DF                   C      SHIFT0:	;LDA	PPI+2 
                         C      	;MOV	B,A 
  18DF    E5             C      	PUSH	H 
  18E0    2A 0105        C      	LHLD	PPI_ADR 
  18E3    23             C      	INX	H 
  18E4    23             C      	INX	H 
  18E5    46             C      	MOV	B,M 
  18E6    E1             C      	POP	H 
  18E7    3A 1988        C      	LDA	@SHFT 
	MACRO-80 3.44	09-Dec-81	PAGE	1-78


  18EA    A0             C      	ANA	B 
  18EB    CA 1912        C      	JZ	SH5 
  18EE    7B             C      	MOV	A,E 
  18EF    FE 40          C      	CPI	40H 
  18F1    D8             C      	RC 
  18F2    FE 7F          C      	CPI	07Fh 
  18F4    C8             C      	RZ 
  18F5    C6 20          C      	ADI	20H 
  18F7    5F             C      	MOV	E,A 
  18F8    C9             C      	RET 
                         C       
  18F9                   C      @SHIFT:	;LDA	PPI+2 
  18F9    E5             C      	PUSH	H 
  18FA    2A 0105        C      	LHLD	PPI_ADR 
  18FD    23             C      	INX	H 
  18FE    23             C      	INX	H 
  18FF    7E             C      	MOV	A,M 
  1900    E1             C      	POP	H 
  1901    E6 08          C      	ANI	8 
  1903    C0             C      	RNZ 
  1904    7B             C      SH3:	MOV	A,E 
  1905    FE 40          C      	CPI	40H 
  1907    DA 1912        C      	JC	SH5 
  190A    FE 7F          C      	CPI	7Fh 
  190C    C8             C      	rz 
  190D    C6 20          C      	ADI	20H 
  190F    C3 1918        C      	JMP	SH1 
  1912    7B             C      SH5:	MOV	A,E 
  1913    FE 40          C      	CPI	40H 
  1915    DA 191A        C      	JC	SB 
  1918    5F             C      SH1:	MOV	E,A 
  1919    C9             C      	RET 
  191A    D6 10          C      SB:	SUI	10H 
  191C    FE 20          C      	CPI	20H 
  191E    C2 1918        C      	JNZ	SH1 
  1921    1E 5F          C      	MVI	E,5Fh 
  1923    C9             C      	RET 
                         C       
                         C       
  1924    0C 1F 1B 00    C      KEYBRD:	DB	0CH,1FH,1BH,0,1,2,3,4 
  1928    01 02 03 04    C      
  192C    09 0A 0D       C      	DB	9,0AH,0DH 
  192F    7F             C      	DB	7FH; Here was 5FH 
  1930    08 19 18 1A    C      	DB	8,19H,18H,1AH 
  1934    30 31 32 33    C      	DB	'0123456789:;<=>?' 
  1938    34 35 36 37    C      
  193C    38 39 3A 3B    C      
  1940    3C 3D 3E 3F    C      
  1944    40 41 42 43    C      	DB	'@ABCDEFGHIJKLMNO' 
  1948    44 45 46 47    C      
  194C    48 49 4A 4B    C      
  1950    4C 4D 4E 4F    C      
  1954    50 51 52 53    C      	DB	'PQRSTUVWXYZ[\]^ ' 
  1958    54 55 56 57    C      
  195C    58 59 5A 5B    C      
  1960    5C 5D 5E 20    C      
	MACRO-80 3.44	09-Dec-81	PAGE	1-79


                         C       
                         C       
  1964    80             C      @RUS:	DB	80H 
  1965    00             C      @RD:	DB	0 
                         C       
  1966    1968           C      PNT:	DW	ET1 
  1968    FF             C      ET1:	DB	0ffh 
  1969                   C      	ds	9 
                         C      	;DSEG 
  1972                   C      NREP:	DS	1 
  1973                   C      PRESS:	DS	10 
  197D                   C      ET2:	DS	10 
                         C      ENDIF 
  1987    40             C      @CTRL:	DB	?Ctrl 
  1988    20             C      @SHFT:	DB	?Shift 
                         C      IFNDEF	noend 
                         C      	END 
                         C      ENDIF 
                         C       
                         C       
                         C      include	E0CMDT.ASM 
                         C      ;******************************************************** 
                         C      ;*  SC80 text screen editor       COMMAND table module  * 
                         C      ;*                        (c) TCHV,1989-93              * 
                         C      ;******************************************************** 
                         C       
                         C       
                         C      IFNDEF INFADR 
                         C      INCLUDE E0DISP.MAC 
                         C      PUBLIC	FNDCMD 
                         C      EXTRN INFADR 
                         C      ENDIF 
                         C       
  0008                   C      @Left		equ	8h 
  0018                   C      @Right		equ	18h 
  0019                   C      @Up		equ	19h 
  001A                   C      @Down		equ	1Ah 
  001F                   C      @Str		equ	31 
  0080                   C      Shift		equ	80h 
  0040                   C      Cntrl		equ	40h 
                         C       
                         C       
                         C      CMD	MACRO	Adr1,Key1,Adr2,Key2 
                         C      ;extrn	Adr1 
                         C      	DW	Adr1,Key1 
                         C      	ifnb	<Adr2> 
                         C      ;extrn	Adr2 
                         C      	DW	Adr2,Key2 
                         C      	endif 
                         C      	ENDM 
                         C       
                         C      	;dseg 
                         C      ; *** Editor command table *** 
                         C      ; DW CMD_ADDR 
                         C      ; DB First Command sym, should be ANDed with 40h or ORed with 40h if Ctrl assumed pressed 
                         C      ; DB Second command sym or 0 
	MACRO-80 3.44	09-Dec-81	PAGE	1-80


  1989                   C      CMDTBL:: 
                         C      	CMD	LFTM,	@Left,		RHTM,	@Right 
  1989    07DE 0008      C+     	DW	LFTM,@Left 
  198D    07E5 0018      C+     	DW	RHTM,@Right 
                         C      	CMD	UPM,	@Up,		DWNM,	@Down 
  1991    07EC 0019      C+     	DW	UPM,@Up 
  1995    07F5 001A      C+     	DW	DWNM,@Down 
                         C      	CMD	SCRLUP,	Shift+@Up,	SCRLDN,	Shift+@Down 
  1999    07FE 0099      C+     	DW	SCRLUP,Shift+@Up 
  199D    0807 009A      C+     	DW	SCRLDN,Shift+@Down 
                         C      	CMD	REPMOD,	2 
  19A1    08AA 0002      C+     	DW	REPMOD,2 
  19A5    0000           C      	DW	0 
                         C       
                         C      	CMD	INSCTRL,0 
  19A7    0931 0000      C+     	DW	INSCTRL,0 
                         C      	CMD	LDEL,	3Fh,		RDEL,	3 
  19AB    0879 003F      C+     	DW	LDEL,3Fh 
  19AF    0884 0003      C+     	DW	RDEL,3 
                         C      	CMD	TAB,	9,		BSC,	12 
  19B3    08BE 0009      C+     	DW	TAB,9 
  19B7    08B5 000C      C+     	DW	BSC,12 
                         C      	CMD	CR,	13,		REST,	27 
  19BB    08DB 000D      C+     	DW	CR,13 
  19BF    08CC 001B      C+     	DW	REST,27 
                         C      	CMD	DELLT,	Cntrl+1,	DELRT,	Cntrl+3 
  19C3    0EF6 0041      C+     	DW	DELLT,Cntrl+1 
  19C7    0F45 0043      C+     	DW	DELRT,Cntrl+3 
                         C      	CMD	LEND,	Cntrl+@Left,	REND,	Cntrl+@Right 
  19CB    0EC6 0048      C+     	DW	LEND,Cntrl+@Left 
  19CF    0ECC 0058      C+     	DW	REND,Cntrl+@Right 
                         C      	CMD	INSSPC,	Cntrl+2,	BRKSTR,	Cntrl+13 
  19D3    0EED 0042      C+     	DW	INSSPC,Cntrl+2 
  19D7    0EDB 004D      C+     	DW	BRKSTR,Cntrl+13 
  19DB    0000           C      	DW	0 
                         C       
                         C      	CMD	JoinStr,'J' 
  19DD    0F71 004A      C+     	DW	JoinStr,'J' 
  19E1    0000           C      	DW	0 
                         C       
                         C      	CMD	CALC,	@Str+'C'*256;,	ASSM	@Str+'A'*256 
  19E3    1366 431F      C+     	DW	CALC,@Str+'C'*256 
                         C      	CMD	SEARCH,	@Str+'S'*256,	REPLACE,@Str+'R'*256 
  19E7    0E02 531F      C+     	DW	SEARCH,@Str+'S'*256 
  19EB    0D1C 521F      C+     	DW	REPLACE,@Str+'R'*256 
                         C      	CMD	NEW,	@Str+'N'*256;,	VERIFY,	@Str+'V'*256 
  19EF    0BD7 4E1F      C+     	DW	NEW,@Str+'N'*256 
                         C      	CMD	BEGBUF,	@Str+@Up*256,	ENDBUF,	@Str+@Down*256 
  19F3    0F89 191F      C+     	DW	BEGBUF,@Str+@Up*256 
  19F7    0FA1 1A1F      C+     	DW	ENDBUF,@Str+@Down*256 
                         C      	CMD	EXIT,	@Str+'E'*256 
  19FB    14B5 451F      C+     	DW	EXIT,@Str+'E'*256 
                         C      	CMD	RDFIL,	@Str+('R'-Cntrl)*256 
  19FF    1640 121F      C+     	DW	RDFIL,@Str+('R'-Cntrl)*256 
                         C      	CMD	WRFIL,	@Str+('W'-Cntrl)*256 
  1A03    166A 171F      C+     	DW	WRFIL,@Str+('W'-Cntrl)*256 
	MACRO-80 3.44	09-Dec-81	PAGE	1-81


                         C      	CMD	PAGEUP,	Cntrl+@Up,	PAGEDN,	Cntrl+@Down 
  1A07    0FBD 0059      C+     	DW	PAGEUP,Cntrl+@Up 
  1A0B    0FEB 005A      C+     	DW	PAGEDN,Cntrl+@Down 
                         C       
                         C      	CMD	DELLIN,	'D', 	CONT_SRREP, 	'L' ; Continue SEARCH/REPLACE 
  1A0F    100D 0044      C+     	DW	DELLIN,'D' 
  1A13    0CEF 004C      C+     	DW	CONT_SRREP,'L' 
                         C      	CMD	SWPWIN,	'W', WINUP,'U' 
  1A17    0A4D 0057      C+     	DW	SWPWIN,'W' 
  1A1B    0A7C 0055      C+     	DW	WINUP,'U' 
                         C      	CMD	WINDN,	'K' 
  1A1F    0AF8 004B      C+     	DW	WINDN,'K' 
                         C       
                         C      	;*****	Block	commands ***** 
                         C      	CMD	DISBEG,	'Q'+@Left*256,	DISEND,	'Q'+@Right*256 
  1A23    1055 0851      C+     	DW	DISBEG,'Q'+@Left*256 
  1A27    105B 1851      C+     	DW	DISEND,'Q'+@Right*256 
                         C      	CMD	MRBEG,	'Q'+@Up*256,	MREND,	'Q'+@Down*256 
  1A2B    1070 1951      C+     	DW	MRBEG,'Q'+@Up*256 
  1A2F    1077 1A51      C+     	DW	MREND,'Q'+@Down*256 
                         C      	CMD	RDBL,	'Q'+('R'-Cntrl)*256 
  1A33    164D 1251      C+     	DW	RDBL,'Q'+('R'-Cntrl)*256 
  1A37    0000           C      	DW	0 
                         C      	CMD	DELBL,	'Q'+('D'-Cntrl)*256 
  1A39    107E 0451      C+     	DW	DELBL,'Q'+('D'-Cntrl)*256 
                         C      	CMD	WRBL,	'Q'+('W'-Cntrl)*256 
  1A3D    167D 1751      C+     	DW	WRBL,'Q'+('W'-Cntrl)*256 
                         C      	CMD	COPYBL,	'Q'+('C'-Cntrl)*256 
  1A41    1102 0351      C+     	DW	COPYBL,'Q'+('C'-Cntrl)*256 
                         C      	CMD	JMPBL,	'Q'+('J'-Cntrl)*256 
  1A45    1151 0A51      C+     	DW	JMPBL,'Q'+('J'-Cntrl)*256 
  1A49    0000           C      	DW	0 
                         C       
  1A4B                   C      	cseg 
                         C       
                         C      ; **************  Find disk command **************** 
                         C      ; Executes command or returns if command not found 
                         C      ; c - first char of command sequence ;  HL - pointer to command table 
  1A4B    23             C      FNDCMD:	INX	H 
  1A4C    34             C      	inr	m	; Test High byte of command adress 
  1A4D    35             C      	dcr	m 
  1A4E    23             C      	INX	H 
  1A4F    C8             C      	rz	; Return if command not found 
  1A50    79             C      	mov	a,c 
  1A51    BE             C      	CMP	M 
  1A52    CA 1A5D        C      	JZ	FirstSym	; First symbol is ok 
  1A55    23             C      	INX	H 
  1A56                   C      ContCmdSearch: 
  1A56    23             C      	INX	H 
  1A57    C2 1A4B        C      	JNZ	FNDCMD 
  1A5A    13             C      	INX	D 
  1A5B    13             C      	INX	D 
  1A5C    C9             C      	RET 
                         C       
  1A5D                   C      FirstSym: 
  1A5D    23             C      	INX	H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-82


  1A5E    34             C      	INR	M 
  1A5F    35             C      	DCR	M	; is second symbol required 
  1A60    CA 1A81        C      	JZ	CmdFound 
                         C       
  1A63    E5             C      	push	h 
  1A64    4F             C      	MOV	C,A 
                         C      	;lxi	h,INFSTR+1 
  1A65    CD 1335        C      	CALL	GETINFADR 
  1A68    23             C      	INX	H 
                         C      	SetScrAddr 
  1A69    3E 5E          C      	MVI	A,'^' 
                         C      	WriteNextSym 
  1A6B    77             C+     		mov	m,a 
  1A6C    23             C+     		inx	h 
                         C       
  1A6D    79             C      	mov	a,c 
  1A6E    E6 3F          C      	ANI	3FH 
  1A70    C6 40          C      	ADI	40H 
                         C      	WriteNextSym 
  1A72    77             C+     		mov	m,a 
  1A73    23             C+     		inx	h 
  1A74    E1             C      	POP	H 
                         C       
  1A75    78             C      	MOV	A,B	; Read next symbol if needed 
  1A76    B7             C      	ORA	A 
  1A77    CC 16EC        C      	CZ	GETCHR 
  1A7A    E6 DF          C      	ani	11011111b	; toupper(Acc) 
  1A7C    47             C      	MOV	B,A 
  1A7D    BE             C      	CMP	M 
  1A7E    C2 1A56        C      	JNZ	ContCmdSearch 
                         C       
  1A81                   C      CmdFound: 
  1A81    D1             C      	pop	d	; Drop	return address 
  1A82    2B             C      	dcx	h 
  1A83    2B             C      	dcx	h 
  1A84    56             C      	mov	d,m 
  1A85    2B             C      	dcx	h 
  1A86    5E             C      	mov	e,m 
  1A87    EB             C      	XCHG 
  1A88    E9             C      	PCHL 
                         C       
                         C      	END 
	MACRO-80 3.44	09-Dec-81	PAGE	S


Macros:
@IN             @OUT            CHECK_BREAK     CMD             GETSYM          
INIT_BRK_CHECK  SETSCRADDR      WRITENEXTSYM    

Symbols:
0E59 	..0000          0E70 	..0001          1477 	?01             
147F 	?02             148B 	?21             149D 	?22             
14A4 	?23             1753 	??RUS           14AA 	?ABSHL          
0040 	?CTRL           1484 	?DVNHD          1E2D 	?END            
142B 	?FBBC0          1426 	?FBBCD          1440 	?FBCB0          
143A 	?FBCDB          1470 	?MULHD          14AD 	?NEGHL          
14AE 	?NOTHL          0993 	?OUT            185D 	?PRES0          
186E 	?PRES1          1849 	?PRESS          0020 	?SHIFT          
1E3B 	?STRINGBUFACTIVE 1E3C 	?WIN1           1505 	_BLANKEOS       
152E 	_CONTSKIPPING   14C7 	_DISPNXTCHR     14EF 	_DISPTAB        
14F3 	_DSPT           14DF 	_EOS            1512 	_SKIPSYMS       
14E4 	_SKIPTOEOL      1524 	_SKTABLP        03A7 	@10             
03A7 	@101            0396 	@11             03A1 	@110            
03B3 	@12             0383 	@220            0388 	@221            
03A5 	@9              01AF 	@@000           0001 	@BACKSP_KEY     
0E5F 	@CONT           1987 	@CTRL           001A 	@DOWN           
0003 	@EXIT_KEY       0000 	@EXTEND_KEY     0008 	@LEFT           
0E2E 	@NOUPCASE       1354 	@PRNT           0C15 	@PUT_STR        
1965 	@RD             0018 	@RIGHT          163EI 	@RK_END         
1964 	@RUS            1988 	@SHFT           18F9 	@SHIFT          
0E3C 	@SRHLOOP        0E3C 	@SRHLP          001F 	@STR            
0019 	@UP             0E23 	@UPCASE_LP      0E9C 	ABSRH           
0839 	ANDR            0F89I 	BEGBUF          1E14 	BEGCOR          
1E0CI 	BLBEG           1E0EI 	BLEND           1239 	BLKSIZ          
1314 	BPR             1325 	BPR01           131C 	BPR1            
0EDBI 	BRKSTR          08B5I 	BSC             0B84 	BSCR            
0A35 	CAD             0A39 	CAD1            13DF 	CADD            
0A41 	CADR1           0A45 	CADR11          1366I 	CALC            
137E 	CALC0           0457 	CALCNEXTTABPOS  1532 	CALCTAB         
0BA2 	CB0             0B93 	CB00            0BBC 	CB1             
110E 	CBL             111E 	CBL1            0427 	CC0             
0440 	CC1             044D 	CC2             0448 	CC3             
07D8I 	CDEHL           1143 	CHBL            02A0 	CHECKMEM        
02AE 	CHKM0           0785 	CHKMEM          0A21 	CHKPNT          
0CBF 	CLR0            0CA6 	CLR1            0CB0I 	CLRSTR          
0AE7 	CLRW1           0B73 	CLRWD1          024D 	CLS             
025B 	CLSLOOP         1A81 	CMDFOUND        1989I 	CMDTBL          
0040 	CNTRL           0304 	COMCUR          02FF 	COMP0           
02EF 	COMP1           0315 	COMP2           0326 	COMP3           
0728 	COMPADR         02E9 	COMPST          13B8 	COMPUTE         
1A56 	CONTCMDSEARCH   0DF7I 	CONT_SRH        0CEF 	CONT_SRREP      
1102I 	COPYBL          0A0C 	COR             07B9 	CORPNT          
0A0B 	CORR            09E2 	CORRECT         1458 	CORR_A          
08DBI 	CR              08EA 	CR0             07D2 	CRPNT0          
07D6 	CRPNT1          07D0 	CRPNT2          13E4 	CSUB            
041C 	CURCM           0465 	CURM            04A3 	CURM1           
046EI 	CURSM           00E3 	CURSOR_BLOCK    00D3 	CURSOR_LINE     
1E0A 	CURSTR          1E2AI 	CURX            1E38 	CURX0           
1E2B 	CURY            1E39 	CURY0           0719 	D0              
0355 	D01             0717 	D1              12CA 	DA1             
12CC 	DA2             12B6 	DAD0            12AB 	DAD1            
	MACRO-80 3.44	09-Dec-81	PAGE	S-1


108D 	DBL             02E1 	DCRCUR          03B5 	DELAY0          
107EI 	DELBL           0872 	DELCOR          001B 	DELIMSYM        
100DI 	DELLIN          0EF6I 	DELLT           0F45I 	DELRT           
12D5 	DI3             095C 	DIS00           0981 	DIS01           
130A 	DISAD0          12D9 	DISAD1          1288I 	DISADR          
0938 	DISALL          1055I 	DISBEG          02BE 	DISCUR          
105BI 	DISEND          032B 	DISPLY          1E2C 	DISPOS          
1E3A 	DISPS0          0109I 	DISP_ADR        14BBI 	DISSTR          
102C 	DLCOR           010BI 	DMA_ADR         0712 	DNSHT           
0FF0 	DR3             0FA1 	DREND           0280 	DRLIN           
12FB 	DS0             1305 	DS1             12F9 	DS5             
12E3 	DS6             12F3 	DSAD0           033B 	DSPL0           
0343 	DSPL1           1286 	DSTADR          07F5I 	DWNM            
0C2D 	EDIT_LINE       0FA1I 	ENDBUF          1E15 	ENDCOR          
13E1 	ERR             1968 	ET1             197D 	ET2             
14B5I 	EXIT            0C90 	EXIT_INP_STR    1E7DI 	FILNAM          
099C 	FILSP           1A5D 	FIRSTSYM        1A4B 	FNDCMD          
1878 	FOUND           1407 	GET1            13F3 	GET2            
1415 	GET3            1417 	GET4            1423 	GET5            
03E2 	GETC            1772 	GETC0           1697I 	GETCHC          
16C5 	GETCHC2         16ECI 	GETCHR          1335 	GETINFADR       
F830 	GETMAXMEM       1870 	GETMSK          13EA 	GETVL1          
0C46 	GET_KEY         1244 	GLBSIZ          126A 	GREXD           
1272 	GREXD0          1273 	GREXD1          124E 	GREXU           
1256 	GREXU0          1257 	GREXU1          16F6 	GTC             
03EF 	GTC0            0405 	GTC1            0413 	GTC2            
0417 	GTC3            1706 	GTCH0           16D1 	GTCHC01         
16DE 	GTCHC02         17A9 	GTV00           17C6 	GTV01           
1796 	GTV04           17CA 	GTV06           17B2 	GTV07           
179E 	GTV08           17CE 	GTV10           17DB 	GTV11           
17F0 	GTV21           17EC 	GTV22           17FE 	GTV30           
1811 	GTV31           1770 	GTVECT          0638 	I00             
064F 	I01             0668 	I02             0663 	I03             
06E6 	I04             06F2 	I06             069D 	I08             
06AD 	I09             0C93 	IN4             10F4 	INBLD           
10C3 	INBLK           1E34 	INFAD0          1E26I 	INFADR          
045D 	INFCRM          133FI 	INFPR           0750 	INFSTR_OFFS     
0266 	INIT            0CD7 	INPSR           0C2AI 	INPSTR          
0C11 	INPUT_AND_SHOW  02D9 	INRCUR          0A1A 	INSCOR          
0931I 	INSCTRL         1030 	INSERT          06B5 	INSR1           
0690 	INSRED          0EEDI 	INSSPC          09BA 	INSSYM          
0C79 	INS_SYM         1099 	INV_H           10CE 	JBLCD           
10A0 	JBLCU           11FA 	JBLD            1189 	JBLDN           
117A 	JBLEX           11C6 	JBLU            1163 	JBLUP           
1151I 	JMPBL           0F71I 	JOINSTR         181E 	KBDSCN          
1924 	KEYBRD          0010 	KRAJ            0F41 	LDC0            
0F23 	LDCOR           0879I 	LDEL            0490 	LEFT            
0EC6I 	LEND            07DEI 	LFTM            0C9C 	LINE            
001C 	LINESYM         0017 	LOGICHEIGHT     0040 	LOGICWIDTH      
163D 	LPOS            0173 	M00             0170 	M01             
081C 	M03             106C 	MAR0            1061I 	MARK            
007F 	MAXLEN          0243I 	MAXRAM          000F 	MAXSTRLEN       
1764 	MDEL            18C7 	MOD3            189B 	MOD4            
1890 	MODCHR          1E1B 	MODE            0480 	MOVCUR          
0C43 	MOVE_CURS       1070I 	MRBEG           1077I 	MREND           
1E18I 	NAMMES          0BD7I 	NEW             0C0A 	NEW1            
	MACRO-80 3.44	09-Dec-81	PAGE	S-2


1E1A 	NEWMES          0593 	NEXTST          1E00I 	NIVGR           
1463 	NOCR1           146D 	NOCR2           0001 	NOEND           
183B 	NORM0           0E82 	NOTFOUND        0C54 	NO_EXTEND       
1972 	NREP            1E08 	NUMSTR          05A0 	NXTS0           
1E10 	OLDBLB          1E12 	OLDBLE          1E19 	OLDMES          
0239I 	OUT1            023C 	OUT3            103A 	OVRW            
0FEBI 	PAGEDN          0FBDI 	PAGEUP          1966 	PNT             
0107 	PPI2_ADR        0105I 	PPI_ADR         0921 	PRC00           
0904 	PRCH0           0935 	PRCHR           1973 	PRESS           
061F 	PREVS0          060B 	PREVS1          061A 	PREVS2          
0602 	PREVST          134EI 	PRINT           1353 	PRINT0          
135F 	PRINT1          153A 	PRSP            164DI 	RDBL            
0F60 	RDCOR           0884I 	RDEL            1640I 	RDFIL           
0822I 	RED             09AB 	RED2            0ECCI 	REND            
17F4 	REP             0D7C 	REP0            0DB6 	REP1            
0D60 	REP2            0D72 	REP3            0DC8 	REP4            
0D1CI 	REPLACE         08AAI 	REPMOD          0CFF 	REPREP          
08CCI 	REST            07E5I 	RHTM            049B 	RIGHT           
0001 	RK60K           05F8 	RLD0            05C1 	RLDN            
04DD 	RLUP            1E1C 	RMODE           05D4 	ROLLDN          
04EA 	ROLLUP          0DE1 	RP0             1748 	RP01            
1734 	RP02            172A 	RP1             1768 	RP2             
1708 	RP3             1E17 	RPMES           0CF9 	RPREP0          
0D11 	RPREP1          1047 	SAVMOD          191A 	SB              
1626 	SC01            1634 	SC02            1639 	SC03            
0535 	SCD0            0533 	SCD1            1E2E 	SCRAD0          
1E20 	SCRADR          1E24 	SCRBEG          1E32 	SCRBG0          
0518 	SCRDN           1E06 	SCREND          0019 	SCRHEIGHT       
0807I 	SCRLDN          07FEI 	SCRLUP          00F2 	SCROFFSET       
0924 	SCRSIZE         0556 	SCRUP           004E 	SCRWIDTH        
0008 	SCRXOFFSET      0003 	SCRYOFFSET      18D7 	SCTRL           
0572 	SCU0            0570 	SCU1            0E02I 	SEARCH          
0E1B 	SEARCHSTR       0810 	SETC            15F7I 	SETCURSOR       
1619 	SETCURSOR2      019B 	SETINF          0623 	SETRST          
153CI 	SETSCR          157F 	SETSCR2         11AF 	SETST0          
1918 	SH1             1904 	SH3             1912 	SH5             
0080 	SHIFT           18DF 	SHIFT0          0020 	SPACE           
1E16 	SRMES           159B 	SS01            159F 	SS02            
15A3 	SS03            15A7 	SS04            15AA 	SS05            
15AE 	SS06            15B0 	SS07            15B2 	SS08            
15D5 	SS10            15E3 	SS11            15E6 	SS12            
15EC 	SS13            15F0 	SS14            15F4 	SS15            
11B7 	SST00           11C1 	SST01           011DI 	START           
0115 	START_COLD      0030 	STKSIZE         0FC2 	STR2            
0FE8 	STR3            1E30 	STRAD0          1E22 	STRADR          
1E7D 	STRRED          1E6F 	STRREP          1E61 	STRSR           
0A66 	SWPW0           0A4DI 	SWPWIN          0A56 	SWPWN           
1E42 	SYM             08BEI 	TAB             1E3D 	TABSRH          
0008 	TABSTEP         2000 	TXTBUFF         0700 	U0              
06FE 	U1              07ECI 	UPM             06FB 	UPSHT           
1E04 	VDADR           0103I 	VRAM_ADR        1E02I 	WERHGR          
1041 	WIDCUR          0AD5 	WIN01           0B30 	WIND0           
0B61 	WIND01          0B40 	WIND1           0AF8I 	WINDN           
0AA4 	WINU0           0AB4 	WINU1           0A7CI 	WINUP           
03BC 	WLEWO           0513 	WN20            04BB 	WNIZ            
03D4 	WP1             03C7 	WPRAWO          167DI 	WRBL            
	MACRO-80 3.44	09-Dec-81	PAGE	S-3


166AI 	WRFIL           1E00 	WRK             0236 	WRMSRT          
1691 	WRSEG           05A5 	WWERH           1E29 	YBEG            
1E37 	YBEG0           0014 	YMAX            0002 	YMIN            
1E28 	YSIZE           1E36 	YSIZE0          



No Fatal error(s)


       0AB4 	WINU1           0A7CI 	WINUP           
03BC 	WLEWO           0513 	WN20            04BB 	WNIZ            
0